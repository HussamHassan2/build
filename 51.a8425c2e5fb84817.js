"use strict";(self.webpackChunkinsurance_portal=self.webpackChunkinsurance_portal||[]).push([[51],{6051:(Ut,F,s)=>{s.r(F),s.d(F,{CustomerModule:()=>Gt});var l=s(177),_=s(9417),d=s(9984),R=s(7468),t=s(4438),g=s(8010),b=s(2166),y=s(4644),S=s(7244),p=s(9989),v=s(9947),u=s(4333),f=s(4842);const I=r=>({name:r});function T(r,o){1&r&&t.nrm(0,"app-loading-spinner")}function D(r,o){1&r&&(t.qSk(),t.j41(0,"svg",30),t.nrm(1,"path",18),t.k0s())}function $(r,o){1&r&&(t.qSk(),t.j41(0,"svg",30),t.nrm(1,"path",13)(2,"path",14),t.k0s())}function N(r,o){1&r&&(t.qSk(),t.j41(0,"svg",30),t.nrm(1,"rect",19)(2,"line",20),t.k0s())}function M(r,o){1&r&&(t.qSk(),t.j41(0,"svg",30),t.nrm(1,"path",31)(2,"path",32)(3,"path",33),t.k0s())}function A(r,o){if(1&r&&(t.j41(0,"app-card",23)(1,"div",24)(2,"div")(3,"p",25),t.EFF(4),t.k0s(),t.j41(5,"p",26),t.EFF(6),t.k0s(),t.j41(7,"p",27),t.EFF(8),t.k0s()(),t.j41(9,"div",28),t.DNE(10,D,2,0,"svg",29)(11,$,3,0,"svg",29)(12,N,3,0,"svg",29)(13,M,4,0,"svg",29),t.k0s()()()),2&r){const e=o.$implicit;t.Y8G("hover",!0),t.R7$(4),t.JRh(e.title),t.R7$(2),t.JRh(e.value),t.R7$(2),t.JRh(e.change),t.R7$(),t.Y8G("ngClass",e.color),t.R7$(),t.Y8G("ngIf","shield"===e.icon),t.R7$(),t.Y8G("ngIf","file-text"===e.icon),t.R7$(),t.Y8G("ngIf","credit-card"===e.icon),t.R7$(),t.Y8G("ngIf","scroll-text"===e.icon)}}function P(r,o){if(1&r&&(t.j41(0,"div",34)(1,"div",35),t.qSk(),t.j41(2,"svg",36),t.nrm(3,"circle",37)(4,"path",38)(5,"path",39),t.k0s()(),t.joV(),t.j41(6,"div",40)(7,"p",16),t.EFF(8),t.k0s(),t.j41(9,"p",41),t.EFF(10),t.k0s(),t.j41(11,"p",42),t.EFF(12),t.k0s()()()),2&r){const e=o.$implicit;t.R7$(8),t.JRh(e.title),t.R7$(2),t.JRh(e.description),t.R7$(2),t.JRh(e.time)}}function L(r,o){if(1&r&&(t.j41(0,"div",0)(1,"div",3)(2,"h1",4),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"p",5),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"div",6),t.DNE(9,A,14,9,"app-card",7),t.k0s(),t.j41(10,"app-card",8),t.nI1(11,"translate"),t.j41(12,"div",9)(13,"button",10)(14,"div",11),t.qSk(),t.j41(15,"svg",12),t.nrm(16,"path",13)(17,"path",14),t.k0s()(),t.joV(),t.j41(18,"div",15)(19,"p",16),t.EFF(20),t.nI1(21,"translate"),t.k0s(),t.j41(22,"p",17),t.EFF(23),t.nI1(24,"translate"),t.k0s()()(),t.j41(25,"button",10)(26,"div",11),t.qSk(),t.j41(27,"svg",12),t.nrm(28,"path",18),t.k0s()(),t.joV(),t.j41(29,"div",15)(30,"p",16),t.EFF(31),t.nI1(32,"translate"),t.k0s(),t.j41(33,"p",17),t.EFF(34),t.nI1(35,"translate"),t.k0s()()(),t.j41(36,"button",10)(37,"div",11),t.qSk(),t.j41(38,"svg",12),t.nrm(39,"rect",19)(40,"line",20),t.k0s()(),t.joV(),t.j41(41,"div",15)(42,"p",16),t.EFF(43),t.nI1(44,"translate"),t.k0s(),t.j41(45,"p",17),t.EFF(46),t.nI1(47,"translate"),t.k0s()()()()(),t.j41(48,"app-card",8),t.nI1(49,"translate"),t.j41(50,"div",21),t.DNE(51,P,13,3,"div",22),t.k0s()()()),2&r){const e=t.XpG();t.R7$(3),t.JRh(t.i5U(4,12,"CUSTOMER.DASHBOARD.WELCOME",t.eq3(33,I,(null==e.user?null:e.user.name)||"Customer"))),t.R7$(3),t.JRh(t.bMT(7,15,"CUSTOMER.DASHBOARD.SUBTITLE")),t.R7$(3),t.Y8G("ngForOf",e.stats),t.R7$(),t.Y8G("title",t.bMT(11,17,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.TITLE")),t.R7$(10),t.JRh(t.bMT(21,19,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.FILE_CLAIM")),t.R7$(3),t.JRh(t.bMT(24,21,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.FILE_CLAIM_DESC")),t.R7$(8),t.JRh(t.bMT(32,23,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.VIEW_POLICIES")),t.R7$(3),t.JRh(t.bMT(35,25,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.VIEW_POLICIES_DESC")),t.R7$(9),t.JRh(t.bMT(44,27,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.MAKE_PAYMENT")),t.R7$(3),t.JRh(t.bMT(47,29,"CUSTOMER.DASHBOARD.QUICK_ACTIONS.MAKE_PAYMENT_DESC")),t.R7$(2),t.Y8G("title",t.bMT(49,31,"CUSTOMER.DASHBOARD.RECENT_ACTIVITY")),t.R7$(3),t.Y8G("ngForOf",e.recentActivities)}}let G=(()=>{class r{constructor(e,i,a,n){this.authService=e,this.policyService=i,this.claimService=a,this.quoteService=n,this.user=null,this.loading=!0,this.stats=[{title:"Total Policies",value:"0",icon:"shield",color:"bg-blue-500",change:"+0%"},{title:"Active Claims",value:"0",icon:"file-text",color:"bg-green-500",change:"+0%"},{title:"Pending Payments",value:"$0",icon:"credit-card",color:"bg-yellow-500",change:"+0%"},{title:"Quotations",value:"0",icon:"scroll-text",color:"bg-purple-500",change:"+0%"}],this.recentActivities=[{title:"Welcome to Orient Insurance Portal",description:"Get started by exploring your dashboard",time:"Just now",type:"info"}]}ngOnInit(){this.authService.currentUser.subscribe(e=>{this.user=e,e&&this.loadDashboardData(e.id)})}loadDashboardData(e){this.loading=!0,(0,R.p)({policies:this.policyService.listPolicies({user_id:e,user_type:"customer",limit:100}),claims:this.claimService.listClaims({user_id:e,user_type:"customer",limit:100}),quotes:this.quoteService.listQuotations({user_id:e,user_type:"customer",limit:100})}).subscribe({next:i=>{const a=i.policies?.result?.data?.policies||[],n=i.claims?.result?.data?.claims||[],c=i.quotes?.result?.data?.quotations||[];this.stats[0].value=a.length.toString(),this.stats[0].change=`+${a.filter(m=>new Date(m.date).getMonth()===(new Date).getMonth()).length} this month`,this.stats[1].value=n.filter(m=>"Closed"!==m.stage_name).length.toString(),this.stats[3].value=c.length.toString(),this.stats[3].change=`+${c.filter(m=>new Date(m.date).getMonth()===(new Date).getMonth()).length} this month`;const Ot=a.filter(m=>"not_paid"===m.payment_state).length;this.stats[2].value=Ot.toString(),this.loading=!1},error:i=>{console.error("Error loading dashboard data",i),this.loading=!1}})}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(g.u),t.rXU(b.m),t.rXU(y.q),t.rXU(S.K))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-customer-dashboard"]],decls:4,vars:2,consts:[[1,"space-y-6"],[4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"bg-gradient-to-r","from-primary","to-primary-dark","rounded-lg","p-6","text-white"],[1,"text-3xl","font-bold","mb-2"],[1,"text-blue-100"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],[3,"hover",4,"ngFor","ngForOf"],[3,"title"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"flex","items-center","gap-3","p-4","border-2","border-gray-200","dark:border-gray-700","rounded-lg","hover:border-primary","hover:bg-primary/5","transition-all"],[1,"bg-primary/10","p-2","rounded-lg"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-primary"],["d","M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"],["d","M14 2v4a2 2 0 0 0 2 2h4"],[1,"text-left"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["d","M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"],["width","20","height","14","x","2","y","5","rx","2"],["x1","2","x2","22","y1","10","y2","10"],[1,"space-y-4"],["class","flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",4,"ngFor","ngForOf"],[3,"hover"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-400"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white","mt-2"],[1,"text-sm","text-green-600","dark:text-green-400","mt-1"],[1,"p-3","rounded-full",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","white","stroke-width","2","stroke-linecap","round","stroke-linejoin","round","class","h-6 w-6",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","white","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-6","w-6"],["d","M15 12h-5"],["d","M15 8h-5"],["d","M19 17V5a2 2 0 0 0-2-2H4"],[1,"flex","items-start","gap-4","p-4","bg-gray-50","dark:bg-gray-700/50","rounded-lg"],[1,"bg-blue-100","dark:bg-blue-900/30","p-2","rounded-full"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-blue-600","dark:text-blue-400"],["cx","12","cy","12","r","10"],["d","M12 16v-4"],["d","M12 8h.01"],[1,"flex-1"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"text-xs","text-gray-500","dark:text-gray-500","mt-1"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout")(1,"div",0),t.DNE(2,T,1,0,"app-loading-spinner",1)(3,L,52,35,"div",2),t.k0s()()),2&i&&(t.R7$(2),t.Y8G("ngIf",a.loading),t.R7$(),t.Y8G("ngIf",!a.loading))},dependencies:[l.YU,l.Sq,l.bT,p.w,v.i,u.N,f.D9]})}}return r})();var h=s(8219),x=s(4373);function O(r,o){if(1&r&&(t.j41(0,"div",12),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function U(r,o){1&r&&(t.j41(0,"div",13),t.nrm(1,"app-loading-spinner"),t.k0s())}function V(r,o){if(1&r){const e=t.RV6();t.j41(0,"app-dynamic-table-with-filters",14),t.bIt("filteredDataChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onFilteredDataChange(a))})("exportData",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onExport())})("action",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.handleTableAction(a))}),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("data",e.data)("columns",e.columns)("showExport",!0)("maxSelectOptions",10)}}let X=(()=>{class r{constructor(e,i,a){this.policyService=e,this.authService=i,this.router=a,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.setupColumns()}ngOnInit(){this.loadPolicies()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"policyNumber",label:"Policy No",filterable:!0,filterType:"text"},{key:"type",label:"Product Type",filterable:!0},{key:"status",label:"Status",filterable:!0,render:e=>this.renderStatus(e.status)},{key:"premium",label:"Premium",filterable:!1,render:e=>`<span class="font-medium text-gray-900 dark:text-gray-100">${e.currency||"EGP"} ${Number(e.premium).toLocaleString()}</span>`},{key:"expiry",label:"Expiry Date",filterable:!0,filterType:"date"},{key:"actions",label:"Actions",filterable:!1,render:e=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${e.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="download" data-id="${e.id}" title="Download Policy">\n                            <i data-lucide="file-text" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(e){const i=e?.toLowerCase()||"pending";let a="";return a=["active","approved","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","processing"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${a}">${e}</span>`}loadPolicies(){this.isLoading=!0;const e=this.authService.currentUserValue;e&&this.policyService.listPolicies({user_id:e.id,user_type:"customer",limit:100,offset:0}).subscribe({next:i=>{this.data=(i.data||[]).map(n=>({id:n.id||n.policy_number,policyNumber:n.policy_number,type:n.product_name||"Insurance",status:(n.state||"pending").toLowerCase(),premium:n.gross_premium||0,currency:n.currency||"EGP",expiry:n.effective_to_date||n.end_date})),this.isLoading=!1},error:i=>{console.error("Error loading policies:",i),this.error="Failed to load policies",this.isLoading=!1}})}onFilteredDataChange(e){this.filteredData=e}handleTableAction(e){switch(e.action){case"view":this.router.navigate(["/dashboard/customer/policies",e.data.id]);break;case"download":console.log("Download",e.data.id)}}onExport(){console.log("Exporting policies...")}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(b.m),t.rXU(g.u),t.rXU(d.Ix))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-customer-policies"]],decls:20,vars:12,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],["variant","primary"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-4","w-4","mr-2"],["d","M5 12h14"],["d","M12 5v14"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div")(4,"h1",2),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"app-button",4),t.qSk(),t.j41(11,"svg",5),t.nrm(12,"path",6)(13,"path",7),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.joV(),t.j41(16,"div",8),t.DNE(17,O,2,1,"div",9)(18,U,2,0,"div",10)(19,V,1,4,"app-dynamic-table-with-filters",11),t.k0s()()()),2&i&&(t.R7$(5),t.SpI("",t.bMT(6,6,"CUSTOMER.POLICIES.TITLE")," "),t.R7$(3),t.JRh(t.bMT(9,8,"CUSTOMER.POLICIES.SUBTITLE")),t.R7$(6),t.SpI(" ",t.bMT(15,10,"CUSTOMER.POLICIES.NEW_POLICY")," "),t.R7$(3),t.Y8G("ngIf",a.error),t.R7$(),t.Y8G("ngIf",a.isLoading),t.R7$(),t.Y8G("ngIf",!a.isLoading&&!a.error))},dependencies:[l.bT,p.w,h.Q,u.N,x.u,f.D9]})}}return r})();var C=s(1672);function Y(r,o){if(1&r&&(t.j41(0,"div",12),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function B(r,o){1&r&&(t.j41(0,"div",13),t.nrm(1,"app-loading-spinner"),t.k0s())}function q(r,o){if(1&r){const e=t.RV6();t.j41(0,"app-dynamic-table-with-filters",14),t.bIt("filteredDataChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onFilteredDataChange(a))})("exportData",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onExport())})("action",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.handleTableAction(a))}),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("data",e.data)("columns",e.columns)("showExport",!0)("maxSelectOptions",10)}}let Q=(()=>{class r{constructor(e,i,a,n){this.claimService=e,this.authService=i,this.router=a,this.appTranslate=n,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.setupColumns(),this.appTranslate.get("CUSTOMER.CLAIMS.COLUMNS").subscribe(()=>{this.setupColumns()})}ngOnInit(){this.loadClaims()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"claimNumber",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.CLAIM_NUMBER"),filterable:!0,filterType:"text"},{key:"policyNumber",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.POLICY"),filterable:!0,filterType:"text"},{key:"vehiclePlate",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.VEHICLE_PLATE"),filterable:!0,filterType:"text"},{key:"vehicleMaker",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.VEHICLE_MAKER"),filterable:!0,filterType:"text"},{key:"type",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.TYPE"),filterable:!0},{key:"productName",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.PRODUCT"),filterable:!0},{key:"status",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.STATUS"),filterable:!0,render:e=>this.renderStatus(e.status)},{key:"amount",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.AMOUNT"),filterable:!1},{key:"date",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.DATE"),filterable:!0,filterType:"date"},{key:"actions",label:this.appTranslate.instant("CUSTOMER.CLAIMS.COLUMNS.ACTIONS"),filterable:!1,render:e=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${e.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(e){const i=e?.toLowerCase()||"pending";let a="";return a=["active","approved","settled","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","submitted","in_progress","processing","intimated","draft"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${a}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}loadClaims(){this.isLoading=!0;const e=this.authService.currentUserValue;e&&this.claimService.listClaims({user_id:e.id,user_type:"customer",limit:100,offset:0}).subscribe({next:i=>{let a=[];a=Array.isArray(i)?i:Array.isArray(i.data)?i.data:i.data?.result?.data?i.data.result.data:i.data?.data?i.data.data:[],this.data=a.map(n=>({id:n.id||n.claim_number,claimNumber:n.claim_number||"N/A",policyNumber:n.policy_number||"N/A",vehiclePlate:n.vehicle_plate_number||"N/A",vehicleMaker:n.vehicle_maker||"N/A",type:n.lob||n.claim_type||"N/A",productName:n.product_name?"number"==typeof n.product_name?`Product ${n.product_name}`:n.product_name:"N/A",date:n.intimation_date||n.claim_date||"N/A",amount:n.claim_amount?`EGP ${n.claim_amount.toLocaleString()}`:"N/A",status:(n.status||n.state||"pending").toLowerCase().replace(/\s+/g,"_")})),this.isLoading=!1},error:i=>{console.error("Error loading claims:",i),this.error=this.appTranslate.instant("CUSTOMER.CLAIMS.ERROR_LOADING"),this.isLoading=!1}})}onFilteredDataChange(e){this.filteredData=e}handleTableAction(e){"view"===e.action&&this.router.navigate(["/dashboard/customer/claims",e.data.id])}onExport(){console.log("Exporting claims...")}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(y.q),t.rXU(g.u),t.rXU(d.Ix),t.rXU(C.F))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-customer-claims"]],decls:20,vars:12,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],["variant","primary"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-4","w-4","mr-2"],["d","M5 12h14"],["d","M12 5v14"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div")(4,"h1",2),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"app-button",4),t.qSk(),t.j41(11,"svg",5),t.nrm(12,"path",6)(13,"path",7),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.joV(),t.j41(16,"div",8),t.DNE(17,Y,2,1,"div",9)(18,B,2,0,"div",10)(19,q,1,4,"app-dynamic-table-with-filters",11),t.k0s()()()),2&i&&(t.R7$(5),t.SpI("",t.bMT(6,6,"CUSTOMER.CLAIMS.TITLE")," "),t.R7$(3),t.JRh(t.bMT(9,8,"CUSTOMER.CLAIMS.SUBTITLE")),t.R7$(6),t.SpI(" ",t.bMT(15,10,"CUSTOMER.CLAIMS.NEW_CLAIM")," "),t.R7$(3),t.Y8G("ngIf",a.error),t.R7$(),t.Y8G("ngIf",a.isLoading),t.R7$(),t.Y8G("ngIf",!a.isLoading&&!a.error))},dependencies:[l.bT,p.w,h.Q,u.N,x.u,f.D9]})}}return r})();var j=s(5740);function J(r,o){if(1&r&&(t.j41(0,"div",12),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function z(r,o){1&r&&(t.j41(0,"div",13),t.nrm(1,"app-loading-spinner"),t.k0s())}function H(r,o){if(1&r){const e=t.RV6();t.j41(0,"app-dynamic-table-with-filters",14),t.bIt("filteredDataChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onFilteredDataChange(a))})("exportData",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onExport())})("action",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.handleTableAction(a))}),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("data",e.data)("columns",e.columns)("showExport",!0)("maxSelectOptions",10)}}let K=(()=>{class r{constructor(e,i,a){this.crmService=e,this.authService=i,this.router=a,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.setupColumns()}ngOnInit(){this.loadQuotations()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"quoteNumber",label:"Quote No",filterable:!0,filterType:"text"},{key:"product",label:"Product",filterable:!0},{key:"status",label:"Status",filterable:!0,render:e=>this.renderStatus(e.status)},{key:"premium",label:"Premium",filterable:!1,render:e=>`<span class="font-medium text-gray-900 dark:text-gray-100">${e.currency||"EGP"} ${Number(e.premium).toLocaleString()}</span>`},{key:"validUntil",label:"Valid Until",filterable:!0,filterType:"date"},{key:"actions",label:"Actions",filterable:!1,render:e=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${e.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(e){const i=e?.toLowerCase()||"draft";let a="";return a=["accepted","approved","won"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["sent","pending","negotiation"].includes(i)?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":["draft"].includes(i)?"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${a}">${e}</span>`}loadQuotations(){this.isLoading=!0;const e=this.authService.currentUserValue;e&&this.crmService.listOpportunities({user_id:e.id,user_type:"customer",limit:100,offset:0}).subscribe({next:i=>{this.data=(i.data||[]).map(n=>({id:n.id||n.quotation_number,quoteNumber:n.quotation_number||n.name||"N/A",product:n.product_name||"General",status:(n.stage_id||n.status||"draft").toLowerCase(),premium:n.expected_revenue||0,currency:n.currency||"EGP",validUntil:n.date_deadline||"N/A"})),this.isLoading=!1},error:i=>{console.error("Error loading quotations:",i),this.error="Failed to load quotations",this.isLoading=!1}})}onFilteredDataChange(e){this.filteredData=e}handleTableAction(e){"view"===e.action&&this.router.navigate(["/dashboard/customer/quotations",e.data.id])}onExport(){console.log("Exporting quotations...")}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(j.u),t.rXU(g.u),t.rXU(d.Ix))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-customer-quotations"]],decls:20,vars:12,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],["variant","primary"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-4","w-4","mr-2"],["d","M5 12h14"],["d","M12 5v14"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div")(4,"h1",2),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"app-button",4),t.qSk(),t.j41(11,"svg",5),t.nrm(12,"path",6)(13,"path",7),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.joV(),t.j41(16,"div",8),t.DNE(17,J,2,1,"div",9)(18,z,2,0,"div",10)(19,H,1,4,"app-dynamic-table-with-filters",11),t.k0s()()()),2&i&&(t.R7$(5),t.JRh(t.bMT(6,6,"CUSTOMER.QUOTATIONS.TITLE")),t.R7$(3),t.JRh(t.bMT(9,8,"CUSTOMER.QUOTATIONS.SUBTITLE")),t.R7$(6),t.SpI(" ",t.bMT(15,10,"CUSTOMER.QUOTATIONS.NEW_QUOTE")," "),t.R7$(3),t.Y8G("ngIf",a.error),t.R7$(),t.Y8G("ngIf",a.isLoading),t.R7$(),t.Y8G("ngIf",!a.isLoading&&!a.error))},dependencies:[l.bT,p.w,h.Q,u.N,x.u,f.D9]})}}return r})();var k=s(467),E=s(5567),W=s(2209);function Z(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",4)(1,"div",5),t.nrm(2,"i",6),t.j41(3,"span",7),t.EFF(4),t.k0s(),t.j41(5,"button",8),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.successMessage=null)}),t.EFF(6," \u2715 "),t.k0s()()()}if(2&r){const e=t.XpG();t.R7$(4),t.JRh(e.successMessage)}}function tt(r,o){1&r&&(t.j41(0,"div",9)(1,"div",10),t.nrm(2,"app-loading-spinner"),t.j41(3,"p",11),t.EFF(4,"Loading quotation details..."),t.k0s()()())}function et(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",9)(1,"div",10),t.nrm(2,"i",12),t.j41(3,"h2",13),t.EFF(4,"Error Loading Quotation"),t.k0s(),t.j41(5,"p",14),t.EFF(6),t.k0s(),t.j41(7,"button",15),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())}),t.nrm(8,"i",16),t.EFF(9," Back to Quotations "),t.k0s()()()}if(2&r){const e=t.XpG();t.R7$(6),t.JRh(e.error||"Quotation not found")}}function at(r,o){1&r&&(t.j41(0,"div",81),t.EFF(1,"LOST"),t.k0s())}function it(r,o){if(1&r){const e=t.RV6();t.j41(0,"button",82),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.showMarkLostModal=!0)}),t.nrm(1,"i",83),t.EFF(2," Mark as Lost "),t.k0s()}}function rt(r,o){if(1&r&&(t.j41(0,"span",87),t.nrm(1,"i",88),t.EFF(2),t.k0s()),2&r){const e=o.$implicit;t.R7$(2),t.SpI(" ",e," ")}}function nt(r,o){if(1&r&&(t.j41(0,"div")(1,"p",84),t.EFF(2,"Coverage Extensions"),t.k0s(),t.j41(3,"div",85),t.DNE(4,rt,3,1,"span",86),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(4),t.Y8G("ngForOf",e.quote.insurance.addons)}}function ot(r,o){1&r&&(t.j41(0,"div",101)(1,"span",102),t.EFF(2," Recommended "),t.k0s()())}function st(r,o){1&r&&t.nrm(0,"i",109)}function lt(r,o){1&r&&t.nrm(0,"i",110)}function dt(r,o){if(1&r&&(t.j41(0,"div",105),t.DNE(1,st,1,0,"i",106)(2,lt,1,0,"i",107),t.j41(3,"span",108),t.EFF(4),t.k0s()()),2&r){const e=o.$implicit;t.R7$(),t.Y8G("ngIf",e.included),t.R7$(),t.Y8G("ngIf",!e.included),t.R7$(),t.Y8G("ngClass",e.included?"text-gray-700":"text-gray-400"),t.R7$(),t.SpI(" ",e.name," ")}}function ct(r,o){if(1&r&&(t.j41(0,"div",103),t.DNE(1,dt,5,4,"div",104),t.k0s()),2&r){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",e.features)}}function pt(r,o){if(1&r&&(t.j41(0,"div",91),t.DNE(1,ot,3,0,"div",92),t.j41(2,"h4",93),t.EFF(3),t.k0s(),t.j41(4,"div",94)(5,"p",95),t.EFF(6),t.k0s(),t.j41(7,"span",96),t.EFF(8,"Gross Premium / Year"),t.k0s()(),t.j41(9,"div",97)(10,"div",98)(11,"span",99),t.EFF(12,"Sum Insured"),t.k0s(),t.j41(13,"span",56),t.EFF(14),t.k0s()(),t.j41(15,"div",98)(16,"span",99),t.EFF(17,"Net Rate"),t.k0s(),t.j41(18,"span",44),t.EFF(19),t.k0s()(),t.j41(20,"div",98)(21,"span",99),t.EFF(22,"Net Premium"),t.k0s(),t.j41(23,"span",44),t.EFF(24),t.k0s()(),t.j41(25,"div",98)(26,"span",99),t.EFF(27,"Taxes"),t.k0s(),t.j41(28,"span",44),t.EFF(29),t.k0s()(),t.j41(30,"div",98)(31,"span",99),t.EFF(32,"Stamp Duty"),t.k0s(),t.j41(33,"span",44),t.EFF(34),t.k0s()(),t.j41(35,"div",98)(36,"span",99),t.EFF(37,"Issue Fees"),t.k0s(),t.j41(38,"span",44),t.EFF(39),t.k0s()()(),t.DNE(40,ct,2,1,"div",100),t.k0s()),2&r){const e=o.$implicit;t.Y8G("ngClass",e.recommended?"border-primary bg-blue-50 dark:bg-blue-900/30 relative":"border-gray-200 hover:border-primary"),t.R7$(),t.Y8G("ngIf",e.recommended),t.R7$(2),t.JRh(e.name),t.R7$(3),t.SpI(" EGP ",(e.price||0).toLocaleString()," "),t.R7$(8),t.SpI("EGP ",((null==e.details?null:e.details.sumInsured)||0).toLocaleString(),""),t.R7$(5),t.SpI("",((null==e.details?null:e.details.netRate)||0).toFixed(3),"%"),t.R7$(5),t.SpI("EGP ",((null==e.details?null:e.details.netPremium)||0).toLocaleString(),""),t.R7$(5),t.SpI("EGP ",((null==e.details?null:e.details.taxes)||0).toLocaleString(),""),t.R7$(5),t.SpI("EGP ",((null==e.details?null:e.details.stampDuty)||0).toLocaleString(),""),t.R7$(5),t.SpI("EGP ",((null==e.details?null:e.details.fees)||0).toLocaleString(),""),t.R7$(),t.Y8G("ngIf",(null==e.features?null:e.features.length)>0)}}function ut(r,o){if(1&r&&(t.j41(0,"div",89),t.DNE(1,pt,41,11,"div",90),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.quote.plans)}}function mt(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",17)(1,"div",18)(2,"div",19),t.DNE(3,at,2,0,"div",20),t.j41(4,"button",21),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())}),t.nrm(5,"i",22),t.EFF(6," Back to Quotations "),t.k0s(),t.j41(7,"div",23)(8,"div",24)(9,"div",25),t.nrm(10,"i",26),t.k0s(),t.j41(11,"div")(12,"h1",27),t.EFF(13),t.k0s(),t.j41(14,"div",28)(15,"span",29),t.nrm(16,"i",30),t.EFF(17),t.k0s(),t.j41(18,"span",29),t.nrm(19,"i",31),t.EFF(20),t.k0s(),t.j41(21,"span",29),t.nrm(22,"i",32),t.EFF(23),t.k0s()()()(),t.j41(24,"div",33)(25,"span",34),t.EFF(26),t.k0s(),t.DNE(27,it,3,0,"button",35),t.k0s()()()(),t.j41(28,"div",36)(29,"div",37)(30,"div",38)(31,"h3",39),t.nrm(32,"i",40),t.EFF(33," Customer Information "),t.k0s(),t.j41(34,"div",41)(35,"div",42)(36,"p",43),t.EFF(37,"Full Name"),t.k0s(),t.j41(38,"p",44),t.EFF(39),t.k0s()(),t.j41(40,"div",42)(41,"p",45),t.nrm(42,"i",46),t.EFF(43," Phone "),t.k0s(),t.j41(44,"p",44),t.EFF(45),t.k0s()(),t.j41(46,"div",42)(47,"p",45),t.nrm(48,"i",47),t.EFF(49," Email "),t.k0s(),t.j41(50,"p",44),t.EFF(51),t.k0s()(),t.j41(52,"div",42)(53,"p",45),t.nrm(54,"i",48),t.EFF(55," Type "),t.k0s(),t.j41(56,"p",44),t.EFF(57),t.k0s()(),t.j41(58,"div",42)(59,"p",45),t.nrm(60,"i",49),t.EFF(61," Tax ID "),t.k0s(),t.j41(62,"p",44),t.EFF(63),t.k0s()(),t.j41(64,"div",50)(65,"p",45),t.nrm(66,"i",51),t.EFF(67," Address "),t.k0s(),t.j41(68,"p",44),t.EFF(69),t.k0s()()()(),t.j41(70,"div",52)(71,"h3",39),t.nrm(72,"i",53),t.EFF(73," Insurance Coverage "),t.k0s(),t.j41(74,"div",54)(75,"div")(76,"p",55),t.EFF(77,"Type"),t.k0s(),t.j41(78,"p",56),t.EFF(79),t.k0s()(),t.j41(80,"div")(81,"p",55),t.EFF(82,"Plan"),t.k0s(),t.j41(83,"p",56),t.EFF(84),t.k0s()(),t.j41(85,"div")(86,"p",55),t.EFF(87,"Period"),t.k0s(),t.j41(88,"p",56),t.EFF(89),t.k0s()(),t.j41(90,"div")(91,"p",55),t.EFF(92,"Sum Insured"),t.k0s(),t.j41(93,"p",56),t.EFF(94),t.k0s()()(),t.DNE(95,nt,5,1,"div",57),t.k0s(),t.j41(96,"div",38)(97,"h3",39),t.nrm(98,"i",58),t.EFF(99," Subject Matter - Vehicle Details "),t.k0s(),t.j41(100,"div",59)(101,"div",42)(102,"p",43),t.EFF(103,"Make & Model"),t.k0s(),t.j41(104,"p",44),t.EFF(105),t.k0s()(),t.j41(106,"div",42)(107,"p",43),t.EFF(108,"Year"),t.k0s(),t.j41(109,"p",44),t.EFF(110),t.k0s()(),t.j41(111,"div",42)(112,"p",43),t.EFF(113,"Plate Number"),t.k0s(),t.j41(114,"p",44),t.EFF(115),t.k0s()(),t.j41(116,"div",42)(117,"p",43),t.EFF(118,"Color"),t.k0s(),t.j41(119,"p",44),t.EFF(120),t.k0s()(),t.j41(121,"div",42)(122,"p",43),t.EFF(123,"Chassis Number"),t.k0s(),t.j41(124,"p",60),t.EFF(125),t.k0s()(),t.j41(126,"div",42)(127,"p",43),t.EFF(128,"Usage"),t.k0s(),t.j41(129,"p",44),t.EFF(130),t.k0s()(),t.j41(131,"div",50)(132,"p",43),t.EFF(133,"Estimated Value"),t.k0s(),t.j41(134,"p",44),t.EFF(135),t.k0s()()()(),t.j41(136,"div",38)(137,"div",61)(138,"h3",62),t.nrm(139,"i",63),t.EFF(140," Compare Plans "),t.k0s(),t.j41(141,"button",64),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.showComparison=!a.showComparison)}),t.EFF(142),t.k0s()(),t.DNE(143,ut,2,1,"div",65),t.k0s(),t.j41(144,"div",66)(145,"h3",39),t.nrm(146,"i",67),t.EFF(147," Comments & Messages "),t.k0s(),t.j41(148,"p",68),t.EFF(149," ChatterBox component integration pending "),t.k0s()()(),t.j41(150,"div",69)(151,"div",70)(152,"p",71),t.EFF(153,"Total Annual Premium"),t.k0s(),t.j41(154,"p",72),t.EFF(155),t.k0s(),t.j41(156,"div",73)(157,"div",74)(158,"span"),t.EFF(159,"Subtotal"),t.k0s(),t.j41(160,"span"),t.EFF(161),t.k0s()(),t.j41(162,"div",74)(163,"span"),t.EFF(164,"Taxes & Fees"),t.k0s(),t.j41(165,"span"),t.EFF(166),t.k0s()()(),t.j41(167,"button",75),t.nrm(168,"i",76),t.EFF(169," Accept & Pay "),t.k0s()(),t.j41(170,"div",77)(171,"h4",78),t.nrm(172,"i",79),t.EFF(173," Important Note "),t.k0s(),t.j41(174,"p",80),t.EFF(175," This quotation is valid for 30 days from the date of creation. Prices and coverage terms are subject to change after the validity period. "),t.k0s()()()()()}if(2&r){const e=t.XpG();t.R7$(3),t.Y8G("ngIf","lost"===(null==e.quote?null:e.quote.status)),t.R7$(10),t.SpI(" Quotation ",e.quote.quotationNumber," "),t.R7$(4),t.SpI(" ",e.quote.customer.name," "),t.R7$(3),t.SpI(" Created ",e.quote.date," "),t.R7$(3),t.SpI(" Valid until ",e.quote.validUntil," "),t.R7$(2),t.Y8G("ngClass","bg-"+e.statusConfig.color+"-100 text-"+e.statusConfig.color+"-800"),t.R7$(),t.SpI(" ",e.statusConfig.label," "),t.R7$(),t.Y8G("ngIf",e.isBroker&&"lost"!==(null==e.quote?null:e.quote.status)),t.R7$(12),t.JRh(e.quote.customer.name),t.R7$(6),t.JRh(e.quote.customer.phone),t.R7$(6),t.JRh(e.quote.customer.email),t.R7$(6),t.JRh(e.quote.customer.type),t.R7$(6),t.JRh(e.quote.customer.taxId),t.R7$(6),t.JRh(e.quote.customer.address),t.R7$(10),t.JRh(e.quote.insurance.type),t.R7$(5),t.JRh(e.quote.insurance.coveragePlan),t.R7$(5),t.JRh(e.quote.insurance.coveragePeriod),t.R7$(5),t.SpI("EGP ",(e.quote.insurance.sumInsured||0).toLocaleString(),""),t.R7$(),t.Y8G("ngIf",(null==e.quote.insurance.addons?null:e.quote.insurance.addons.length)>0),t.R7$(10),t.Lme("",e.quote.vehicle.make," ",e.quote.vehicle.model,""),t.R7$(5),t.JRh(e.quote.vehicle.year),t.R7$(5),t.JRh(e.quote.vehicle.plateNumber),t.R7$(5),t.JRh(e.quote.vehicle.color),t.R7$(5),t.JRh(e.quote.vehicle.chassisNumber),t.R7$(5),t.JRh(e.quote.vehicle.usage),t.R7$(5),t.SpI("EGP ",(e.quote.vehicle.value||0).toLocaleString(),""),t.R7$(7),t.SpI(" ",e.showComparison?"Hide":"Show"," Comparison "),t.R7$(),t.Y8G("ngIf",e.showComparison),t.R7$(12),t.SpI("EGP ",((null==e.quote||null==e.quote.premium?null:e.quote.premium.total)||0).toLocaleString(),""),t.R7$(6),t.SpI("EGP ",(e.calculateSubtotal()||0).toLocaleString(),""),t.R7$(5),t.SpI("EGP ",((e.quote.premium.total||0)-(e.calculateSubtotal()||0)).toLocaleString(),"")}}function gt(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",111)(1,"div",112)(2,"h2",113),t.EFF(3,"Mark Quotation as Lost"),t.k0s(),t.j41(4,"div",114)(5,"div")(6,"app-selection-modal",115),t.mxI("valueChange",function(a){t.eBV(e);const n=t.XpG();return t.DH7(n.selectedReason,a)||(n.selectedReason=a),t.Njj(a)}),t.k0s()(),t.j41(7,"div")(8,"label",116),t.EFF(9," Feedback/Comments "),t.k0s(),t.j41(10,"textarea",117),t.mxI("ngModelChange",function(a){t.eBV(e);const n=t.XpG();return t.DH7(n.lostFeedback,a)||(n.lostFeedback=a),t.Njj(a)}),t.k0s()()(),t.j41(11,"div",118)(12,"button",119),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return a.showMarkLostModal=!1,a.selectedReason="",t.Njj(a.lostFeedback="")}),t.EFF(13," Cancel "),t.k0s(),t.j41(14,"button",120),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.handleMarkAsLost())}),t.EFF(15),t.k0s()()()()}if(2&r){const e=t.XpG();t.R7$(6),t.R50("value",e.selectedReason),t.Y8G("options",e.lostReasons)("title","Select Lost Reason")("subtitle","Why was this quotation lost?")("placeholder","Select a reason...")("layout","list")("displayKey","name")("valueKey","id")("required",!0),t.R7$(4),t.R50("ngModel",e.lostFeedback),t.R7$(2),t.Y8G("disabled",e.submittingLost),t.R7$(2),t.Y8G("disabled",e.submittingLost),t.R7$(),t.SpI(" ",e.submittingLost?"Processing...":"Mark as Lost"," ")}}let ht=(()=>{class r{constructor(e,i,a,n,c){this.route=e,this.router=i,this.crmService=a,this.authService=n,this.notificationService=c,this.quoteId="",this.quote=null,this.loading=!0,this.error=null,this.showComparison=!1,this.showMarkLostModal=!1,this.lostReasons=[],this.selectedReason="",this.lostFeedback="",this.submittingLost=!1,this.successMessage=null,this.refreshTrigger=0}ngOnInit(){this.quoteId=this.route.snapshot.params.id,this.loadQuotation(),this.loadLostReasons()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}loadQuotation(){var e=this;return(0,k.A)(function*(){if(e.quoteId)try{e.loading=!0,e.error=null;const i=yield e.crmService.getOpportunity(Number(e.quoteId)).toPromise(),a=i?.result?.data||i?.data||i;a&&a.id?e.quote={id:a.id||e.quoteId,quotationNumber:a.opportunity_number||a.id||e.quoteId,date:a.creation_date||a.created_at||"N/A",validUntil:a.valid_until||a.expiry_date||"N/A",status:(a.state||"draft").toLowerCase(),stage:a.stage_id?a.stage_id[1]||"New":a.stage||"New",createdBy:a.created_by||a.agent_name||"N/A",customer:{name:a.contact_name||a.partner_name||"N/A",phone:a.customer_phone||a.phone||"N/A",email:a.customer_email||a.email||"N/A",type:a.issuing_type_name||a.partner_company||"N/A",taxId:a.tax_id||a.vat_number||"N/A",address:a.customer_address||a.address||"N/A"},insurance:{type:a.insurance_type||"Motor Insurance",coveragePlan:a.coverage_plan||a.product_name||"Comprehensive",coveragePeriod:a.coverage_period||"12 Months",sumInsured:a.sum_insured||0,deductible:a.deductible||0,addons:a.add_ons||[]},vehicle:{make:a.vehicle_make||a.make||"N/A",model:a.vehicle_model||a.model||"N/A",year:a.vehicle_year||a.year||"N/A",value:a.vehicle_sum_insured||0,plateNumber:a.plate_number||a.plate||"N/A",chassisNumber:a.chassis_number||a.chassis||"N/A",color:a.vehicle_color||"N/A",usage:a.vehicle_usage||"Private"},premium:{base:a.base_premium||a.net_premium||0,riskLoading:a.risk_loading||0,discounts:a.discounts||[],addonCharges:a.addon_charges||[],subtotal:a.subtotal||0,taxes:a.taxes||[],fees:a.fees||0,total:a.total_premium||a.gross_premium||0,paymentOptions:a.payment_options||[]},plans:(a.opportunity_proposal||a.plans||[]).map(n=>({id:n.id,name:n.proposal_reference||n.product_name||`Option ${n.id}`,price:n.proposal_gross_premium||n.price||0,recommended:n.recommended||!1,details:{reference:n.proposal_reference||"N/A",sumInsured:n.proposal_sum_insured||0,netRate:n.proposal_net_rate||0,netPremium:n.proposal_net_premium||0,taxes:n.proposal_tax_amount||0,fees:n.proposal_issue_fees||0,stampDuty:n.proposal_stamp_duty||0,grossPremium:n.proposal_gross_premium||0},features:n.features||[]})),conditions:a.opportunity_conditions||[],documents:a.opportunity_documents||[],activity:a.activity_log||[]}:e.error="Quotation data not found"}catch(i){console.error("Error fetching quotation:",i),e.error=i?.message||"Failed to load quotation",e.notificationService.error(e.error||"Failed to load quotation")}finally{e.loading=!1}})()}loadLostReasons(){var e=this;return(0,k.A)(function*(){try{const i=yield e.crmService.getLostReasons().toPromise();let a=[];i&&i.data&&(Array.isArray(i.data.lost_reasons)?a=i.data.lost_reasons:Array.isArray(i.data)?a=i.data:i.data.result?Array.isArray(i.data.result)?a=i.data.result:i.data.result.data&&Array.isArray(i.data.result.data)&&(a=i.data.result.data):i.data.data&&Array.isArray(i.data.data)&&(a=i.data.data)),e.lostReasons=a}catch(i){console.error("Error fetching lost reasons:",i),e.notificationService.error("Failed to load lost reasons")}})()}handleMarkAsLost(){var e=this;return(0,k.A)(function*(){if(e.selectedReason)try{e.submittingLost=!0;const i=e.selectedReason.id||e.selectedReason;yield e.crmService.markLost(Number(e.quoteId),i,e.lostFeedback).toPromise(),e.showMarkLostModal=!1,e.successMessage="Quotation marked as lost successfully",e.notificationService.success("Quotation marked as lost successfully"),setTimeout(()=>e.successMessage=null,5e3),e.quote&&(e.quote.status="lost")}catch(i){console.error("Error marking quotation as lost:",i),e.notificationService.error("Failed to mark quotation as lost: "+(i?.message||"Unknown error"))}finally{e.submittingLost=!1}else e.notificationService.warning("Please select a reason")})()}calculateSubtotal(){if(!this.quote)return 0;let e=this.quote.premium.base+this.quote.premium.riskLoading;return(this.quote.premium.discounts||[]).forEach(i=>e+=i.amount),(this.quote.premium.addonCharges||[]).forEach(i=>e+=i.amount),e}getStatusConfig(e){const i={draft:{color:"gray",label:"Draft"},sent:{color:"blue",label:"Sent"},viewed:{color:"purple",label:"Viewed"},accepted:{color:"green",label:"Accepted"},rejected:{color:"red",label:"Rejected"},expired:{color:"orange",label:"Expired"},lost:{color:"red",label:"Lost"}},a=i[e]||i.draft;return{...a,label:this.quote?.stage||a.label}}goBack(){this.router.navigate([("broker"===this.authService.currentUserValue?.role?"/dashboard/broker":"/dashboard/customer")+"/quotations"])}get isBroker(){return"broker"===this.authService.currentUserValue?.role}get statusConfig(){return this.getStatusConfig(this.quote?.status||"draft")}onMessageSent(){this.refreshTrigger++}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(d.nX),t.rXU(d.Ix),t.rXU(j.u),t.rXU(g.u),t.rXU(E.J))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-quotation-details"]],decls:6,vars:5,consts:[["class","fixed top-0 left-0 right-0 z-40 animate-slideDown",4,"ngIf"],["class","flex items-center justify-center min-h-screen",4,"ngIf"],["class","space-y-8",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",4,"ngIf"],[1,"fixed","top-0","left-0","right-0","z-40","animate-slideDown"],[1,"bg-gradient-to-r","from-green-600","to-green-700","text-white","px-6","py-4","flex","items-center","gap-3","shadow-lg"],["data-lucide","check-circle",1,"w-5","h-5","flex-shrink-0"],[1,"font-medium"],[1,"ml-auto","text-green-100","hover:text-white","transition-colors",3,"click"],[1,"flex","items-center","justify-center","min-h-screen"],[1,"text-center"],[1,"text-gray-600","dark:text-gray-300","mt-4"],["data-lucide","alert-circle",1,"h-12","w-12","text-red-500","mx-auto","mb-4"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300","mb-4"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-colors","flex","items-center","gap-2","mx-auto",3,"click"],["data-lucide","chevron-left",1,"w-4","h-4"],[1,"space-y-8"],[1,"mb-8","animate-fadeIn"],[1,"relative"],["class","corner-ribbon",4,"ngIf"],[1,"flex","items-center","text-gray-500","dark:text-gray-400","hover:text-primary","mb-4","transition-all","duration-300","text-sm",3,"click"],["data-lucide","arrow-left",1,"w-4","h-4","mr-1"],[1,"flex","flex-col","lg:flex-row","lg:items-center","justify-between","gap-4"],[1,"flex","items-start","gap-4"],[1,"w-14","h-14","bg-gradient-to-br","from-purple-500","to-indigo-600","rounded-xl","flex","items-center","justify-center","text-white","shadow-lg"],["data-lucide","file-text",1,"w-7","h-7"],[1,"text-3xl","font-bold","text-navy","dark:text-white","mb-1","flex","items-center","gap-3"],[1,"flex","flex-wrap","items-center","gap-3","text-sm","text-gray-600","dark:text-gray-300"],[1,"flex","items-center","gap-1"],["data-lucide","user",1,"w-3.5","h-3.5"],["data-lucide","calendar",1,"w-3.5","h-3.5"],["data-lucide","clock",1,"w-3.5","h-3.5"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"px-4","py-2","rounded-full","text-sm","font-semibold","capitalize","flex","items-center","gap-2",3,"ngClass"],["class","px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors flex items-center gap-2",3,"click",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2","space-y-6"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","animate-fadeIn"],[1,"font-bold","text-navy","dark:text-white","mb-4","flex","items-center","gap-2"],["data-lucide","user",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[1,"space-y-1"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-medium","text-navy","dark:text-white"],[1,"text-gray-500","dark:text-gray-400","flex","items-center","gap-1"],["data-lucide","phone",1,"w-3.5","h-3.5"],["data-lucide","mail",1,"w-3.5","h-3.5"],["data-lucide","building",1,"w-3.5","h-3.5"],["data-lucide","hash",1,"w-3.5","h-3.5"],[1,"space-y-1","md:col-span-2"],["data-lucide","map-pin",1,"w-3.5","h-3.5"],[1,"bg-gradient-to-br","from-blue-50","to-indigo-50","dark:from-blue-900/20","dark:to-indigo-900/20","p-6","rounded-xl","border","border-blue-100","dark:border-blue-700","animate-fadeIn"],["data-lucide","shield",1,"w-5","h-5","text-blue-600"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-4"],[1,"text-xs","text-gray-600","dark:text-gray-300","mb-1"],[1,"font-semibold","text-navy","dark:text-white"],[4,"ngIf"],["data-lucide","car",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","text-sm"],[1,"font-medium","text-navy","dark:text-white","font-mono","text-xs"],[1,"flex","items-center","justify-between","mb-6"],[1,"font-bold","text-navy","dark:text-white","flex","items-center","gap-2"],["data-lucide","award",1,"w-5","h-5","text-primary"],[1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700","transition-colors","text-sm",3,"click"],["class","grid grid-cols-1 md:grid-cols-3 gap-4",4,"ngIf"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],["data-lucide","message-square",1,"w-5","h-5","text-primary"],[1,"text-gray-500","dark:text-gray-400","text-sm"],[1,"space-y-6"],[1,"bg-gradient-to-br","from-purple-600","to-indigo-700","p-6","rounded-xl","text-white","shadow-lg","animate-fadeIn"],[1,"text-purple-200","text-sm","mb-1"],[1,"text-3xl","font-bold","mb-6"],[1,"space-y-2","text-sm","text-purple-100","mb-6"],[1,"flex","justify-between"],[1,"w-full","bg-white","text-purple-600","hover:bg-purple-50","dark:bg-purple-900/30","font-semibold","px-4","py-2","rounded-lg","transition-colors","flex","items-center","justify-center","gap-2"],["data-lucide","credit-card",1,"w-4","h-4"],[1,"bg-blue-50","dark:bg-blue-900/30","p-6","rounded-xl","border","border-blue-100","animate-fadeIn"],[1,"font-bold","text-blue-900","mb-2","flex","items-center","gap-2"],["data-lucide","alert-circle",1,"w-5","h-5"],[1,"text-sm","text-blue-800","leading-relaxed"],[1,"corner-ribbon"],[1,"px-4","py-2","border","border-red-200","text-red-600","rounded-lg","hover:bg-red-50","dark:hover:bg-red-900/30","transition-colors","flex","items-center","gap-2",3,"click"],["data-lucide","x-circle",1,"w-4","h-4"],[1,"text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","flex-wrap","gap-2"],["class","px-3 py-1 bg-white text-blue-700 rounded-full text-xs font-medium flex items-center gap-1",4,"ngFor","ngForOf"],[1,"px-3","py-1","bg-white","text-blue-700","rounded-full","text-xs","font-medium","flex","items-center","gap-1"],["data-lucide","check",1,"w-3","h-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["class","border-2 rounded-xl p-6 transition-all hover:shadow-lg",3,"ngClass",4,"ngFor","ngForOf"],[1,"border-2","rounded-xl","p-6","transition-all","hover:shadow-lg",3,"ngClass"],["class","absolute -top-3 left-1/2 transform -translate-x-1/2",4,"ngIf"],[1,"font-bold","text-navy","dark:text-white","text-lg","mb-2"],[1,"mb-6"],[1,"text-3xl","font-bold","text-primary"],[1,"text-sm","text-gray-500","dark:text-gray-400","font-normal"],[1,"space-y-3","mb-6","border-t","border-b","py-4"],[1,"flex","justify-between","text-sm"],[1,"text-gray-500"],["class","space-y-3",4,"ngIf"],[1,"absolute","-top-3","left-1/2","transform","-translate-x-1/2"],[1,"px-3","py-1","bg-primary","text-white","rounded-full","text-xs","font-bold"],[1,"space-y-3"],["class","flex items-center gap-2 text-sm",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","text-sm"],["data-lucide","check-circle","class","w-4 h-4 text-green-600 flex-shrink-0",4,"ngIf"],["data-lucide","x-circle","class","w-4 h-4 text-gray-300 flex-shrink-0",4,"ngIf"],[3,"ngClass"],["data-lucide","check-circle",1,"w-4","h-4","text-green-600","flex-shrink-0"],["data-lucide","x-circle",1,"w-4","h-4","text-gray-300","flex-shrink-0"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-xl","max-w-md","w-full","p-6","animate-fadeIn"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-4"],[1,"space-y-4"],["label","Reason for Losing",3,"valueChange","value","options","title","subtitle","placeholder","layout","displayKey","valueKey","required"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["placeholder","Enter any additional feedback...","rows","4",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","dark:bg-gray-700","dark:text-white","focus:outline-none","focus:ring-2","focus:ring-primary","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700","transition-colors",3,"click","disabled"],[1,"flex-1","px-4","py-2","bg-red-600","hover:bg-red-700","text-white","rounded-lg","transition-colors",3,"click","disabled"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout"),t.DNE(1,Z,7,1,"div",0)(2,tt,5,0,"div",1)(3,et,10,1,"div",1)(4,mt,176,32,"div",2)(5,gt,16,13,"div",3),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",a.successMessage),t.R7$(),t.Y8G("ngIf",a.loading),t.R7$(),t.Y8G("ngIf",a.error&&!a.loading),t.R7$(),t.Y8G("ngIf",!a.loading&&!a.error&&a.quote),t.R7$(),t.Y8G("ngIf",a.showMarkLostModal))},dependencies:[l.YU,l.Sq,l.bT,_.me,_.BC,_.vS,p.w,u.N,W.j],styles:[".corner-ribbon[_ngcontent-%COMP%]{position:absolute;top:12px;right:-46px;z-index:50;background:#c0392b;color:#fff;padding:8px 80px;transform:rotate(45deg);box-shadow:0 2px 6px #00000026;font-weight:700;letter-spacing:1px;text-transform:uppercase;border-radius:2px}"]})}}return r})();var w=s(9999);function ft(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())}),t.qSk(),t.j41(4,"svg",6),t.nrm(5,"path",7)(6,"path",8),t.k0s()(),t.joV(),t.j41(7,"div")(8,"h1",9),t.EFF(9,"Policy Details"),t.k0s(),t.j41(10,"p",10),t.EFF(11),t.k0s()()(),t.j41(12,"div",11)(13,"app-button",12),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.downloadPolicy())}),t.EFF(14,"Download PDF"),t.k0s(),t.j41(15,"app-button",13),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.renewPolicy())}),t.EFF(16,"Renew Policy"),t.k0s()()(),t.j41(17,"div",14)(18,"app-card",15)(19,"div",16)(20,"div")(21,"p",17),t.EFF(22,"Product"),t.k0s(),t.j41(23,"p",18),t.EFF(24),t.k0s()(),t.j41(25,"div")(26,"p",17),t.EFF(27,"Status"),t.k0s(),t.j41(28,"span",19),t.EFF(29),t.k0s()(),t.j41(30,"div")(31,"p",17),t.EFF(32,"Policy Number"),t.k0s(),t.j41(33,"p",18),t.EFF(34),t.k0s()()()(),t.j41(35,"app-card",20)(36,"div",16)(37,"div")(38,"p",17),t.EFF(39,"Start Date"),t.k0s(),t.j41(40,"p",18),t.EFF(41),t.k0s()(),t.j41(42,"div")(43,"p",17),t.EFF(44,"End Date"),t.k0s(),t.j41(45,"p",18),t.EFF(46),t.k0s()(),t.j41(47,"div")(48,"p",17),t.EFF(49,"Duration"),t.k0s(),t.j41(50,"p",18),t.EFF(51,"12 Months"),t.k0s()()()(),t.j41(52,"app-card",21)(53,"div",16)(54,"div")(55,"p",17),t.EFF(56,"Premium Amount"),t.k0s(),t.j41(57,"p",22),t.EFF(58),t.k0s()(),t.j41(59,"div")(60,"p",17),t.EFF(61,"Payment Status"),t.k0s(),t.j41(62,"span",19),t.EFF(63," Paid "),t.k0s()()()()(),t.j41(64,"app-card",23)(65,"div",24)(66,"div")(67,"h3",25),t.EFF(68,"Covered Items"),t.k0s(),t.j41(69,"ul",26)(70,"li",27),t.qSk(),t.j41(71,"svg",28),t.nrm(72,"path",29),t.k0s(),t.joV(),t.j41(73,"span",30),t.EFF(74,"Comprehensive Coverage"),t.k0s()(),t.j41(75,"li",27),t.qSk(),t.j41(76,"svg",28),t.nrm(77,"path",29),t.k0s(),t.joV(),t.j41(78,"span",30),t.EFF(79,"Third Party Liability"),t.k0s()(),t.j41(80,"li",27),t.qSk(),t.j41(81,"svg",28),t.nrm(82,"path",29),t.k0s(),t.joV(),t.j41(83,"span",30),t.EFF(84,"Personal Accident"),t.k0s()()()(),t.j41(85,"div")(86,"h3",25),t.EFF(87,"Policy Holder"),t.k0s(),t.j41(88,"div",26)(89,"p",30)(90,"span",31),t.EFF(91,"Name:"),t.k0s(),t.EFF(92),t.k0s(),t.j41(93,"p",30)(94,"span",31),t.EFF(95,"Email:"),t.k0s(),t.EFF(96),t.k0s(),t.j41(97,"p",30)(98,"span",31),t.EFF(99,"Phone:"),t.k0s(),t.EFF(100),t.k0s()()()()(),t.nrm(101,"app-chat-box",32),t.k0s()}if(2&r){const e=t.XpG();t.R7$(11),t.JRh(e.policy.policy_number),t.R7$(13),t.JRh(e.policy.product_name),t.R7$(5),t.SpI(" ",e.policy.status," "),t.R7$(5),t.JRh(e.policy.policy_number),t.R7$(7),t.JRh(e.policy.start_date),t.R7$(5),t.JRh(e.policy.end_date),t.R7$(12),t.SpI("$",e.policy.premium,""),t.R7$(34),t.SpI(" ",e.policy.customer_name,""),t.R7$(4),t.SpI(" ",e.policy.customer_email,""),t.R7$(4),t.SpI(" ",e.policy.customer_phone,""),t.R7$(),t.Y8G("modelName","insurance.policy")("recordId",e.policy.id)}}function _t(r,o){1&r&&(t.j41(0,"div",33),t.nrm(1,"app-loading-spinner",34),t.k0s()),2&r&&(t.R7$(),t.Y8G("loading",!0))}let xt=(()=>{class r{constructor(e,i,a){this.route=e,this.router=i,this.policyService=a,this.policyId="",this.policy=null,this.loading=!0}ngOnInit(){this.policyId=this.route.snapshot.params.id,this.loadPolicy()}loadPolicy(){this.policyService.getPolicy(parseInt(this.policyId)).subscribe({next:e=>{this.policy=e.data,this.loading=!1},error:e=>{console.error("Error loading policy:",e),this.loading=!1}})}goBack(){this.router.navigate(["/dashboard/customer/policies"])}downloadPolicy(){console.log("Downloading policy PDF...")}renewPolicy(){console.log("Renewing policy...")}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(d.nX),t.rXU(d.Ix),t.rXU(b.m))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-policy-details"]],decls:3,vars:2,consts:[["class","space-y-6",4,"ngIf"],["class","flex items-center justify-center h-96",4,"ngIf"],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"p-2","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5"],["d","m12 19-7-7 7-7"],["d","M19 12H5"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400"],[1,"flex","gap-3"],["variant","outline",3,"click"],["variant","primary",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["title","Policy Information"],[1,"space-y-3"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"inline-flex","px-2","py-1","text-xs","font-semibold","rounded-full","bg-green-100","text-green-800","dark:bg-green-900","dark:text-green-200"],["title","Coverage Period"],["title","Premium Details"],[1,"text-2xl","font-bold","text-primary"],["title","Coverage Details"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"font-semibold","text-gray-900","dark:text-white","mb-3"],[1,"space-y-2"],[1,"flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-green-500"],["d","M20 6 9 17l-5-5"],[1,"text-gray-700","dark:text-gray-300"],[1,"font-medium"],[3,"modelName","recordId"],[1,"flex","items-center","justify-center","h-96"],["message","Loading policy details...",3,"loading"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout"),t.DNE(1,ft,102,12,"div",0)(2,_t,2,1,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!a.loading&&a.policy),t.R7$(),t.Y8G("ngIf",a.loading))},dependencies:[l.bT,p.w,h.Q,v.i,u.N,w.f]})}}return r})();function bt(r,o){if(1&r&&(t.j41(0,"div")(1,"p",23),t.EFF(2,"Approved Amount"),t.k0s(),t.j41(3,"p",38),t.EFF(4),t.k0s()()),2&r){const e=t.XpG(2);t.R7$(4),t.SpI("$",e.claim.approved_amount,"")}}function yt(r,o){1&r&&(t.j41(0,"div",39),t.EFF(1," No documents uploaded yet "),t.k0s())}function vt(r,o){if(1&r&&(t.j41(0,"div",40)(1,"div",13),t.qSk(),t.j41(2,"svg",41),t.nrm(3,"path",42)(4,"path",43),t.k0s(),t.joV(),t.j41(5,"span",44),t.EFF(6),t.k0s()(),t.j41(7,"button",45),t.EFF(8,"Download"),t.k0s()()),2&r){const e=o.$implicit;t.R7$(6),t.JRh(e.name)}}function kt(r,o){if(1&r&&(t.j41(0,"div",46)(1,"div",47),t.nrm(2,"div",48)(3,"div",49),t.k0s(),t.j41(4,"div",50)(5,"p",24),t.EFF(6),t.k0s(),t.j41(7,"p",51),t.EFF(8),t.k0s(),t.j41(9,"p",52),t.EFF(10),t.k0s()()()),2&r){const e=o.$implicit;t.R7$(6),t.JRh(e.title),t.R7$(2),t.JRh(e.description),t.R7$(2),t.JRh(e.date)}}function Ft(r,o){if(1&r){const e=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"button",5),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.goBack())}),t.qSk(),t.j41(4,"svg",6),t.nrm(5,"path",7)(6,"path",8),t.k0s()(),t.joV(),t.j41(7,"div")(8,"h1",9),t.EFF(9,"Claim Details"),t.k0s(),t.j41(10,"p",10),t.EFF(11),t.k0s()()(),t.j41(12,"app-button",11),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.uploadDocument())}),t.EFF(13,"Upload Document"),t.k0s()(),t.j41(14,"div",12)(15,"div",13),t.qSk(),t.j41(16,"svg",14),t.nrm(17,"circle",15)(18,"path",16)(19,"path",17),t.k0s(),t.joV(),t.j41(20,"div")(21,"p",18),t.EFF(22),t.k0s(),t.j41(23,"p",19),t.EFF(24),t.k0s()()()(),t.j41(25,"div",20)(26,"app-card",21)(27,"div",22)(28,"div")(29,"p",23),t.EFF(30,"Claim Number"),t.k0s(),t.j41(31,"p",24),t.EFF(32),t.k0s()(),t.j41(33,"div")(34,"p",23),t.EFF(35,"Claim Type"),t.k0s(),t.j41(36,"p",24),t.EFF(37),t.k0s()(),t.j41(38,"div")(39,"p",23),t.EFF(40,"Date Filed"),t.k0s(),t.j41(41,"p",24),t.EFF(42),t.k0s()()()(),t.j41(43,"app-card",25)(44,"div",22)(45,"div")(46,"p",23),t.EFF(47,"Policy Number"),t.k0s(),t.j41(48,"p",24),t.EFF(49),t.k0s()(),t.j41(50,"div")(51,"p",23),t.EFF(52,"Product"),t.k0s(),t.j41(53,"p",24),t.EFF(54),t.k0s()()()(),t.j41(55,"app-card",26)(56,"div",22)(57,"div")(58,"p",23),t.EFF(59,"Claimed Amount"),t.k0s(),t.j41(60,"p",27),t.EFF(61),t.k0s()(),t.DNE(62,bt,5,1,"div",28),t.k0s()()(),t.j41(63,"app-card",29)(64,"p",30),t.EFF(65),t.k0s()(),t.j41(66,"app-card",31)(67,"div",22),t.DNE(68,yt,2,0,"div",32)(69,vt,9,1,"div",33),t.k0s()(),t.j41(70,"app-card",34)(71,"div",35),t.DNE(72,kt,11,3,"div",36),t.k0s()(),t.nrm(73,"app-chat-box",37),t.k0s()}if(2&r){const e=t.XpG();t.R7$(11),t.JRh(e.claim.claim_number),t.R7$(3),t.Y8G("ngClass",e.getStatusColor(e.claim.status)),t.R7$(8),t.SpI("Claim Status: ",e.claim.status,""),t.R7$(2),t.SpI("Last updated: ",e.claim.updated_date,""),t.R7$(8),t.JRh(e.claim.claim_number),t.R7$(5),t.JRh(e.claim.claim_type),t.R7$(5),t.JRh(e.claim.claim_date),t.R7$(7),t.JRh(e.claim.policy_number),t.R7$(5),t.JRh(e.claim.product_name),t.R7$(7),t.SpI("$",e.claim.claim_amount,""),t.R7$(),t.Y8G("ngIf",e.claim.approved_amount),t.R7$(3),t.JRh(e.claim.description||"No description provided"),t.R7$(3),t.Y8G("ngIf",!e.claim.documents||0===e.claim.documents.length),t.R7$(),t.Y8G("ngForOf",e.claim.documents),t.R7$(3),t.Y8G("ngForOf",e.claim.timeline),t.R7$(),t.Y8G("modelName","insurance.claim")("recordId",e.claim.id)}}function Ct(r,o){1&r&&(t.j41(0,"div",53),t.nrm(1,"app-loading-spinner",54),t.k0s()),2&r&&(t.R7$(),t.Y8G("loading",!0))}let jt=(()=>{class r{constructor(e,i,a){this.route=e,this.router=i,this.claimService=a,this.claimId="",this.claim=null,this.loading=!0}ngOnInit(){this.claimId=this.route.snapshot.params.id,this.loadClaim()}loadClaim(){this.claimService.getClaim(parseInt(this.claimId)).subscribe({next:e=>{this.claim=e.data,this.loading=!1},error:e=>{console.error("Error loading claim:",e),this.loading=!1}})}goBack(){this.router.navigate(["/dashboard/customer/claims"])}uploadDocument(){console.log("Uploading document...")}getStatusColor(e){return{pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",approved:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",rejected:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",in_progress:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}[e?.toLowerCase()]||"bg-gray-100 text-gray-800"}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(d.nX),t.rXU(d.Ix),t.rXU(y.q))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-claim-details"]],decls:3,vars:2,consts:[["class","space-y-6",4,"ngIf"],["class","flex items-center justify-center h-96",4,"ngIf"],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],[1,"p-2","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5"],["d","m12 19-7-7 7-7"],["d","M19 12H5"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400"],["variant","primary",3,"click"],[1,"p-4","rounded-lg",3,"ngClass"],[1,"flex","items-center","gap-3"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-6","w-6"],["cx","12","cy","12","r","10"],["d","M12 16v-4"],["d","M12 8h.01"],[1,"font-semibold"],[1,"text-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["title","Claim Information"],[1,"space-y-3"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold","text-gray-900","dark:text-white"],["title","Policy Details"],["title","Claim Amount"],[1,"text-2xl","font-bold","text-primary"],[4,"ngIf"],["title","Claim Description"],[1,"text-gray-700","dark:text-gray-300"],["title","Uploaded Documents"],["class","text-center py-8 text-gray-500 dark:text-gray-400",4,"ngIf"],["class","flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",4,"ngFor","ngForOf"],["title","Claim Timeline"],[1,"space-y-4"],["class","flex gap-4",4,"ngFor","ngForOf"],[3,"modelName","recordId"],[1,"text-xl","font-bold","text-green-600"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","dark:bg-gray-700","rounded-lg"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-gray-500"],["d","M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"],["d","M14 2v4a2 2 0 0 0 2 2h4"],[1,"text-gray-900","dark:text-white"],[1,"text-primary","hover:underline"],[1,"flex","gap-4"],[1,"flex","flex-col","items-center"],[1,"w-3","h-3","rounded-full","bg-primary"],[1,"w-0.5","h-full","bg-gray-300","dark:bg-gray-600"],[1,"pb-4"],[1,"text-sm","text-gray-600","dark:text-gray-400"],[1,"text-xs","text-gray-500","dark:text-gray-500","mt-1"],[1,"flex","items-center","justify-center","h-96"],["message","Loading claim details...",3,"loading"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout"),t.DNE(1,Ft,74,17,"div",0)(2,Ct,2,1,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!a.loading&&a.claim),t.R7$(),t.Y8G("ngIf",a.loading))},dependencies:[l.YU,l.Sq,l.bT,p.w,h.Q,v.i,u.N,w.f]})}}return r})();var Et=s(621),wt=s(4815);function Rt(r,o){if(1&r&&(t.j41(0,"div",13),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function St(r,o){1&r&&(t.j41(0,"div",14),t.nrm(1,"app-loading-spinner"),t.k0s())}function It(r,o){if(1&r){const e=t.RV6();t.j41(0,"app-dynamic-table-with-filters",15),t.bIt("filteredDataChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onFilteredDataChange(a))})("exportData",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onExport())})("action",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.handleTableAction(a))}),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("data",e.data)("columns",e.columns)("showExport",!0)("maxSelectOptions",10)}}function Tt(r,o){if(1&r){const e=t.RV6();t.j41(0,"app-pagination",16),t.bIt("pageChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onPageChange(a))})("pageSizeChange",function(a){t.eBV(e);const n=t.XpG();return t.Njj(n.onPageSizeChange(a))}),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("currentPage",e.currentPage)("pageSize",e.pageSize)("totalRecords",e.totalRecords)}}let Dt=(()=>{class r{constructor(e,i,a,n,c){this.router=e,this.brokerService=i,this.authService=a,this.notificationService=n,this.appTranslate=c,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.currentPage=1,this.pageSize=25,this.totalRecords=0,this.paymentStatus="paid",this.setupColumns()}ngOnInit(){this.loadPayments()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"id",label:"Payment ID",filterable:!0,filterType:"text"},{key:"policyNumber",label:"Policy No",filterable:!0,filterType:"text"},{key:"partnerName",label:"Customer Name",filterable:!0,filterType:"text"},{key:"productName",label:"Product",filterable:!0},{key:"premiumAmount",label:"Amount",filterable:!1,render:e=>`<span class="font-medium text-gray-900 dark:text-gray-100">$${e.premiumAmount?e.premiumAmount.toLocaleString():"0"}</span>`},{key:"paymentStatus",label:"Status",filterable:!0,render:e=>this.renderStatus(e.paymentStatus)},{key:"date",label:"Date",filterable:!0,filterType:"date"},{key:"actions",label:"Actions",filterable:!1,render:e=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${e.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(e){const i=e?.toLowerCase()||"outstanding";let a="";return a=["completed","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","outstanding"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${a}">${e}</span>`}loadPayments(){this.isLoading=!0,this.error=null;const e=this.authService.currentUserValue;if(!e||!e.id)return this.error="ERROR.USER_NOT_FOUND",this.isLoading=!1,void this.notificationService.error(this.appTranslate.instant("ERROR.USER_NOT_FOUND"));const i=e.id,a=(this.currentPage-1)*this.pageSize;this.brokerService.getPremiums(i,this.paymentStatus).subscribe({next:n=>{n.result?.data?(this.totalRecords=n.result.data.length,this.brokerService.getPremiums(i,this.paymentStatus,this.pageSize,a).subscribe({next:c=>{this.data=c.result?.data?this.mapPaymentData(c.result.data):[],this.isLoading=!1},error:c=>{this.handleError(c)}})):(this.data=[],this.totalRecords=0,this.isLoading=!1)},error:n=>{this.handleError(n)}})}mapPaymentData(e){return e.map(i=>({id:i.id||"",policyNumber:i.policy_number||"N/A",partnerName:i.partner_name||"N/A",productName:i.product_name||"N/A",premiumAmount:i.premium_amount||0,paymentStatus:i.payment_status||"outstanding",date:i.date||i.create_date||"N/A"}))}handleError(e){console.error("Error loading payments:",e);const i=e?.error?.error?.message||e?.message||"";if(i.includes("No premiums found")||i.includes("No payment"))return this.data=[],this.totalRecords=0,void(this.isLoading=!1);this.error="ERROR.LOADING_DATA",this.isLoading=!1,this.notificationService.error(this.appTranslate.instant("ERROR.LOADING_DATA"),i||this.appTranslate.instant("ERROR.GENERIC"))}onFilteredDataChange(e){this.filteredData=e}handleTableAction(e){console.log("Action",e.action,e.data)}onExport(){console.log("Exporting payments...")}onPageChange(e){this.currentPage=e,this.loadPayments()}onPageSizeChange(e){this.pageSize=e,this.currentPage=1,this.loadPayments()}static{this.\u0275fac=function(i){return new(i||r)(t.rXU(d.Ix),t.rXU(Et.d),t.rXU(g.u),t.rXU(E.J),t.rXU(C.F))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-customer-payments"]],decls:21,vars:13,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],["variant","primary"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-4","w-4","mr-2"],["width","20","height","14","x","2","y","5","rx","2"],["d","M2 10h20"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,a){1&i&&(t.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div")(4,"h1",2),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"app-button",4),t.qSk(),t.j41(11,"svg",5),t.nrm(12,"rect",6)(13,"path",7),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.joV(),t.j41(16,"div",8),t.DNE(17,Rt,2,1,"div",9)(18,St,2,0,"div",10)(19,It,1,4,"app-dynamic-table-with-filters",11)(20,Tt,1,3,"app-pagination",12),t.k0s()()()),2&i&&(t.R7$(5),t.SpI("",t.bMT(6,7,"CUSTOMER.PAYMENTS.TITLE")," "),t.R7$(3),t.JRh(t.bMT(9,9,"CUSTOMER.PAYMENTS.SUBTITLE")),t.R7$(6),t.SpI(" ",t.bMT(15,11,"CUSTOMER.PAYMENTS.MAKE_PAYMENT")," "),t.R7$(3),t.Y8G("ngIf",a.error),t.R7$(),t.Y8G("ngIf",a.isLoading),t.R7$(),t.Y8G("ngIf",!a.isLoading&&!a.error),t.R7$(),t.Y8G("ngIf",!a.isLoading&&!a.error&&a.totalRecords>0))},dependencies:[l.bT,p.w,h.Q,u.N,x.u,wt.e,f.D9]})}}return r})();var $t=s(1855),Nt=s(2780),Mt=s(1979);const At=[{path:"",component:G},{path:"policies",component:X},{path:"policies/:id",component:xt},{path:"claims",component:Q},{path:"claims/:id",component:jt},{path:"quotations",component:K},{path:"quotations/:id",component:ht},{path:"payments",component:Dt},{path:"profile",component:$t.n},{path:"settings",component:Nt.b},{path:"claims/new",component:Mt.M}];let Pt=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=t.$C({type:r})}static{this.\u0275inj=t.G2t({imports:[d.iI.forChild(At),d.iI]})}}return r})();var Lt=s(217);let Gt=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=t.$C({type:r})}static{this.\u0275inj=t.G2t({imports:[l.MD,_.YN,Pt,Lt.G]})}}return r})()}}]);