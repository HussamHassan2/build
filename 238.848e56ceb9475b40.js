"use strict";(self.webpackChunkinsurance_portal=self.webpackChunkinsurance_portal||[]).push([[238],{5238:(Ia,J,_)=>{_.r(J),_.d(J,{BrokerModule:()=>Ca});var m=_(177),u=_(9417),h=_(9984),ee=_(7468),e=_(4438),y=_(8010),w=_(2166),j=_(5740),v=_(9989),H=_(9947),b=_(467),te=_(2451),A=_(5680),C=_(5567),q=_(3374);const re=(a,n)=>({"border-primary bg-blue-50":a,"border-gray-200 hover:border-gray-300":n}),ie=(a,n)=>({"bg-primary text-white":a,"bg-gray-100":n});function ae(a,n){if(1&a){const t=e.RV6();e.j41(0,"form",11),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onSubmitNewCustomer())}),e.j41(1,"div",12)(2,"div")(3,"label",13),e.EFF(4,"Full Name *"),e.k0s(),e.nrm(5,"input",14),e.k0s(),e.j41(6,"div")(7,"label",13),e.EFF(8,"National ID *"),e.k0s(),e.nrm(9,"input",15),e.k0s(),e.j41(10,"div"),e.nrm(11,"app-date-picker",16),e.k0s(),e.j41(12,"div")(13,"label",13),e.EFF(14,"Gender"),e.k0s(),e.j41(15,"select",17)(16,"option",18),e.EFF(17,"Male"),e.k0s(),e.j41(18,"option",19),e.EFF(19,"Female"),e.k0s()()(),e.j41(20,"div")(21,"label",13),e.EFF(22,"Email Address *"),e.k0s(),e.nrm(23,"input",20),e.k0s(),e.j41(24,"div")(25,"label",13),e.EFF(26,"Phone Number *"),e.k0s(),e.nrm(27,"input",21),e.k0s(),e.j41(28,"div")(29,"label",13),e.EFF(30,"Street"),e.k0s(),e.nrm(31,"input",22),e.k0s(),e.j41(32,"div")(33,"label",13),e.EFF(34,"City"),e.k0s(),e.nrm(35,"input",23),e.k0s()(),e.j41(36,"div",24)(37,"button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onBack())}),e.EFF(38,"Back"),e.k0s(),e.j41(39,"button",26),e.EFF(40),e.k0s()()()}if(2&a){const t=e.XpG(2);e.Y8G("formGroup",t.newCustomerForm),e.R7$(39),e.Y8G("disabled",t.loading||t.newCustomerForm.invalid),e.R7$(),e.SpI(" ",t.loading?"Creating...":"Continue"," ")}}function oe(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",42)(1,"label",43)(2,"input",44),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(3);return e.DH7(o.searchIsForeign,r)||(o.searchIsForeign=r),e.Njj(r)}),e.k0s(),e.nrm(3,"div",45),e.j41(4,"span",46),e.EFF(5,"Is Foreign Customer?"),e.k0s()()()}if(2&a){const t=e.XpG(3);e.R7$(2),e.R50("ngModel",t.searchIsForeign)}}function ne(a,n){if(1&a&&(e.j41(0,"span",61),e.EFF(1),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ID: ",t.national_id," ")}}function se(a,n){if(1&a&&(e.j41(0,"div",62),e.qSk(),e.j41(1,"svg",63),e.nrm(2,"path",64),e.k0s(),e.joV(),e.j41(3,"span",65),e.EFF(4),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.email)}}function le(a,n){if(1&a&&(e.j41(0,"div",66),e.qSk(),e.j41(1,"svg",63),e.nrm(2,"path",67),e.k0s(),e.joV(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.phone||t.mobile)}}function de(a,n){if(1&a&&(e.j41(0,"div",66),e.qSk(),e.j41(1,"svg",63),e.nrm(2,"path",68),e.k0s(),e.joV(),e.j41(3,"span"),e.EFF(4),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.date_of_birth)}}function ce(a,n){if(1&a&&(e.j41(0,"div",69),e.qSk(),e.j41(1,"svg",63),e.nrm(2,"path",70)(3,"path",71),e.k0s(),e.joV(),e.j41(4,"span",65),e.EFF(5),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(5),e.E5c("",t.city,"",t.state_name?", "+t.state_name:"","",t.country_name?", "+t.country_name:"","")}}function pe(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",49),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(4);return e.Njj(o.onSelectExistingCustomer(r))}),e.j41(1,"div",50),e.qSk(),e.j41(2,"svg",51),e.nrm(3,"path",52),e.k0s()(),e.joV(),e.j41(4,"div",53)(5,"div",54)(6,"h3",55),e.EFF(7),e.k0s(),e.DNE(8,ne,2,1,"span",56),e.k0s(),e.j41(9,"div",57),e.DNE(10,se,5,1,"div",58)(11,le,5,1,"div",59)(12,de,5,1,"div",59)(13,ce,6,3,"div",60),e.k0s()()()}if(2&a){const t=n.$implicit,i=e.XpG(4);e.Y8G("ngClass",e.l_i(8,re,(null==i.selectedCustomer?null:i.selectedCustomer.national_id)===t.national_id,(null==i.selectedCustomer?null:i.selectedCustomer.national_id)!==t.national_id)),e.R7$(),e.Y8G("ngClass",e.l_i(11,ie,(null==i.selectedCustomer?null:i.selectedCustomer.national_id)===t.national_id,(null==i.selectedCustomer?null:i.selectedCustomer.national_id)!==t.national_id)),e.R7$(6),e.JRh(t.english_name||t.arabic_name),e.R7$(),e.Y8G("ngIf",t.national_id),e.R7$(2),e.Y8G("ngIf",t.email),e.R7$(),e.Y8G("ngIf",t.phone||t.mobile),e.R7$(),e.Y8G("ngIf",t.date_of_birth),e.R7$(),e.Y8G("ngIf",t.city||t.state_name||t.country_name)}}function ue(a,n){if(1&a&&(e.j41(0,"div",47),e.DNE(1,pe,14,14,"div",48),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.searchResults)}}function me(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",72)(1,"div",73)(2,"p",74),e.EFF(3,"Customer not found"),e.k0s(),e.j41(4,"p",75),e.EFF(5),e.k0s()(),e.j41(6,"div",76),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.onSelectType("new"))}),e.j41(7,"div",77)(8,"div",78),e.qSk(),e.j41(9,"svg",51),e.nrm(10,"path",79),e.k0s()(),e.joV(),e.j41(11,"div",80)(12,"h3",81),e.EFF(13,"Create New Customer"),e.k0s(),e.j41(14,"p",82),e.EFF(15,"Add a new customer profile "),e.k0s()()()()()}if(2&a){const t=e.XpG(3);e.R7$(5),e.SpI("We couldn't find a customer matching \"",t.searchQuery,'"')}}function ge(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",27)(1,"div")(2,"label",13),e.EFF(3,"Search Existing Customer"),e.k0s(),e.j41(4,"div",28)(5,"div",29)(6,"label",30)(7,"input",31),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.searchCustomerType,r)||(o.searchCustomerType=r),e.Njj(r)}),e.bIt("change",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.searchIsForeign=!1)}),e.k0s(),e.j41(8,"span",32),e.EFF(9,"Individual"),e.k0s()(),e.j41(10,"label",30)(11,"input",33),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.searchCustomerType,r)||(o.searchCustomerType=r),e.Njj(r)}),e.bIt("change",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.searchIsForeign=!1)}),e.k0s(),e.j41(12,"span",32),e.EFF(13,"Company"),e.k0s()()(),e.DNE(14,oe,6,1,"div",34),e.k0s(),e.j41(15,"div",35)(16,"input",36),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.searchQuery,r)||(o.searchQuery=r),e.Njj(r)}),e.bIt("keyup.enter",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onSearch())}),e.k0s(),e.j41(17,"button",37),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onSearch())}),e.EFF(18),e.k0s()()(),e.DNE(19,ue,2,1,"div",38)(20,me,16,1,"div",39),e.j41(21,"div",40)(22,"button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onClose())}),e.EFF(23,"Cancel"),e.k0s(),e.j41(24,"button",41),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onConfirmSelection())}),e.EFF(25," Continue "),e.k0s()()()}if(2&a){const t=e.XpG(2);e.R7$(7),e.R50("ngModel",t.searchCustomerType),e.R7$(4),e.R50("ngModel",t.searchCustomerType),e.R7$(3),e.Y8G("ngIf","individual"===t.searchCustomerType),e.R7$(2),e.R50("ngModel",t.searchQuery),e.Y8G("placeholder",t.searchPlaceholder),e.R7$(),e.Y8G("disabled",t.loading),e.R7$(),e.SpI(" ",t.loading?"Searching...":"Search"," "),e.R7$(),e.Y8G("ngIf",t.searchResults.length>0),e.R7$(),e.Y8G("ngIf",t.hasSearched&&0===t.searchResults.length&&!t.loading),e.R7$(4),e.Y8G("disabled",!t.selectedCustomer)}}function _e(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),e.EFF(4),e.k0s(),e.j41(5,"button",5),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onClose())}),e.qSk(),e.j41(6,"svg",6),e.nrm(7,"path",7),e.k0s()()(),e.joV(),e.j41(8,"div",8),e.DNE(9,ae,41,3,"form",9)(10,ge,26,10,"div",10),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(4),e.SpI(" ","new-customer"===t.currentView?"New Customer":"Select Customer"," "),e.R7$(5),e.Y8G("ngIf","new-customer"===t.currentView),e.R7$(),e.Y8G("ngIf","select-customer"===t.currentView)}}let M=(()=>{class a{get searchPlaceholder(){return"company"===this.searchCustomerType?"Search with Tax ID":this.searchIsForeign?"Search with Passport Number":"Search with National ID"}constructor(t,i,r,o){this.fb=t,this.customerService=i,this.authService=r,this.notificationService=o,this.isOpen=!1,this.prefilledNationalId="",this.close=new e.bkB,this.selectCustomer=new e.bkB,this.currentView="select-customer",this.searchResults=[],this.selectedCustomer=null,this.loading=!1,this.hasSearched=!1,this.searchQuery="",this.searchCustomerType="individual",this.searchIsForeign=!1}ngOnInit(){this.initializeForm(),this.checkForPrefilledData()}checkForPrefilledData(){this.prefilledNationalId&&this.prefilledNationalId.trim()&&(this.searchQuery=this.prefilledNationalId,setTimeout(()=>{this.onSearch()},100))}initializeForm(){this.newCustomerForm=this.fb.group({name:["",u.k0.required],email:["",[u.k0.required,u.k0.email]],phone:["",u.k0.required],nationalId:["",u.k0.required],dateOfBirth:[""],gender:["male"],isForeignCustomer:[!1],passportId:[""],street:[""],city:[""],stateName:[""],countryName:["Egypt"]}),this.newCustomerForm.get("nationalId")?.valueChanges.subscribe(t=>{if(t){const i=(0,te._)(t);i&&this.newCustomerForm.patchValue({dateOfBirth:i},{emitEvent:!1})}})}onSelectType(t){"new"===t?(this.currentView="new-customer",this.searchQuery&&(/^\d+$/.test(this.searchQuery)?this.newCustomerForm.patchValue({nationalId:this.searchQuery}):this.newCustomerForm.patchValue({name:this.searchQuery}))):this.currentView="select-customer"}onBack(){"new-customer"===this.currentView?this.currentView="select-customer":this.onClose()}onSubmitNewCustomer(){var t=this;return(0,b.A)(function*(){if(!t.newCustomerForm.invalid){t.loading=!0;try{const i=t.newCustomerForm.value,o={user_id:t.authService.currentUserValue?.id||2,user_type:"broker",english_name:i.name,email:i.email,phone:t.formatPhoneForAPI(i.phone),mobile:t.formatPhoneForAPI(i.phone),national_id:i.nationalId,date_of_birth:i.dateOfBirth||"",gender:i.gender,is_foreign_customer:i.isForeignCustomer,passport_id:i.passportId||"",street:i.street||"",city:i.city||"",state_name:i.stateName||"",country_name:i.countryName||"Egypt"},s=yield t.customerService.createPartner(o).toPromise(),l=s?.result?.data||s?.data||s;t.selectCustomer.emit({clientId:l.id||l.national_id,clientName:i.name,name:i.name,email:i.email,phone:i.phone,nationalId:i.nationalId,dateOfBirth:i.dateOfBirth,gender:i.gender,isForeignCustomer:i.isForeignCustomer,passportId:i.passportId,street:i.street,city:i.city,stateName:i.stateName,countryName:i.countryName}),t.onClose()}catch(i){console.error("Failed to create customer",i)}finally{t.loading=!1}}})()}onSearch(){var t=this;return(0,b.A)(function*(){if(t.searchQuery.trim()){t.loading=!0,t.searchResults=[],t.hasSearched=!0;try{const i=t.authService.currentUserValue,r={identification_number:t.searchQuery,user_id:i?.id||2,user_type:"broker",is_foreign_customer:t.searchIsForeign},o=yield t.customerService.searchPartners(r).toPromise(),s=o?.result?.data||o?.data||o;let l=[];Array.isArray(s)?l=s:s?.contacts&&Array.isArray(s.contacts)?l=s.contacts:s&&(s.national_id||s.id||s.english_name)&&(l=[s]),t.searchResults=l}catch(i){console.error("Failed to search customers",i)}finally{t.loading=!1}}else t.notificationService.warning("Please enter a search term")})()}onSelectExistingCustomer(t){this.selectedCustomer=t}onConfirmSelection(){this.selectedCustomer?(this.selectCustomer.emit({clientId:this.selectedCustomer.national_id||this.selectedCustomer.id,clientName:this.selectedCustomer.english_name||this.selectedCustomer.arabic_name,name:this.selectedCustomer.english_name||this.selectedCustomer.arabic_name,email:this.selectedCustomer.email,phone:this.selectedCustomer.phone||this.selectedCustomer.mobile,nationalId:this.selectedCustomer.national_id,dateOfBirth:this.selectedCustomer.date_of_birth,gender:this.selectedCustomer.gender,isForeignCustomer:this.selectedCustomer.is_foreign_customer,passportId:this.selectedCustomer.passport_id,street:this.selectedCustomer.street,city:this.selectedCustomer.city,stateName:this.selectedCustomer.state_name,countryName:this.selectedCustomer.country_name}),this.onClose()):this.notificationService.warning("Please select a customer")}onClose(){this.isOpen=!1,this.currentView="select-customer",this.searchResults=[],this.selectedCustomer=null,this.searchQuery="",this.hasSearched=!1,this.newCustomerForm.reset({gender:"male",isForeignCustomer:!1,countryName:"Egypt"}),this.searchCustomerType="individual",this.searchIsForeign=!1,this.close.emit()}formatPhoneForAPI(t){if(!t)return"";const i=t.replace(/\D/g,"");return i.startsWith("0")?"+20"+i.substring(1):i.startsWith("+")?i:"+20"+i}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(u.ok),e.rXU(A.m),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-customer-selection-modal"]],inputs:{isOpen:"isOpen",prefilledNationalId:"prefilledNationalId"},outputs:{close:"close",selectCustomer:"selectCustomer"},decls:1,vars:1,consts:[["class","fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-xl","w-full","max-w-2xl","overflow-hidden"],[1,"p-6","border-b","border-gray-100","dark:border-gray-700","flex","justify-between","items-center"],[1,"text-xl","font-bold","text-navy","dark:text-white"],[1,"text-gray-400","hover:text-gray-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6"],["class","space-y-6",3,"formGroup","ngSubmit",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["formControlName","name","type","text","placeholder","Enter customer name","required","",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["formControlName","nationalId","type","text","placeholder","14 digits","required","",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["formControlName","dateOfBirth","label","Date of Birth"],["formControlName","gender",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["value","male"],["value","female"],["formControlName","email","type","email","placeholder","customer@example.com","required","",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["formControlName","phone","type","tel","placeholder","01012345678","required","",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["formControlName","street","type","text","placeholder","Street address",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],["formControlName","city","type","text","placeholder","City",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100"],[1,"flex","justify-between","pt-4"],["type","button",1,"px-4","py-2","text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-lg","transition-colors",3,"click"],["type","submit",1,"px-6","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary-dark","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"space-y-6"],[1,"mb-4","space-y-3"],[1,"flex","items-center","gap-6"],[1,"inline-flex","items-center"],["type","radio","name","customerType","value","individual",1,"form-radio","text-primary",3,"ngModelChange","change","ngModel"],[1,"ml-2","text-gray-700","dark:text-gray-300"],["type","radio","name","customerType","value","company",1,"form-radio","text-primary",3,"ngModelChange","change","ngModel"],["class","flex items-center",4,"ngIf"],[1,"flex","gap-2"],["type","text",1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary/20","focus:border-primary","bg-white","dark:bg-gray-700","text-gray-900","dark:text-gray-100",3,"ngModelChange","keyup.enter","ngModel","placeholder"],["type","button",1,"px-6","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary-dark","transition-colors","disabled:opacity-50",3,"click","disabled"],["class","space-y-3 max-h-60 overflow-y-auto",4,"ngIf"],["class","animate-fade-in text-center py-4",4,"ngIf"],[1,"flex","justify-between","pt-4","border-t","border-gray-100","dark:border-gray-700"],["type","button",1,"px-6","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary-dark","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","items-center"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","ngModel"],[1,"w-11","h-6","bg-gray-200","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-blue-300","dark:peer-focus:ring-blue-800","rounded-full","peer","dark:bg-gray-700","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","dark:border-gray-600","peer-checked:bg-blue-600"],[1,"ml-3","text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"space-y-3","max-h-60","overflow-y-auto"],["class","border-2 rounded-xl p-4 cursor-pointer flex items-center gap-4 transition-all",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"border-2","rounded-xl","p-4","cursor-pointer","flex","items-center","gap-4","transition-all",3,"click","ngClass"],[1,"w-10","h-10","rounded-full","flex","items-center","justify-center",3,"ngClass"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"flex-1"],[1,"flex","justify-between","items-start","mb-1"],[1,"font-bold","text-navy","dark:text-white","text-base"],["class","text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded-md font-medium border border-blue-100",4,"ngIf"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-x-4","gap-y-1.5","text-sm","text-gray-600","dark:text-gray-300"],["class","flex items-center gap-1.5 text-xs truncate",4,"ngIf"],["class","flex items-center gap-1.5 text-xs",4,"ngIf"],["class","flex items-center gap-1.5 text-xs col-span-1 sm:col-span-2 truncate",4,"ngIf"],[1,"text-xs","bg-blue-50","text-blue-700","px-2","py-1","rounded-md","font-medium","border","border-blue-100"],[1,"flex","items-center","gap-1.5","text-xs","truncate"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"truncate"],[1,"flex","items-center","gap-1.5","text-xs"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"flex","items-center","gap-1.5","text-xs","col-span-1","sm:col-span-2","truncate"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"],[1,"animate-fade-in","text-center","py-4"],[1,"mb-4","text-gray-500"],[1,"text-base","font-medium"],[1,"text-sm"],[1,"border-2","rounded-xl","p-4","cursor-pointer","transition-all","hover:border-green-500","border-dashed","border-gray-300","bg-gray-50","hover:bg-green-50","group",3,"click"],[1,"flex","items-center","gap-4","justify-center"],[1,"w-10","h-10","rounded-full","flex","items-center","justify-center","bg-gray-200","text-gray-500","group-hover:bg-green-500","group-hover:text-white","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"],[1,"text-left"],[1,"font-bold","text-gray-700","group-hover:text-green-800","text-base"],[1,"text-xs","text-gray-500","group-hover:text-green-700"]],template:function(i,r){1&i&&e.DNE(0,_e,11,3,"div",0),2&i&&e.Y8G("ngIf",r.isOpen)},dependencies:[m.YU,m.Sq,m.bT,u.qT,u.xH,u.y7,u.me,u.Zm,u.wz,u.Fm,u.BC,u.cb,u.YS,u.vS,u.j4,u.JD,q.I]})}}return a})();var $=_(4644),he=_(2612);function fe(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),e.EFF(4,"Intimate Claim"),e.k0s(),e.j41(5,"button",5),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onClose())}),e.qSk(),e.j41(6,"svg",6),e.nrm(7,"path",7),e.k0s()()(),e.joV(),e.j41(8,"div",8)(9,"div",9)(10,"p",10),e.EFF(11," Enter the vehicle chassis number to validate the policy and proceed with claim intimation. "),e.k0s(),e.j41(12,"app-text-input",11),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.lossDate,r)||(o.lossDate=r),e.Njj(r)}),e.k0s(),e.j41(13,"app-text-input",12),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.chassisNumber,r)||(o.chassisNumber=r),e.Njj(r)}),e.bIt("keyup.enter",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onValidate())}),e.k0s()(),e.j41(14,"div",13)(15,"button",14),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onClose())}),e.EFF(16," Cancel "),e.k0s(),e.j41(17,"button",15),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onValidate())}),e.EFF(18),e.k0s()()()()()}if(2&a){const t=e.XpG();e.R7$(12),e.R50("ngModel",t.lossDate),e.Y8G("required",!0)("max",t.maxDate),e.R7$(),e.R50("ngModel",t.chassisNumber),e.Y8G("required",!0),e.R7$(4),e.Y8G("disabled",t.loading||!t.chassisNumber.trim()||!t.lossDate),e.R7$(),e.SpI(" ",t.loading?"Validating...":"Continue"," ")}}let G=(()=>{class a{constructor(t,i,r,o){this.router=t,this.claimService=i,this.authService=r,this.notificationService=o,this.isOpen=!1,this.close=new e.bkB,this.chassisNumber="",this.lossDate="",this.maxDate=(new Date).toISOString().split("T")[0],this.loading=!1}onClose(){this.chassisNumber="",this.lossDate="",this.isOpen=!1,this.close.emit()}onValidate(){if(!this.chassisNumber.trim()||!this.lossDate)return void this.notificationService.error("Please enter all required fields");this.loading=!0;const t=this.authService.currentUserValue?.id||2,i=this.lossDate instanceof Date?this.lossDate.toISOString().split("T")[0]:this.lossDate;this.claimService.checkRiskAvailability(this.chassisNumber,t,i).subscribe({next:r=>{const o=r.result?.data||r.data||r.result||r;o&&"error"!==o.status&&!1!==o.available?(this.router.navigate(["/dashboard/broker/claims/new"],{queryParams:{chassis:this.chassisNumber,loss_date:i},state:{riskData:o}}),this.onClose()):this.notificationService.error(o.message||"Chassis validation failed. No active policy found."),this.loading=!1},error:r=>{console.error("Failed to validate chassis:",r),this.notificationService.error(r.error?.message||r.message||"Failed to validate chassis number. Please check if the policy is active."),this.loading=!1}})}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.Ix),e.rXU($.q),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-chassis-validation-modal"]],inputs:{isOpen:"isOpen"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm","p-4"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-xl","w-full","max-w-md","overflow-hidden"],[1,"p-6","border-b","border-gray-100","dark:border-gray-700","flex","justify-between","items-center"],[1,"text-xl","font-bold","text-navy","dark:text-white"],[1,"text-gray-400","hover:text-gray-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6"],[1,"mb-6"],[1,"text-gray-600","dark:text-gray-300","mb-4"],["label","Date of Loss","type","date",3,"ngModelChange","ngModel","required","max"],["label","Chassis Number","placeholder","Enter chassis number",3,"ngModelChange","keyup.enter","ngModel","required"],[1,"flex","justify-end","gap-3"],["type","button",1,"px-4","py-2","text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-lg","transition-colors",3,"click"],["type","button",1,"px-6","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary-dark","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(i,r){1&i&&e.DNE(0,fe,19,7,"div",0),2&i&&e.Y8G("ngIf",r.isOpen)},dependencies:[m.bT,u.BC,u.YS,u.vS,he.f]})}}return a})();var x=_(4842);const be=()=>["week","month","year"];function ye(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",61),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.setSelectedPeriod(r))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&a){const t=n.$implicit,i=e.XpG();e.AVh("bg-primary",i.selectedPeriod===t)("text-white",i.selectedPeriod===t)("bg-gray-100",i.selectedPeriod!==t),e.R7$(),e.SpI(" ",e.bMT(2,7,"BROKER.DASHBOARD.PERFORMANCE."+t.toUpperCase())," ")}}function ve(a,n){1&a&&(e.j41(0,"div",62),e.nrm(1,"i",63),e.j41(2,"p",64),e.EFF(3),e.nI1(4,"translate"),e.k0s()()),2&a&&(e.R7$(3),e.JRh(e.bMT(4,1,"BROKER.DASHBOARD.PERFORMANCE.NO_DATA")))}function xe(a,n){if(1&a&&(e.j41(0,"div",65)(1,"div",66)(2,"div",67),e.nrm(3,"i",68),e.k0s(),e.j41(4,"div")(5,"p",69),e.EFF(6),e.k0s(),e.j41(7,"p",34),e.EFF(8),e.nI1(9,"translate"),e.k0s()()(),e.j41(10,"div",70)(11,"p",71),e.EFF(12),e.k0s(),e.j41(13,"p",72),e.nrm(14,"i",73),e.EFF(15),e.k0s()()()),2&a){const t=n.$implicit;e.R7$(6),e.JRh(t.name),e.R7$(2),e.Lme("",t.policies," ",e.bMT(9,5,"BROKER.DASHBOARD.PERFORMANCE.POLICIES"),""),e.R7$(4),e.JRh(t.revenue),e.R7$(3),e.SpI(" ",t.growth," ")}}let ke=(()=>{class a{constructor(t,i,r,o){this.authService=t,this.policyService=i,this.crmService=r,this.router=o,this.user=null,this.loading=!1,this.selectedPeriod="month",this.policies=[],this.opportunities=[],this.analytics={activePolicies:0,canceledPolicies:0,cancellationRate:0,totalClients:0,totalOpportunities:0,openOpportunities:0,conversionRate:0,totalPremium:0,totalCommissions:0},this.topPerformers=[],this.iconsRendered=!1,this.showChassisModal=!1,this.isCustomerModalOpen=!1}ngOnInit(){this.authService.currentUser.subscribe(t=>{t&&(this.user=t,this.fetchDashboardData())})}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}fetchDashboardData(){if(!this.user)return;this.loading=!0;const t=this.user.id||2,i=this.user.role||"broker",r=this.policyService.listPolicies({user_id:t,user_type:i,limit:1e3,offset:0,domain:[]}),o=this.crmService.listOpportunities({user_id:t,user_type:i,limit:1e3,offset:0,domain:[]});(0,ee.p)({policies:r,opportunities:o}).subscribe({next:s=>{const l=s.policies.result?.data||s.policies.data||s.policies||[];this.policies=Array.isArray(l)?l:[];const d=s.opportunities.result?.data||s.opportunities.data||s.opportunities||[];this.opportunities=Array.isArray(d)?d:[],this.calculateAnalytics(),this.calculateTopPerformers(),this.loading=!1},error:s=>{console.error("Error fetching dashboard data",s),this.loading=!1}})}calculateAnalytics(){const t=this.policies.filter(p=>"Active"===p.state||"Approved"===p.state).length,i=this.policies.filter(p=>["Cancelled","Cancel","Canceled"].includes(p.state)).length,r=this.policies.length>0?(i/this.policies.length*100).toFixed(1):"0",o=new Set(this.policies.map(p=>p.customer_name||p.customer_id).filter(Boolean)).size,s=this.opportunities.filter(p=>"Won"===p.stage_name).length,l=this.opportunities.length>0?(s/this.opportunities.length*100).toFixed(1):"0",d=this.policies.filter(p=>"Active"===p.state||"Approved"===p.state).reduce((p,f)=>p+(Number(f.net_premium)||0),0),g=this.opportunities.filter(p=>"Won"!==p.stage_name&&"Lost"!==p.stage_name).length;this.analytics={activePolicies:t,canceledPolicies:i,cancellationRate:Number(r),totalClients:o,totalOpportunities:this.opportunities.length,openOpportunities:g,conversionRate:Number(l),totalPremium:Math.round(d),totalCommissions:0}}calculateTopPerformers(){if(!this.policies.length)return;const t=new Date;let i=30;"week"===this.selectedPeriod&&(i=7),"year"===this.selectedPeriod&&(i=365);const r=new Date(t.getTime()-24*i*60*60*1e3),o=this.policies.filter(l=>{if(!l.issue_date)return!0;const d=new Date(l.issue_date);return d>=r&&d<=t}),s={};o.forEach(l=>{const d=l.product_name||"Unknown Product";s[d]||(s[d]={name:d,policies:0,totalPremium:0}),s[d].policies++,s[d].totalPremium+=Number(l.net_premium)||0}),this.topPerformers=Object.values(s).map(l=>({name:l.name,policies:l.policies,revenue:`EGP ${Math.round(l.totalPremium).toLocaleString()}`,growth:l.policies>0?`${l.policies} policies`:"0 policies"})).sort((l,d)=>{const g=parseInt(l.revenue.replace(/[^0-9]/g,""));return parseInt(d.revenue.replace(/[^0-9]/g,""))-g}).slice(0,5)}setSelectedPeriod(t){this.selectedPeriod=t,this.calculateTopPerformers()}toggleChassisModal(){this.showChassisModal=!this.showChassisModal}openCustomerModal(){this.isCustomerModalOpen=!0}onCustomerSelected(t){this.isCustomerModalOpen=!1,this.router.navigate(["/dashboard/broker/quote/new"],{state:{customer:t}})}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(y.u),e.rXU(w.m),e.rXU(j.u),e.rXU(h.Ix))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-dashboard"]],decls:160,vars:95,consts:[[1,"space-y-8"],[1,"flex","flex-col","sm:flex-row","sm:items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"group",3,"hover"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-3xl","font-bold","text-navy","mt-2"],[1,"flex","items-center","mt-2","text-sm","font-medium","text-green-600"],["data-lucide","arrow-up-right",1,"w-4","h-4","mr-1"],[1,"p-4","rounded-xl","bg-gradient-to-br","from-blue-500","to-blue-600","group-hover:scale-110","transition-transform","duration-300"],["data-lucide","shield",1,"h-7","w-7","text-white"],[1,"flex","items-center","mt-2","text-sm","font-medium","text-red-600"],["data-lucide","arrow-down-right",1,"w-4","h-4","mr-1"],[1,"p-4","rounded-xl","bg-gradient-to-br","from-red-500","to-red-600","group-hover:scale-110","transition-transform","duration-300"],["data-lucide","alert-circle",1,"h-7","w-7","text-white"],[1,"flex","items-center","mt-2","text-sm","font-medium","text-purple-600"],[1,"p-4","rounded-xl","bg-gradient-to-br","from-purple-500","to-purple-600","group-hover:scale-110","transition-transform","duration-300"],["data-lucide","users",1,"h-7","w-7","text-white"],[1,"flex","items-center","mt-2","text-sm","font-medium","text-orange-600"],[1,"p-4","rounded-xl","bg-gradient-to-br","from-orange-500","to-orange-600","group-hover:scale-110","transition-transform","duration-300"],["data-lucide","target",1,"h-7","w-7","text-white"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["data-lucide","trending-up",1,"w-4","h-4","mr-1"],[1,"p-4","rounded-xl","bg-gradient-to-br","from-green-500","to-green-600","group-hover:scale-110","transition-transform","duration-300"],["data-lucide","trending-up",1,"h-7","w-7","text-white"],[1,"flex","items-center","mt-2","text-sm","font-medium","text-blue-600"],["data-lucide","dollar-sign",1,"h-7","w-7","text-white"],["data-lucide","award",1,"h-7","w-7","text-white"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","bg-white","rounded-xl","shadow-sm","border","border-gray-100","p-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-lg","font-bold","text-navy"],[1,"text-sm","text-gray-500"],[1,"flex","gap-2"],["class","px-3 py-1 rounded-lg text-sm font-medium transition-all duration-300 capitalize",3,"bg-primary","text-white","bg-gray-100","click",4,"ngFor","ngForOf"],[1,"space-y-4"],["class","text-center py-8",4,"ngIf"],["class","flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all duration-300",4,"ngFor","ngForOf"],[1,"space-y-6"],[1,"bg-white","p-6","rounded-xl","shadow-sm","border","border-gray-100","hover:shadow-md","transition-all","duration-300","group"],[1,"font-bold","text-navy","mb-4","flex","items-center","gap-2"],["data-lucide","zap",1,"w-5","h-5","text-primary"],[1,"space-y-3"],[1,"w-full","flex","items-center","justify-between","p-4","rounded-lg","border-2","border-gray-200","hover:border-primary","hover:bg-blue-50","transition-all","group",3,"click"],[1,"flex","items-center","gap-3"],[1,"p-2","bg-blue-100","text-primary","rounded-lg","group-hover:bg-primary","group-hover:text-white","transition-all","duration-300"],["data-lucide","plus",1,"w-5","h-5"],[1,"font-medium","text-gray-700"],["data-lucide","arrow-up-right",1,"w-4","h-4","text-gray-400","group-hover:text-primary"],["routerLink","/dashboard/broker/clients",1,"w-full","flex","items-center","justify-between","p-4","rounded-lg","border-2","border-gray-200","hover:border-purple-500","hover:bg-purple-50","transition-all","group"],[1,"p-2","bg-purple-100","text-purple-600","rounded-lg","group-hover:bg-purple-600","group-hover:text-white","transition-all","duration-300"],["data-lucide","users",1,"w-5","h-5"],["data-lucide","arrow-up-right",1,"w-4","h-4","text-gray-400","group-hover:text-purple-600"],[1,"w-full","flex","items-center","justify-between","p-4","rounded-lg","border-2","border-gray-200","hover:border-orange-500","hover:bg-orange-50","transition-all","group","text-left",3,"click"],[1,"p-2","bg-orange-100","text-orange-600","rounded-lg","group-hover:bg-orange-600","group-hover:text-white","transition-all","duration-300"],["data-lucide","file-text",1,"w-5","h-5"],["data-lucide","arrow-up-right",1,"w-4","h-4","text-gray-400","group-hover:text-orange-600"],[3,"close","isOpen"],[3,"close","selectCustomer","isOpen"],[1,"px-3","py-1","rounded-lg","text-sm","font-medium","transition-all","duration-300","capitalize",3,"click"],[1,"text-center","py-8"],["data-lucide","shield",1,"w-12","h-12","text-gray-300","mx-auto","mb-3"],[1,"text-gray-500"],[1,"flex","items-center","justify-between","p-4","bg-gray-50","rounded-lg","hover:bg-gray-100","transition-all","duration-300"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","bg-primary/10","rounded-lg","flex","items-center","justify-center"],["data-lucide","shield",1,"w-5","h-5","text-primary"],[1,"font-semibold","text-navy"],[1,"text-right"],[1,"font-bold","text-navy"],[1,"text-sm","text-green-600","flex","items-center","justify-end"],["data-lucide","trending-up",1,"w-3","h-3","mr-1"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div")(4,"h1",2),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"p",3),e.EFF(8),e.nI1(9,"translate"),e.k0s()()(),e.j41(10,"div",4)(11,"app-card",5)(12,"div",6)(13,"div")(14,"p",7),e.EFF(15),e.nI1(16,"translate"),e.k0s(),e.j41(17,"p",8),e.EFF(18),e.k0s(),e.j41(19,"div",9),e.nrm(20,"i",10),e.EFF(21),e.nI1(22,"translate"),e.k0s()(),e.j41(23,"div",11),e.nrm(24,"i",12),e.k0s()()(),e.j41(25,"app-card",5)(26,"div",6)(27,"div")(28,"p",7),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"p",8),e.EFF(32),e.k0s(),e.j41(33,"div",13),e.nrm(34,"i",14),e.EFF(35),e.nI1(36,"translate"),e.k0s()(),e.j41(37,"div",15),e.nrm(38,"i",16),e.k0s()()(),e.j41(39,"app-card",5)(40,"div",6)(41,"div")(42,"p",7),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.j41(45,"p",8),e.EFF(46),e.k0s(),e.j41(47,"div",17),e.nrm(48,"i",10),e.EFF(49),e.nI1(50,"translate"),e.k0s()(),e.j41(51,"div",18),e.nrm(52,"i",19),e.k0s()()(),e.j41(53,"app-card",5)(54,"div",6)(55,"div")(56,"p",7),e.EFF(57),e.nI1(58,"translate"),e.k0s(),e.j41(59,"p",8),e.EFF(60),e.k0s(),e.j41(61,"div",20),e.nrm(62,"i",10),e.EFF(63),e.nI1(64,"translate"),e.k0s()(),e.j41(65,"div",21),e.nrm(66,"i",22),e.k0s()()()(),e.j41(67,"div",23)(68,"app-card",5)(69,"div",6)(70,"div")(71,"p",7),e.EFF(72),e.nI1(73,"translate"),e.k0s(),e.j41(74,"p",8),e.EFF(75),e.k0s(),e.j41(76,"div",9),e.nrm(77,"i",24),e.EFF(78),e.nI1(79,"translate"),e.k0s()(),e.j41(80,"div",25),e.nrm(81,"i",26),e.k0s()()(),e.j41(82,"app-card",5)(83,"div",6)(84,"div")(85,"p",7),e.EFF(86),e.nI1(87,"translate"),e.k0s(),e.j41(88,"p",8),e.EFF(89),e.nI1(90,"number"),e.k0s(),e.j41(91,"div",27),e.nrm(92,"i",10),e.EFF(93),e.nI1(94,"translate"),e.k0s()(),e.j41(95,"div",11),e.nrm(96,"i",28),e.k0s()()(),e.j41(97,"app-card",5)(98,"div",6)(99,"div")(100,"p",7),e.EFF(101),e.nI1(102,"translate"),e.k0s(),e.j41(103,"p",8),e.EFF(104),e.nI1(105,"number"),e.k0s(),e.j41(106,"div",17),e.nrm(107,"i",10),e.EFF(108),e.nI1(109,"translate"),e.k0s()(),e.j41(110,"div",18),e.nrm(111,"i",29),e.k0s()()()(),e.j41(112,"div",30)(113,"div",31)(114,"div",32)(115,"div")(116,"h2",33),e.EFF(117),e.nI1(118,"translate"),e.k0s(),e.j41(119,"p",34),e.EFF(120),e.nI1(121,"translate"),e.k0s()(),e.j41(122,"div",35),e.DNE(123,ye,3,9,"button",36),e.k0s()(),e.j41(124,"div",37),e.DNE(125,ve,5,3,"div",38)(126,xe,16,7,"div",39),e.k0s()(),e.j41(127,"div",40)(128,"div",41)(129,"h3",42),e.nrm(130,"i",43),e.EFF(131),e.nI1(132,"translate"),e.k0s(),e.j41(133,"div",44)(134,"button",45),e.bIt("click",function(){return r.openCustomerModal()}),e.j41(135,"div",46)(136,"div",47),e.nrm(137,"i",48),e.k0s(),e.j41(138,"span",49),e.EFF(139),e.nI1(140,"translate"),e.k0s()(),e.nrm(141,"i",50),e.k0s(),e.j41(142,"button",51)(143,"div",46)(144,"div",52),e.nrm(145,"i",53),e.k0s(),e.j41(146,"span",49),e.EFF(147),e.nI1(148,"translate"),e.k0s()(),e.nrm(149,"i",54),e.k0s(),e.j41(150,"button",55),e.bIt("click",function(){return r.toggleChassisModal()}),e.j41(151,"div",46)(152,"div",56),e.nrm(153,"i",57),e.k0s(),e.j41(154,"span",49),e.EFF(155),e.nI1(156,"translate"),e.k0s()(),e.nrm(157,"i",58),e.k0s()()()()(),e.j41(158,"app-chassis-validation-modal",59),e.bIt("close",function(){return r.toggleChassisModal()}),e.k0s(),e.j41(159,"app-customer-selection-modal",60),e.bIt("close",function(){return r.isCustomerModalOpen=!1})("selectCustomer",function(s){return r.onCustomerSelected(s)}),e.k0s()()()),2&i&&(e.R7$(5),e.JRh(e.bMT(6,46,"BROKER.DASHBOARD.WELCOME")),e.R7$(3),e.JRh(e.bMT(9,48,"BROKER.DASHBOARD.SUBTITLE")),e.R7$(3),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(16,50,"BROKER.DASHBOARD.STATS.ACTIVE_POLICIES")),e.R7$(3),e.JRh(r.analytics.activePolicies),e.R7$(3),e.Lme(" ",r.analytics.activePolicies," ",e.bMT(22,52,"BROKER.DASHBOARD.STATS.ACTIVE_POLICIES_TEXT")," "),e.R7$(4),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(30,54,"BROKER.DASHBOARD.STATS.CANCELED_POLICIES")),e.R7$(3),e.JRh(r.analytics.canceledPolicies),e.R7$(3),e.Lme(" ",r.analytics.cancellationRate,"% ",e.bMT(36,56,"BROKER.DASHBOARD.STATS.CANCELLATION_RATE")," "),e.R7$(4),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(44,58,"BROKER.DASHBOARD.STATS.TOTAL_CLIENTS")),e.R7$(3),e.JRh(r.analytics.totalClients),e.R7$(3),e.Lme(" ",r.analytics.totalClients," ",e.bMT(50,60,"BROKER.DASHBOARD.STATS.UNIQUE_CLIENTS")," "),e.R7$(4),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(58,62,"BROKER.DASHBOARD.STATS.TOTAL_OPPORTUNITIES")),e.R7$(3),e.JRh(r.analytics.totalOpportunities),e.R7$(3),e.Lme(" ",r.analytics.openOpportunities," ",e.bMT(64,64,"BROKER.DASHBOARD.STATS.OPEN_OPPORTUNITIES")," "),e.R7$(5),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(73,66,"BROKER.DASHBOARD.STATS.CONVERSION_RATE")),e.R7$(3),e.SpI("",r.analytics.conversionRate,"%"),e.R7$(3),e.Lme(" ",r.analytics.conversionRate,"% ",e.bMT(79,68,"BROKER.DASHBOARD.STATS.OPPORTUNITIES_WON")," "),e.R7$(4),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(87,70,"BROKER.DASHBOARD.STATS.TOTAL_PREMIUM")),e.R7$(3),e.SpI("EGP ",e.bMT(90,72,r.analytics.totalPremium),""),e.R7$(4),e.SpI(" ",e.bMT(94,74,"BROKER.DASHBOARD.STATS.NET_PREMIUM")," "),e.R7$(4),e.Y8G("hover",!0),e.R7$(4),e.JRh(e.bMT(102,76,"BROKER.DASHBOARD.STATS.TOTAL_COMMISSIONS")),e.R7$(3),e.SpI("EGP ",e.bMT(105,78,r.analytics.totalCommissions),""),e.R7$(4),e.SpI(" ",e.bMT(109,80,"BROKER.DASHBOARD.STATS.COMMISSION_EARNINGS")," "),e.R7$(9),e.SpI("",e.bMT(118,82,"BROKER.DASHBOARD.PERFORMANCE.TITLE")," "),e.R7$(3),e.JRh(e.bMT(121,84,"BROKER.DASHBOARD.PERFORMANCE.SUBTITLE")),e.R7$(3),e.Y8G("ngForOf",e.lJ4(94,be)),e.R7$(2),e.Y8G("ngIf",0===r.topPerformers.length),e.R7$(),e.Y8G("ngForOf",r.topPerformers),e.R7$(5),e.SpI(" ",e.bMT(132,86,"BROKER.DASHBOARD.QUICK_TOOLS.TITLE")," "),e.R7$(8),e.JRh(e.bMT(140,88,"BROKER.DASHBOARD.QUICK_TOOLS.GET_QUOTE")),e.R7$(8),e.JRh(e.bMT(148,90,"BROKER.DASHBOARD.QUICK_TOOLS.MANAGE_CLIENTS")),e.R7$(8),e.JRh(e.bMT(156,92,"BROKER.DASHBOARD.QUICK_TOOLS.CREATE_CLAIM")),e.R7$(3),e.Y8G("isOpen",r.showChassisModal),e.R7$(),e.Y8G("isOpen",r.isCustomerModalOpen))},dependencies:[m.Sq,m.bT,h.Wk,v.w,H.i,M,G,m.QX,x.D9],encapsulation:2})}}return a})();var I=_(1672),k=_(4333),T=_(4373),F=_(4815);function Ce(a,n){if(1&a&&(e.j41(0,"div",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function Re(a,n){1&a&&(e.j41(0,"div",15),e.nrm(1,"app-loading-spinner"),e.k0s())}function Ie(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",16),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.columns)("showExport",!0)("maxSelectOptions",10)}}function Ee(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",17),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}let Te=(()=>{class a{constructor(t,i,r,o){this.customerService=t,this.authService=i,this.router=r,this.appTranslate=o,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.isCustomerModalOpen=!1,this.currentPage=1,this.pageSize=25,this.totalRecords=1e3,this.setupColumns()}ngOnInit(){this.fetchTotalCount(),this.loadClients()}fetchTotalCount(){this.authService.currentUser.subscribe(t=>{t&&this.customerService.getCustomers(t.id,"broker",{}).subscribe({next:i=>{const r=i.result?.data||i.data||i;let o=[];r.contacts&&Array.isArray(r.contacts)?o=r.contacts:Array.isArray(r)?o=r:r.data&&Array.isArray(r.data)&&(o=r.data),this.totalRecords=o.length,console.log("=== CLIENT PAGINATION DEBUG ==="),console.log("Total clients fetched:",o.length),console.log("totalRecords updated to:",this.totalRecords),console.log("===============================")},error:i=>{console.error("Error fetching total count",i)}})})}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"clientId",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.CLIENT_ID"),filterable:!0,filterType:"text"},{key:"name",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.FULL_NAME"),filterable:!0,filterType:"text"},{key:"email",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.EMAIL"),filterable:!0,filterType:"text"},{key:"phone",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.PHONE"),filterable:!0,filterType:"text"},{key:"status",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t.status)},{key:"totalPolicies",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.POLICIES"),filterable:!1},{key:"joinDate",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.JOIN_DATE"),filterable:!0,filterType:"date"},{key:"actions",label:this.appTranslate.instant("BROKER.CLIENTS.COLUMNS.ACTIONS"),filterable:!1,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="edit" data-id="${t.id}" title="Edit Client">\n                            <i data-lucide="edit" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(t){const i=t?.toLowerCase()||"inactive";let r="";return r=["active"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}loadClients(){this.isLoading=!0,this.authService.currentUser.subscribe(t=>{t&&this.customerService.getCustomers(t.id,"broker",{limit:this.pageSize,offset:(this.currentPage-1)*this.pageSize}).subscribe({next:r=>{const o=r.result?.data||r.data||r;let s=[];o.contacts&&Array.isArray(o.contacts)?s=o.contacts:Array.isArray(o)?s=o:o.data&&Array.isArray(o.data)&&(s=o.data),this.data=s.map(l=>({id:l.national_id||l.id,clientId:l.national_id||l.id||"N/A",name:l.english_name||l.arabic_name||"Unknown Name",email:l.email||"N/A",phone:l.phone||l.mobile||"N/A",status:l.is_customer?"active":"inactive",totalPolicies:l.policy_count||0,joinDate:l.create_date||"N/A"})),this.isLoading=!1},error:r=>{console.error("Error loading clients",r),this.error="BROKER.CLIENTS.ERROR_LOADING",this.isLoading=!1}})})}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){switch(t.action){case"view":this.router.navigate(["/dashboard/broker/clients",t.data.id]);break;case"edit":console.log("Edit client",t.data.id)}}onExport(){console.log("Exporting clients...")}onCustomerSelected(t){this.router.navigate(["/dashboard/broker/quote/new"],{state:{customer:t}}),this.isCustomerModalOpen=!1}onPageChange(t){this.currentPage=t,this.loadClients()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadClients()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(A.m),e.rXU(y.u),e.rXU(h.Ix),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-clients"]],decls:19,vars:11,consts:[[1,"space-y-6"],[1,"bg-purple-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-purple-500","to-purple-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","users",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[3,"close","selectCustomer","isOpen"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"div",8),e.DNE(14,Ce,3,3,"div",9)(15,Re,2,0,"div",10)(16,Ie,1,4,"app-dynamic-table-with-filters",11)(17,Ee,1,3,"app-pagination",12),e.k0s()(),e.j41(18,"app-customer-selection-modal",13),e.bIt("close",function(){return r.isCustomerModalOpen=!1})("selectCustomer",function(s){return r.onCustomerSelected(s)}),e.k0s()()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,7,"BROKER.CLIENTS.TITLE")),e.R7$(3),e.JRh(e.bMT(12,9,"BROKER.CLIENTS.SUBTITLE")),e.R7$(3),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0),e.R7$(),e.Y8G("isOpen",r.isCustomerModalOpen))},dependencies:[m.bT,v.w,k.N,M,T.u,F.e,x.D9],encapsulation:2})}}return a})();function Fe(a,n){1&a&&(e.j41(0,"span",23),e.EFF(1," REQ "),e.k0s())}function Se(a,n){if(1&a){const t=e.RV6();e.j41(0,"label",17)(1,"div",18)(2,"input",19),e.bIt("change",function(){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.toggleColumn(r))}),e.k0s()(),e.j41(3,"div",20)(4,"span",21),e.EFF(5),e.k0s(),e.DNE(6,Fe,2,0,"span",22),e.k0s()()}if(2&a){const t=n.$implicit;e.AVh("opacity-60",t.mandatory)("cursor-not-allowed",t.mandatory)("hover:bg-gray-50",!t.mandatory)("dark:hover:bg-gray-700",!t.mandatory),e.R7$(2),e.Y8G("checked",t.visible)("disabled",t.mandatory),e.R7$(3),e.SpI(" ",t.label," "),e.R7$(),e.Y8G("ngIf",t.mandatory)}}function we(a,n){1&a&&(e.j41(0,"div",24)(1,"p",25),e.EFF(2,"No columns found"),e.k0s()())}function je(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7),e.nrm(3,"i",8),e.j41(4,"input",9),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.searchTerm,r)||(o.searchTerm=r),e.Njj(r)}),e.k0s()()(),e.j41(5,"div",10)(6,"button",11),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.selectAll())}),e.EFF(7," Select All "),e.k0s(),e.nrm(8,"div",12),e.j41(9,"button",13),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.deselectAll())}),e.EFF(10," Deselect All "),e.k0s(),e.nrm(11,"div",12),e.j41(12,"button",13),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.resetToDefault())}),e.EFF(13," Reset "),e.k0s()(),e.j41(14,"div",14),e.DNE(15,Se,7,12,"label",15)(16,we,3,0,"div",16),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.searchTerm),e.R7$(11),e.Y8G("ngForOf",t.filteredColumns),e.R7$(),e.Y8G("ngIf",0===t.filteredColumns.length)}}let L=(()=>{class a{constructor(t,i){this.elementRef=t,this.notificationService=i,this.columns=[],this.defaultHiddenColumns=[],this.visibleColumnsChange=new e.bkB,this.isDropdownOpen=!1,this.searchTerm="",this.localColumns=[]}ngOnInit(){this.pageId?(this.initializeColumns(),this.loadPreferences(),this.emitVisibleColumns()):console.error("ColumnToggleComponent: pageId is required")}initializeColumns(){this.localColumns=this.columns.map(t=>({...t,visible:!!t.mandatory||!this.defaultHiddenColumns.includes(t.key)}))}loadPreferences(){try{const t=localStorage.getItem(`column-prefs-${this.pageId}`);if(t){const i=JSON.parse(t);this.applyPreferences(i)}}catch(t){console.warn("Failed to load column preferences, using defaults:",t)}}applyPreferences(t){this.localColumns.forEach(i=>{i.visible=!!i.mandatory||!t.hiddenColumns.includes(i.key)})}savePreferences(){try{const i={hiddenColumns:this.localColumns.filter(r=>!r.visible&&!r.mandatory).map(r=>r.key)};localStorage.setItem(`column-prefs-${this.pageId}`,JSON.stringify(i))}catch(t){console.error("Failed to save column preferences:",t)}}toggleColumn(t){t.mandatory||(1===this.localColumns.filter(r=>r.visible).length&&t.visible?this.notificationService.warning("At least one column must remain visible."):(t.visible=!t.visible,this.savePreferences(),this.emitVisibleColumns()))}selectAll(){this.localColumns.forEach(t=>{t.visible=!0}),this.savePreferences(),this.emitVisibleColumns()}deselectAll(){let t=!0;this.localColumns.forEach(i=>{i.mandatory?i.visible=!0:t&&!this.hasMandatoryColumns?(i.visible=!0,t=!1):i.visible=!1}),this.savePreferences(),this.emitVisibleColumns()}get hasMandatoryColumns(){return this.localColumns.some(t=>t.mandatory)}resetToDefault(){this.initializeColumns(),this.savePreferences(),this.emitVisibleColumns()}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen||(this.searchTerm="")}emitVisibleColumns(){const t=this.localColumns.filter(i=>i.visible);this.visibleColumnsChange.emit(t)}get visibleCount(){return this.localColumns.filter(t=>t.visible).length}get totalCount(){return this.localColumns.length}get filteredColumns(){if(!this.searchTerm)return this.localColumns;const t=this.searchTerm.toLowerCase();return this.localColumns.filter(i=>i.label.toLowerCase().includes(t)||i.key.toLowerCase().includes(t))}onDocumentClick(t){this.elementRef.nativeElement.contains(t.target)||(this.isDropdownOpen=!1,this.searchTerm="")}onEscapeKey(){this.isDropdownOpen&&(this.isDropdownOpen=!1,this.searchTerm="")}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(e.aKT),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-column-toggle"]],hostBindings:function(i,r){1&i&&e.bIt("click",function(s){return r.onDocumentClick(s)},!1,e.EBC)("keydown.escape",function(){return r.onEscapeKey()},!1,e.EBC)},inputs:{columns:"columns",pageId:"pageId",defaultHiddenColumns:"defaultHiddenColumns"},outputs:{visibleColumnsChange:"visibleColumnsChange"},decls:7,vars:6,consts:[[1,"relative","inline-block","text-left"],["type","button","aria-label","Toggle column visibility",1,"inline-flex","items-center","justify-center","gap-2","rounded-lg","border","border-gray-200","dark:border-gray-700","bg-white","dark:bg-gray-800","px-4","py-2","text-sm","font-medium","text-gray-700","dark:text-gray-200","hover:bg-gray-50","dark:hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-primary/20","transition-all",3,"click"],["data-lucide","columns",1,"h-4","w-4","text-gray-500","dark:text-gray-400"],["data-lucide","chevron-down",1,"h-4","w-4","text-gray-400","transition-transform","duration-200"],["class","absolute right-0 z-50 mt-2 w-72 origin-top-right rounded-xl bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none border border-gray-100 dark:border-gray-700 animate-in fade-in zoom-in-95 duration-200","role","dialog","aria-label","Column visibility settings",4,"ngIf"],["role","dialog","aria-label","Column visibility settings",1,"absolute","right-0","z-50","mt-2","w-72","origin-top-right","rounded-xl","bg-white","dark:bg-gray-800","shadow-lg","ring-1","ring-black","ring-opacity-5","focus:outline-none","border","border-gray-100","dark:border-gray-700","animate-in","fade-in","zoom-in-95","duration-200"],[1,"p-3","border-b","border-gray-100","dark:border-gray-700"],[1,"relative"],["data-lucide","search",1,"absolute","left-3","top-1/2","-translate-y-1/2","h-4","w-4","text-gray-400"],["type","text","placeholder","Search columns...","aria-label","Search columns",1,"w-full","rounded-lg","border","border-gray-200","dark:border-gray-700","bg-gray-50","dark:bg-gray-900","pl-9","pr-3","py-2","text-sm","text-gray-700","dark:text-gray-200","placeholder-gray-400","focus:border-primary","focus:ring-1","focus:ring-primary","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-between","px-3","py-2","bg-gray-50","dark:bg-gray-800/50","border-b","border-gray-100","dark:border-gray-700"],["type","button",1,"text-xs","font-medium","text-primary","hover:text-primary-700","dark:hover:text-primary-400","transition-colors",3,"click"],[1,"h-3","w-px","bg-gray-300","dark:bg-gray-600"],["type","button",1,"text-xs","font-medium","text-gray-500","hover:text-gray-700","dark:hover:text-gray-300","transition-colors",3,"click"],[1,"max-h-64","overflow-y-auto","p-2","space-y-0.5","custom-scrollbar"],["class","flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-colors group",3,"opacity-60","cursor-not-allowed","hover:bg-gray-50","dark:hover:bg-gray-700",4,"ngFor","ngForOf"],["class","py-6 text-center",4,"ngIf"],[1,"flex","items-center","gap-3","px-3","py-2","rounded-lg","cursor-pointer","transition-colors","group"],[1,"relative","flex","items-center"],["type","checkbox",1,"h-4","w-4","rounded","border-gray-300","text-primary","focus:ring-primary","disabled:opacity-50","disabled:cursor-not-allowed","transition-all",3,"change","checked","disabled"],[1,"flex-1","flex","items-center","justify-between","min-w-0"],[1,"text-sm","text-gray-700","dark:text-gray-200","truncate","font-medium","group-hover:text-gray-900","dark:group-hover:text-white","transition-colors"],["class","ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-gray-100 text-gray-600 border border-gray-200",4,"ngIf"],[1,"ml-2","inline-flex","items-center","px-1.5","py-0.5","rounded","text-[10px]","font-medium","bg-gray-100","text-gray-600","border","border-gray-200"],[1,"py-6","text-center"],[1,"text-sm","text-gray-500","dark:text-gray-400"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"button",1),e.bIt("click",function(){return r.toggleDropdown()}),e.nrm(2,"i",2),e.j41(3,"span"),e.EFF(4),e.k0s(),e.nrm(5,"i",3),e.k0s(),e.DNE(6,je,17,3,"div",4),e.k0s()),2&i&&(e.R7$(),e.BMQ("aria-expanded",r.isDropdownOpen),e.R7$(3),e.Lme("Columns (",r.visibleCount,"/",r.totalCount,")"),e.R7$(),e.AVh("rotate-180",r.isDropdownOpen),e.R7$(),e.Y8G("ngIf",r.isDropdownOpen))},dependencies:[m.Sq,m.bT,u.me,u.BC,u.vS],styles:[".custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#e5e7eb;border-radius:9999px}.dark[_nghost-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .dark   [_nghost-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#374151}.custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#d1d5db}.dark[_nghost-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .dark   [_nghost-%COMP%]   .custom-scrollbar[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:#4b5563}.fade-enter-active[_ngcontent-%COMP%], .fade-leave-active[_ngcontent-%COMP%]{transition:opacity .2s ease,transform .2s ease}.fade-enter-from[_ngcontent-%COMP%], .fade-leave-to[_ngcontent-%COMP%]{opacity:0;transform:scale(.95)}"]})}}return a})();function Ne(a,n){if(1&a&&(e.j41(0,"div",15),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function De(a,n){1&a&&(e.j41(0,"div",16),e.nrm(1,"app-loading-spinner"),e.k0s())}function Oe(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",17),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.visibleColumns)("showExport",!0)("maxSelectOptions",10)}}function Ae(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",18),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}let Me=(()=>{class a{constructor(t,i,r,o){this.policyService=t,this.authService=i,this.router=r,this.appTranslate=o,this.allColumns=[],this.visibleColumns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.currentPage=1,this.pageSize=25,this.totalRecords=1e3,this.setupColumns()}ngOnInit(){this.fetchTotalCount(),this.loadPolicies()}fetchTotalCount(){const t=this.authService.currentUserValue;t&&(console.log("=== POLICIES PAGINATION DEBUG ==="),console.log("Fetching total count..."),this.policyService.listPolicies({user_id:t.id,user_type:"broker",limit:1e4,offset:0}).subscribe({next:i=>{console.log("Full API response:",i),console.log("response.data:",i.data),console.log("response.data?.data:",i.data?.data),console.log("response.data?.result?.data:",i.data?.result?.data);const r=i.data?.data||i.data?.result?.data||i.data||[];console.log("Extracted policiesData:",r),console.log("Is array?",Array.isArray(r)),this.totalRecords=Array.isArray(r)?r.length:0,console.log("Total policies fetched:",this.totalRecords),console.log("totalRecords set to:",this.totalRecords),console.log("isLoading:",this.isLoading),console.log("error:",this.error),console.log("Pagination should show:",!this.isLoading&&!this.error&&this.totalRecords>0),console.log("===============================")},error:i=>{console.error("Error fetching total policies count:",i),console.error("Error details:",JSON.stringify(i,null,2))}}))}setupColumns(){this.allColumns=[{key:"riskImage",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CAR_IMAGE"),filterable:!1,render:t=>this.renderBoolean(t.riskImage)},{key:"policyNumber",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.POLICY_NO"),filterable:!0,filterType:"text",sortable:!0},{key:"transactionType",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.TRANSACTION_TYPE"),filterable:!0,render:t=>this.renderTransactionType(t)},{key:"productName",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.PRODUCT"),filterable:!0,filterType:"text",sortable:!0},{key:"customerName",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CUSTOMER"),filterable:!0,filterType:"text",sortable:!0},{key:"status",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t)},{key:"approveDate",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.APPROVE_DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"issueDate",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ISSUE_DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"effectiveFrom",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.EFFECTIVE_FROM"),filterable:!0,filterType:"date",sortable:!0},{key:"effectiveTo",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.EFFECTIVE_TO"),filterable:!0,filterType:"date",sortable:!0},{key:"grossPremium",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.GROSS_PREMIUM"),filterable:!1,render:t=>this.renderCurrency(t.grossPremium,t.currency)},{key:"netPremium",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.NET_PREMIUM"),filterable:!1,render:t=>this.renderCurrency(t.netPremium,t.currency)},{key:"currency",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CURRENCY"),filterable:!0,filterType:"text",sortable:!0},{key:"paymentStatus",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.PAYMENT_STATUS"),filterable:!0,render:t=>this.renderPaymentStatus(t.paymentStatus)},{key:"issuingBranch",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ISSUING_BRANCH"),filterable:!0,filterType:"text",sortable:!0},{key:"actions",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ACTIONS"),filterable:!1,mandatory:!0,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="download" data-id="${t.id}" title="Download Policy">\n                            <i data-lucide="file-text" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="more" data-id="${t.id}" title="More Actions">\n                            <i data-lucide="more-horizontal" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}],this.visibleColumns=[...this.allColumns]}onVisibleColumnsChange(t){this.visibleColumns=t}renderStatus(t){const i=t.rawStatus||"pending";let r="";return r=["active","approved","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","processing","review"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.status}</span>`}renderTransactionType(t){const i=t.rawTransactionType||"new";let r="bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300";return"endorsement"===i||"end"===i?r="bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300":"renewal"===i?r="bg-teal-100 dark:bg-teal-900/30 text-teal-800 dark:text-teal-300":"cancellation"===i||"cancel"===i?r="bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":["non_technical","technical_refund","technical_add","technical_borndead"].includes(i)&&(r="bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300"),`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.transactionType}</span>`}renderPaymentStatus(t){const i=t?.toLowerCase()||"outstanding";let r="";return r=["paid","completed"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","outstanding"].includes(i)?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}renderBoolean(t){return t?'<i data-lucide="check-circle-2" class="w-5 h-5 text-green-500 mx-auto"></i>':'<i data-lucide="x-circle" class="w-5 h-5 text-gray-300 mx-auto"></i>'}renderCurrency(t,i){return`<span class="font-medium text-gray-900 dark:text-gray-100">${i||"EGP"} ${Number(t).toLocaleString()}</span>`}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}loadPolicies(){this.isLoading=!0;const t=this.authService.currentUserValue;t&&this.policyService.listPolicies({user_id:t.id,user_type:"broker",limit:this.pageSize,offset:(this.currentPage-1)*this.pageSize}).subscribe({next:r=>{const o=r.data?.data||r.data?.result?.data||r.data||[];(r.data?.total_count||r.data?.count)&&(this.totalRecords=r.data.total_count||r.data.count),this.data=o.map(s=>{const l=(s.state||"Draft").replace(/^STATUS\./i,"").toLowerCase(),d=this.appTranslate.instant(`STATUS.${l.toUpperCase()}`),g=(s.transaction_type||"New").replace(/^TYPES\./i,"").toLowerCase(),p=this.appTranslate.instant(`TYPES.${g.toUpperCase()}`);return{id:s.id||s.policy_number,policyNumber:s.policy_number||"Draft",riskImage:s.risk_image,transactionType:p,rawTransactionType:g,productName:s.product_name||"Motor Private Section",customerName:s.customer_name||"Customer",status:d,rawStatus:l,approveDate:s.approve_date||"-",issueDate:s.issue_date||"-",effectiveFrom:s.effective_from_date||"-",effectiveTo:s.effective_to_date||"-",grossPremium:s.gross_premium||0,netPremium:s.net_premium||0,currency:s.currency||"EGP",paymentStatus:s.payment_status||"outstanding",issuingBranch:s.issuing_branch||"Head office"}}),this.isLoading=!1},error:r=>{console.error("Error loading policies:",r),this.error="BROKER.POLICIES.ERROR_LOADING",this.isLoading=!1}})}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){switch(t.action){case"view":this.router.navigate(["/dashboard/broker/policies",t.data.id]);break;case"download":console.log("Download policy",t.data.id);break;case"more":console.log("More actions for",t.data.id)}}onExport(){console.log("Exporting policies...")}onPageChange(t){this.currentPage=t,this.loadPolicies()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadPolicies()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(w.m),e.rXU(y.u),e.rXU(h.Ix),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-policies"]],decls:20,vars:12,consts:[[1,"space-y-6"],[1,"bg-indigo-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-indigo-500","to-indigo-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","shield",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"p-4","border-b","border-gray-100","dark:border-gray-700","flex","justify-end"],[3,"visibleColumnsChange","columns","pageId"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"div",8)(14,"div",9)(15,"app-column-toggle",10),e.bIt("visibleColumnsChange",function(s){return r.onVisibleColumnsChange(s)}),e.k0s()(),e.DNE(16,Ne,3,3,"div",11)(17,De,2,0,"div",12)(18,Oe,1,4,"app-dynamic-table-with-filters",13),e.k0s(),e.DNE(19,Ae,1,3,"app-pagination",14),e.k0s()()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,8,"BROKER.POLICIES.TITLE")),e.R7$(3),e.JRh(e.bMT(12,10,"BROKER.POLICIES.SUBTITLE")),e.R7$(4),e.Y8G("columns",r.allColumns)("pageId","broker-policies-list"),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0))},dependencies:[m.bT,v.w,k.N,T.u,F.e,L,x.D9],encapsulation:2})}}return a})();var N=_(8219);function Le(a,n){if(1&a&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function Pe(a,n){1&a&&(e.j41(0,"div",19),e.nrm(1,"app-loading-spinner"),e.k0s())}function $e(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",20),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.visibleColumns)("showExport",!0)("maxSelectOptions",10)}}function Ge(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",21),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}function Be(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-customer-selection-modal",22),e.bIt("close",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isCustomerModalOpen=!1)})("selectCustomer",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onCustomerSelected(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("isOpen",t.isCustomerModalOpen)}}let P=(()=>{class a{constructor(t,i,r,o,s){this.crmService=t,this.authService=i,this.router=r,this.route=o,this.appTranslate=s,this.allColumns=[],this.visibleColumns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.isCustomerModalOpen=!1,this.currentFilters={},this.currentPage=1,this.pageSize=25,this.totalRecords=1e3,this.currentDomain=[],this.pageTitle="SIDEBAR.QUOTATIONS",this.setupColumns(),this.route.data.subscribe(l=>{const d=l.filterType;this.currentDomain=this.getDomainFromFilterType(d),this.pageTitle="renewal"===d?"SIDEBAR.RENEWAL_REQUESTS":"endorsement"===d?"SIDEBAR.ENDORSEMENT_REQUESTS":"lost"===d?"SIDEBAR.LOST_REQUESTS":"SIDEBAR.ALL_QUOTATIONS",this.currentPage=1,this.fetchTotalCount(),this.loadQuotations()})}ngOnInit(){}getDomainFromFilterType(t){switch(t){case"renewal":return"[('policy_services_type', '=', 'renewal')]";case"endorsement":return"[('policy_services_type', '=', 'end')]";case"lost":return"[('active', '=', False)]";default:return[]}}fetchTotalCount(){const t=this.authService.currentUserValue;t&&this.crmService.listOpportunities({user_id:t.id,user_type:"broker",limit:1e4,offset:0,domain:this.currentDomain}).subscribe({next:i=>{const r=Array.isArray(i)?i:i.data||[];this.totalRecords=r.length},error:i=>{console.error("Error fetching total quotations count",i)}})}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.allColumns=[{key:"quoteNumber",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.QUOTE_NUMBER"),filterable:!0,filterType:"text",sortable:!0},{key:"title",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.TITLE"),filterable:!0,filterType:"text",sortable:!0},{key:"date",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"customerName",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.CUSTOMER_NAME"),filterable:!0,filterType:"text",sortable:!0},{key:"stage",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.STAGE"),filterable:!0,render:t=>this.renderStatus(t)},{key:"type",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.TYPE"),filterable:!0,filterType:"select",render:t=>this.renderType(t)},{key:"actions",label:this.appTranslate.instant("BROKER.QUOTATIONS.COLUMNS.ACTIONS"),filterable:!1,mandatory:!0,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="download" data-id="${t.id}" title="Download Quote">\n                            <i data-lucide="file-text" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}],this.visibleColumns=[...this.allColumns]}onVisibleColumnsChange(t){this.visibleColumns=t}renderStatus(t){let r="";switch(t.rawStage||"draft"){case"new":r="bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300";break;case"draft":r="bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300";break;case"sent":r="bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300";break;case"pending":case"review":r="bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300";break;case"negotiation":r="bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300";break;case"accepted":case"approved":r="bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300";break;case"won":r="bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-300";break;case"rejected":case"lost":r="bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300";break;case"expired":r="bg-slate-100 dark:bg-slate-900/30 text-slate-800 dark:text-slate-300";break;default:r="bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300"}return`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.stage}</span>`}renderType(t){let r="";switch(t.rawType||"new"){case"new":r="bg-cyan-100 dark:bg-cyan-900/30 text-cyan-800 dark:text-cyan-300";break;case"renewal":r="bg-teal-100 dark:bg-teal-900/30 text-teal-800 dark:text-teal-300";break;case"endorsement":case"end":r="bg-violet-100 dark:bg-violet-900/30 text-violet-800 dark:text-violet-300";break;case"cancellation":case"cancel":r="bg-rose-100 dark:bg-rose-900/30 text-rose-800 dark:text-rose-300";break;case"modification":case"non_technical":case"technical_refund":case"technical_add":case"technical_borndead":r="bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300";break;default:r="bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300"}return`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.type}</span>`}loadQuotations(){this.isLoading=!0;const t=this.authService.currentUserValue;t&&this.crmService.listOpportunities({user_id:t.id,user_type:"broker",limit:this.pageSize,offset:(this.currentPage-1)*this.pageSize,domain:this.currentDomain}).subscribe({next:r=>{const o=Array.isArray(r)?r:r.data||[];(r.total_count||r.count)&&(this.totalRecords=r.total_count||r.count),this.data=o.map(s=>{const l=s.stage_name?s.stage_name.replace(/^STATUS\./i,"").toLowerCase():"draft",d=this.appTranslate.instant(`STATUS.${l.toUpperCase()}`),g=s.opportunity_type?s.opportunity_type.replace(/^TYPES\./i,"").toLowerCase():"new",p=this.appTranslate.instant(`TYPES.${g.toUpperCase()}`);return{id:s.opportunity_id,quoteNumber:s.opportunity_number||"N/A",title:s.name?s.name.split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" "):"N/A",date:s.opportunity_date||"N/A",customerName:s.contact_name?s.contact_name.split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" "):"N/A",stage:d,rawStage:l,type:p,rawType:g}}),this.isLoading=!1},error:r=>{console.error("Error loading quotations:",r),this.error="BROKER.QUOTATIONS.ERROR_LOADING",this.isLoading=!1}})}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){switch(t.action){case"view":this.router.navigate(["/dashboard/broker/quotations",t.data.id]);break;case"download":console.log("Download",t.data.id)}}onExport(){console.log("Exporting quotations...")}openCustomerModal(){this.isCustomerModalOpen=!0}onCustomerSelected(t){this.isCustomerModalOpen=!1,this.router.navigate(["/dashboard/broker/quote/new"],{state:{customer:t}})}onPageChange(t){this.currentPage=t,this.loadQuotations()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadQuotations()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(j.u),e.rXU(y.u),e.rXU(h.Ix),e.rXU(h.nX),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-quotations"]],decls:25,vars:16,consts:[[1,"space-y-6"],[1,"bg-blue-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-blue-500","to-blue-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","file-text",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],["variant","primary",3,"click"],["data-lucide","plus",1,"w-4","h-4","mr-2"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"p-4","border-b","border-gray-100","dark:border-gray-700","flex","justify-end"],[3,"visibleColumnsChange","columns","pageId"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[3,"isOpen","close","selectCustomer",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"],[3,"close","selectCustomer","isOpen"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()(),e.j41(13,"app-button",8),e.bIt("click",function(){return r.openCustomerModal()}),e.nrm(14,"i",9),e.EFF(15),e.nI1(16,"translate"),e.k0s()()(),e.j41(17,"div",10)(18,"div",11)(19,"app-column-toggle",12),e.bIt("visibleColumnsChange",function(s){return r.onVisibleColumnsChange(s)}),e.k0s()(),e.DNE(20,Le,3,3,"div",13)(21,Pe,2,0,"div",14)(22,$e,1,4,"app-dynamic-table-with-filters",15)(23,Ge,1,3,"app-pagination",16),e.k0s()(),e.DNE(24,Be,1,1,"app-customer-selection-modal",17),e.k0s()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,10,r.pageTitle)),e.R7$(3),e.JRh(e.bMT(12,12,"BROKER.QUOTATIONS.SUBTITLE")),e.R7$(4),e.SpI(" ",e.bMT(16,14,"BROKER.QUOTATIONS.CREATE_QUOTE")," "),e.R7$(4),e.Y8G("columns",r.allColumns)("pageId","broker-quotations-list"),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0),e.R7$(),e.Y8G("ngIf",r.isCustomerModalOpen))},dependencies:[m.bT,v.w,N.Q,k.N,M,T.u,F.e,L,x.D9]})}}return a})();var B=_(9999);const Ue=()=>["/dashboard/broker/clients"],Ye=()=>["overview","policies","claims","documents"],Ve=(a,n)=>({"text-primary":a,"text-gray-500 dark:text-gray-400 hover:text-gray-700":n}),Xe=a=>["/dashboard/broker/policies",a],Qe=a=>["/dashboard/broker/claims",a];function Je(a,n){1&a&&(e.j41(0,"div",5),e.nrm(1,"app-loading-spinner"),e.k0s())}function He(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",6)(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"button",8),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.EFF(4," Back to Clients "),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(2),e.JRh(t.error)}}function qe(a,n){if(1&a&&(e.j41(0,"p",38),e.EFF(1),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.JRh(t.client.arabicName)}}function ze(a,n){1&a&&e.nrm(0,"div",41)}function Ke(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.setActiveTab(r))}),e.EFF(1),e.DNE(2,ze,1,0,"div",40),e.k0s()}if(2&a){const t=n.$implicit,i=e.XpG(2);e.Y8G("ngClass",e.l_i(3,Ve,i.activeTab===t,i.activeTab!==t)),e.R7$(),e.SpI(" ",t," "),e.R7$(),e.Y8G("ngIf",i.activeTab===t)}}function We(a,n){if(1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Arabic Name"),e.k0s(),e.j41(3,"p",46),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.client.arabicName)}}function Ze(a,n){if(1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Client ID"),e.k0s(),e.j41(3,"p",46),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.client.id)}}function et(a,n){1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Is Passport"),e.k0s(),e.j41(3,"p",46),e.EFF(4,"Yes"),e.k0s()())}function tt(a,n){if(1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Passport Number"),e.k0s(),e.j41(3,"p",46),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.client.passportId)}}function rt(a,n){if(1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Date of Birth"),e.k0s(),e.j41(3,"p",46),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.client.dateOfBirth)}}function it(a,n){if(1&a&&(e.j41(0,"div")(1,"p",45),e.EFF(2,"Gender"),e.k0s(),e.j41(3,"p",49),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.client.gender)}}function at(a,n){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.SpI(", ",t.client.city,"")}}function ot(a,n){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.SpI(", ",t.client.stateName,"")}}function nt(a,n){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.SpI(", ",t.client.countryName,"")}}function st(a,n){if(1&a&&(e.j41(0,"div",34)(1,"div",42)(2,"h3",43),e.EFF(3,"Client Information"),e.k0s(),e.j41(4,"div",44)(5,"div")(6,"p",45),e.EFF(7,"Full Name"),e.k0s(),e.j41(8,"p",46),e.EFF(9),e.k0s()(),e.DNE(10,We,5,1,"div",47)(11,Ze,5,1,"div",47)(12,et,5,0,"div",47)(13,tt,5,1,"div",47),e.j41(14,"div")(15,"p",45),e.EFF(16,"Email"),e.k0s(),e.j41(17,"p",46),e.EFF(18),e.k0s()(),e.j41(19,"div")(20,"p",45),e.EFF(21,"Phone"),e.k0s(),e.j41(22,"p",46),e.EFF(23),e.k0s()(),e.DNE(24,rt,5,1,"div",47)(25,it,5,1,"div",47),e.j41(26,"div",48)(27,"p",45),e.EFF(28,"Address"),e.k0s(),e.j41(29,"p",46),e.EFF(30),e.DNE(31,at,2,1,"span",47)(32,ot,2,1,"span",47)(33,nt,2,1,"span",47),e.k0s()()()()()),2&a){const t=e.XpG(2);e.R7$(9),e.JRh(t.client.name),e.R7$(),e.Y8G("ngIf",t.client.arabicName),e.R7$(),e.Y8G("ngIf",!t.client.isForeignCustomer),e.R7$(),e.Y8G("ngIf",t.client.isForeignCustomer),e.R7$(),e.Y8G("ngIf",t.client.isForeignCustomer&&t.client.passportId),e.R7$(5),e.JRh(t.client.email),e.R7$(5),e.JRh(t.client.phone),e.R7$(),e.Y8G("ngIf",t.client.dateOfBirth),e.R7$(),e.Y8G("ngIf",t.client.gender),e.R7$(5),e.JRh(t.client.address),e.R7$(),e.Y8G("ngIf",t.client.city),e.R7$(),e.Y8G("ngIf",t.client.stateName),e.R7$(),e.Y8G("ngIf",t.client.countryName)}}function lt(a,n){1&a&&(e.j41(0,"div",53),e.nrm(1,"i",54),e.j41(2,"p",45),e.EFF(3,"No policies found for this client."),e.k0s()())}function dt(a,n){if(1&a&&(e.j41(0,"div",55)(1,"div",17)(2,"div",56),e.nrm(3,"i",57),e.k0s(),e.j41(4,"div")(5,"h4",58),e.EFF(6),e.k0s(),e.j41(7,"p",59),e.EFF(8),e.k0s(),e.j41(9,"p",60),e.EFF(10),e.k0s()()(),e.j41(11,"div",61)(12,"span",62),e.EFF(13),e.k0s(),e.j41(14,"p",63),e.EFF(15),e.k0s(),e.j41(16,"a",64),e.EFF(17,"View Details"),e.k0s()()()),2&a){const t=n.$implicit;e.R7$(6),e.SpI("",t.type," Insurance"),e.R7$(2),e.JRh(t.vehicle||t.property),e.R7$(2),e.JRh(t.id),e.R7$(3),e.JRh(t.status),e.R7$(2),e.SpI("EGP ",null==t.premium?null:t.premium.toLocaleString(),""),e.R7$(),e.Y8G("routerLink",e.eq3(6,Xe,t.id))}}function ct(a,n){if(1&a&&(e.j41(0,"div",50),e.DNE(1,lt,4,0,"div",51)(2,dt,18,8,"div",52),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",0===t.client.policies.length),e.R7$(),e.Y8G("ngForOf",t.client.policies)}}function pt(a,n){1&a&&(e.j41(0,"div",53),e.nrm(1,"i",65),e.j41(2,"p",45),e.EFF(3,"No claims found for this client."),e.k0s()())}function ut(a,n){if(1&a&&(e.j41(0,"div",55)(1,"div",17)(2,"div",66),e.nrm(3,"i",67),e.k0s(),e.j41(4,"div")(5,"h4",58),e.EFF(6),e.k0s(),e.j41(7,"p",59),e.EFF(8),e.k0s(),e.j41(9,"p",60),e.EFF(10),e.k0s()()(),e.j41(11,"div",61)(12,"span",68),e.EFF(13),e.k0s(),e.j41(14,"p",69),e.EFF(15),e.k0s(),e.j41(16,"a",64),e.EFF(17,"View Details"),e.k0s()()()),2&a){const t=n.$implicit;e.R7$(6),e.JRh(t.type),e.R7$(2),e.SpI("Policy: ",t.policyId,""),e.R7$(2),e.JRh(t.date),e.R7$(3),e.JRh(t.status),e.R7$(2),e.SpI("Est. EGP ",null==t.amount?null:t.amount.toLocaleString(),""),e.R7$(),e.Y8G("routerLink",e.eq3(6,Qe,t.id))}}function mt(a,n){if(1&a&&(e.j41(0,"div",50),e.DNE(1,pt,4,0,"div",51)(2,ut,18,8,"div",52),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf",0===t.client.claims.length),e.R7$(),e.Y8G("ngForOf",t.client.claims)}}function gt(a,n){1&a&&(e.j41(0,"div",50)(1,"div",53),e.nrm(2,"i",70),e.j41(3,"p",45),e.EFF(4,"No documents available."),e.k0s()()())}function _t(a,n){if(1&a&&(e.j41(0,"div",71),e.nrm(1,"app-chat-box",72),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("modelName","res.partner")("recordId",t.client.dbId)}}function ht(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",9)(1,"div",10),e.nrm(2,"div",11),e.j41(3,"div",12)(4,"div",13)(5,"a",14),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"span"),e.EFF(9,"/"),e.k0s(),e.j41(10,"span",15),e.EFF(11),e.k0s()(),e.j41(12,"div",16)(13,"div",17)(14,"div",18),e.nrm(15,"i",19),e.k0s(),e.j41(16,"div")(17,"h1",20),e.EFF(18),e.k0s(),e.DNE(19,qe,2,1,"p",21),e.j41(20,"div",22)(21,"span",23),e.nrm(22,"i",24),e.EFF(23),e.k0s(),e.j41(24,"span",23),e.nrm(25,"i",25),e.EFF(26),e.k0s()()()(),e.j41(27,"div",26)(28,"button",27),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.createClaim())}),e.nrm(29,"i",28),e.EFF(30," Intimate Claim "),e.k0s(),e.j41(31,"button",29),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.createQuote())}),e.nrm(32,"i",30),e.EFF(33," New Quote "),e.k0s()()()()(),e.j41(34,"div",31)(35,"div",32),e.DNE(36,Ke,3,6,"button",33),e.k0s()(),e.j41(37,"div",34),e.DNE(38,st,34,13,"div",35)(39,ct,3,2,"div",36)(40,mt,3,2,"div",36)(41,gt,5,0,"div",36),e.k0s(),e.DNE(42,_t,2,2,"div",37),e.k0s()}if(2&a){const t=e.XpG();e.R7$(5),e.Y8G("routerLink",e.lJ4(15,Ue)),e.R7$(),e.JRh(e.bMT(7,13,"DETAILS.CLIENT.BREADCRUMB")),e.R7$(5),e.JRh(t.client.name),e.R7$(7),e.JRh(t.client.name),e.R7$(),e.Y8G("ngIf",t.client.arabicName),e.R7$(4),e.SpI(" ",t.client.email," "),e.R7$(3),e.SpI(" ",t.client.phone," "),e.R7$(10),e.Y8G("ngForOf",e.lJ4(16,Ye)),e.R7$(2),e.Y8G("ngIf","overview"===t.activeTab),e.R7$(),e.Y8G("ngIf","policies"===t.activeTab),e.R7$(),e.Y8G("ngIf","claims"===t.activeTab),e.R7$(),e.Y8G("ngIf","documents"===t.activeTab),e.R7$(),e.Y8G("ngIf",!t.loading&&!t.error&&t.client)}}function ft(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-customer-selection-modal",73),e.bIt("close",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isCustomerModalOpen=!1)})("selectCustomer",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onCustomerSelected(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("isOpen",t.isCustomerModalOpen)("prefilledNationalId",(null==t.client?null:t.client.nationalId)||(null==t.client?null:t.client.id)||"")}}let bt=(()=>{class a{constructor(t,i,r,o){this.route=t,this.router=i,this.customerService=r,this.authService=o,this.clientId="",this.client=null,this.loading=!0,this.error=null,this.activeTab="overview",this.isCustomerModalOpen=!1,this.isChassisModalOpen=!1}ngOnInit(){this.clientId=this.route.snapshot.params.id,this.loadClientDetails()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}loadClientDetails(){this.loading=!0,this.error=null;const t=this.authService.currentUserValue;if(!t)return this.error="User not authenticated",void(this.loading=!1);this.customerService.searchPartners({identification_number:this.clientId,user_id:t.id,user_type:"broker"}).subscribe({next:i=>{const r=i.result?.data||i.data||i;let o;if(o=r.contacts&&Array.isArray(r.contacts)?r.contacts[0]:Array.isArray(r)?r[0]:r.national_id||r.english_name?r:null,!o)return this.error="No customer data found for this ID",void(this.loading=!1);this.client={dbId:o.id,id:o.national_id||o.id||this.clientId,name:o.english_name||o.name||o.partner_name||"Unknown Name",arabicName:o.arabic_name||"",email:o.email||o.partner_email||"N/A",phone:o.phone||o.phone_number||o.mobile||"N/A",mobile:o.mobile||"",address:o.street||o.address||"N/A",city:o.city||"",dateOfBirth:o.date_of_birth||"",gender:o.gender||"",nationalId:o.national_id||"",passportId:o.passport_id||"",isForeignCustomer:o.is_foreign_customer||!1,countryName:o.country_name||"",stateName:o.state_name||"",joinDate:o.created_at||o.create_date||(new Date).toISOString().split("T")[0],status:o.is_customer||o.is_active||o.active?"Active":"Inactive",policies:o.policies||[],claims:o.claims||[]},this.loading=!1},error:i=>{console.error("Error loading client details:",i),this.error=i?.error?.result?.error||i?.error?.message||i?.message||"Failed to load client details",this.loading=!1}})}goBack(){this.router.navigate(["/dashboard/broker/clients"])}setActiveTab(t){this.activeTab=t,setTimeout(()=>{typeof lucide<"u"&&lucide.createIcons()},100)}createQuote(){this.isCustomerModalOpen=!0}createClaim(){this.isChassisModalOpen=!0}onCustomerSelected(t){this.isCustomerModalOpen=!1,this.router.navigate(["/dashboard/broker/quote/new"],{state:{customer:t}})}onChassisValidated(t){this.isChassisModalOpen=!1,this.router.navigate(["/dashboard/broker/claims/new"],{state:{chassisData:t,clientId:this.clientId}})}getTotalPoliciesValue(){return this.client&&this.client.policies?this.client.policies.reduce((t,i)=>t+(i.premium||0),0):0}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(A.m),e.rXU(y.u))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-client-details"]],decls:6,vars:5,consts:[["class","p-8 flex justify-center",4,"ngIf"],["class","p-8 text-center",4,"ngIf"],["class","space-y-8",4,"ngIf"],[3,"isOpen","prefilledNationalId","close","selectCustomer",4,"ngIf"],[3,"close","isOpen"],[1,"p-8","flex","justify-center"],[1,"p-8","text-center"],[1,"text-red-500","mb-4"],[1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700","transition-colors",3,"click"],[1,"space-y-8"],[1,"relative","overflow-hidden","rounded-2xl","p-4","-m-4"],[1,"absolute","inset-0","pointer-events-none","z-0",2,"background-image","url('assets/img/backgrounds/clients-header.svg')","background-repeat","no-repeat","background-position","center","background-size","cover"],[1,"relative","z-10","flex","flex-col","gap-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-200"],[1,"hover:text-white","transition-colors",3,"routerLink"],[1,"text-white","font-medium"],[1,"flex","flex-col","sm:flex-row","sm:items-center","justify-between","gap-4"],[1,"flex","items-center","gap-4"],[1,"w-16","h-16","bg-white/10","backdrop-blur-sm","rounded-full","flex","items-center","justify-center","text-white","border-2","border-white/20","shadow-sm"],["data-lucide","user",1,"w-8","h-8"],[1,"text-2xl","font-bold","text-white"],["class","text-lg text-gray-200 mt-1",4,"ngIf"],[1,"flex","items-center","gap-4","text-sm","text-gray-200","mt-1"],[1,"flex","items-center","gap-1"],["data-lucide","mail",1,"w-3","h-3"],["data-lucide","phone",1,"w-3","h-3"],[1,"flex","items-center","gap-3"],[1,"px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700","transition-colors","flex","items-center","gap-2",3,"click"],["data-lucide","alert-circle",1,"w-4","h-4"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-colors","flex","items-center","gap-2",3,"click"],["data-lucide","plus",1,"w-4","h-4"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"flex","gap-8"],["class","pb-4 text-sm font-medium capitalize transition-all duration-300 relative",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"space-y-6"],["class","space-y-6",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","mt-8",4,"ngIf"],[1,"text-lg","text-gray-200","mt-1"],[1,"pb-4","text-sm","font-medium","capitalize","transition-all","duration-300","relative",3,"click","ngClass"],["class","absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full",4,"ngIf"],[1,"absolute","bottom-0","left-0","right-0","h-0.5","bg-primary","rounded-t-full"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300"],[1,"font-bold","text-navy","dark:text-white","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-y-4","text-sm"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-medium","text-navy","dark:text-white"],[4,"ngIf"],[1,"col-span-2","md:col-span-3","lg:col-span-4"],[1,"font-medium","text-navy","dark:text-white","capitalize"],[1,"space-y-4"],["class","text-center py-12",4,"ngIf"],["class","bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex items-center justify-between hover:shadow-md transition-all duration-300",4,"ngFor","ngForOf"],[1,"text-center","py-12"],["data-lucide","shield",1,"mx-auto","h-12","w-12","text-gray-400","mb-4"],[1,"bg-white","dark:bg-gray-800","p-4","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","flex","items-center","justify-between","hover:shadow-md","transition-all","duration-300"],[1,"w-10","h-10","bg-blue-50","dark:bg-blue-900/30","rounded-lg","flex","items-center","justify-center","text-primary"],["data-lucide","shield",1,"w-5","h-5"],[1,"font-bold","text-navy","dark:text-white"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"text-xs","text-gray-400"],[1,"text-right"],[1,"px-2","py-1","bg-green-100","text-green-800","rounded","text-xs","font-bold","uppercase"],[1,"text-sm","font-bold","text-navy","dark:text-white","mt-1"],[1,"text-xs","text-primary","hover:underline","block","mt-1",3,"routerLink"],["data-lucide","alert-circle",1,"mx-auto","h-12","w-12","text-gray-400","mb-4"],[1,"w-10","h-10","bg-red-50","dark:bg-red-900/30","rounded-lg","flex","items-center","justify-center","text-red-500"],["data-lucide","alert-circle",1,"w-5","h-5"],[1,"px-2","py-1","bg-yellow-100","text-yellow-800","rounded","text-xs","font-bold","uppercase"],[1,"text-sm","font-medium","text-gray-600","dark:text-gray-300","mt-1"],["data-lucide","file-text",1,"mx-auto","h-12","w-12","text-gray-400","mb-4"],[1,"mt-8"],[3,"modelName","recordId"],[3,"close","selectCustomer","isOpen","prefilledNationalId"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout"),e.DNE(1,Je,2,0,"div",0)(2,He,5,1,"div",1)(3,ht,43,17,"div",2)(4,ft,1,2,"app-customer-selection-modal",3),e.j41(5,"app-chassis-validation-modal",4),e.bIt("close",function(){return r.isChassisModalOpen=!1}),e.k0s()()),2&i&&(e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",r.error&&!r.loading),e.R7$(),e.Y8G("ngIf",!r.loading&&!r.error&&r.client),e.R7$(),e.Y8G("ngIf",r.isCustomerModalOpen),e.R7$(),e.Y8G("isOpen",r.isChassisModalOpen))},dependencies:[m.YU,m.Sq,m.bT,h.Wk,v.w,k.N,M,G,B.f,x.D9]})}}return a})();var U=_(7244),c=_(8516);const yt=(a,n,t)=>({"bg-green-100 text-green-800":a,"bg-yellow-100 text-yellow-800":n,"bg-red-100 text-red-800":t}),vt=a=>({"font-semibold bg-gray-50":a});function xt(a,n){1&a&&e.nrm(0,"div",39)}function kt(a,n){1&a&&e.nrm(0,"div",39)}function Ct(a,n){1&a&&e.nrm(0,"div",39)}function Rt(a,n){if(1&a&&(e.j41(0,"div",94)(1,"div",95),e.nrm(2,"div",96),e.k0s()()),2&a){const t=e.XpG(3);e.R7$(2),e.xc7("width",100-t.policy.daysToRenew/365*100,"%")}}function It(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-button",97),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.handleRenewPolicy())}),e.EFF(1),e.k0s()}if(2&a){const t=e.XpG(3);e.Y8G("disabled",t.renewalLoading),e.R7$(),e.SpI(" ",t.getRenewalButtonText()," ")}}function Et(a,n){if(1&a&&(e.j41(0,"span",67),e.EFF(1),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.SpI("(",t.policy.vehicle.roadSideProgram,")")}}function Tt(a,n){if(1&a&&(e.j41(0,"div",40)(1,"div",41)(2,"details",42)(3,"summary",43)(4,"div",44)(5,"div",45),e.nrm(6,"i-lucide",46),e.k0s(),e.j41(7,"div")(8,"h3",47),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"p",48),e.EFF(12),e.nI1(13,"translate"),e.k0s()()(),e.nrm(14,"i-lucide",49),e.k0s(),e.j41(15,"div",50)(16,"div",51)(17,"div",52)(18,"h4",53),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"div",54)(22,"span",55),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"span",56),e.EFF(26),e.nI1(27,"translate"),e.nI1(28,"translate"),e.k0s()(),e.DNE(29,Rt,3,2,"div",57)(30,It,2,2,"app-button",58),e.k0s(),e.j41(31,"div",59)(32,"h4",53),e.EFF(33),e.nI1(34,"translate"),e.k0s(),e.j41(35,"div",60)(36,"span",61),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"span",62),e.EFF(40),e.k0s()(),e.j41(41,"div",60)(42,"span",61),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.j41(45,"span",63),e.EFF(46),e.k0s()(),e.j41(47,"div",60)(48,"span",61),e.EFF(49),e.nI1(50,"translate"),e.k0s(),e.j41(51,"span",62),e.EFF(52),e.k0s()()(),e.j41(53,"div",64)(54,"div",65),e.nrm(55,"i-lucide",24),e.k0s(),e.j41(56,"h4",66),e.EFF(57),e.nI1(58,"translate"),e.k0s(),e.j41(59,"p",67),e.EFF(60),e.nI1(61,"translate"),e.k0s()()()()()(),e.j41(62,"div",68)(63,"h3",69),e.nrm(64,"i-lucide",70),e.EFF(65),e.nI1(66,"translate"),e.k0s(),e.j41(67,"div",71)(68,"div",72)(69,"p",73),e.EFF(70),e.nI1(71,"translate"),e.k0s(),e.j41(72,"p",74),e.EFF(73),e.k0s()(),e.j41(74,"div",72)(75,"p",73),e.EFF(76),e.nI1(77,"translate"),e.k0s(),e.j41(78,"p",75),e.EFF(79),e.k0s()(),e.j41(80,"div",72)(81,"p",73),e.EFF(82),e.nI1(83,"translate"),e.k0s(),e.j41(84,"p",75),e.EFF(85),e.k0s()(),e.j41(86,"div",72)(87,"p",73),e.EFF(88),e.nI1(89,"translate"),e.k0s(),e.j41(90,"p",75),e.EFF(91),e.k0s()(),e.j41(92,"div",76)(93,"p",77),e.nrm(94,"i-lucide",78),e.EFF(95),e.nI1(96,"translate"),e.k0s(),e.j41(97,"p",75),e.EFF(98),e.k0s()()()(),e.j41(99,"div",68)(100,"h3",69),e.nrm(101,"i-lucide",79),e.EFF(102),e.nI1(103,"translate"),e.k0s(),e.j41(104,"div",35)(105,"div")(106,"h4",80),e.nrm(107,"i-lucide",81),e.EFF(108),e.nI1(109,"translate"),e.k0s(),e.j41(110,"div",82)(111,"div",83)(112,"p",84),e.EFF(113,"Make"),e.k0s(),e.j41(114,"p",85),e.EFF(115),e.k0s()(),e.j41(116,"div",83)(117,"p",84),e.EFF(118,"Model"),e.k0s(),e.j41(119,"p",85),e.EFF(120),e.k0s()(),e.j41(121,"div",83)(122,"p",84),e.EFF(123,"Year"),e.k0s(),e.j41(124,"p",85),e.EFF(125),e.k0s()(),e.j41(126,"div",83)(127,"p",84),e.EFF(128,"Color"),e.k0s(),e.j41(129,"p",85),e.EFF(130),e.k0s()(),e.j41(131,"div",83)(132,"p",84),e.EFF(133,"Plate Number"),e.k0s(),e.j41(134,"p",86),e.EFF(135),e.k0s()(),e.j41(136,"div",83)(137,"p",84),e.EFF(138,"Category"),e.k0s(),e.j41(139,"p",85),e.EFF(140),e.k0s()(),e.j41(141,"div",83)(142,"p",84),e.EFF(143,"Body Type"),e.k0s(),e.j41(144,"p",85),e.EFF(145),e.k0s()(),e.j41(146,"div",83)(147,"p",84),e.EFF(148,"Seats"),e.k0s(),e.j41(149,"p",85),e.EFF(150),e.k0s()(),e.j41(151,"div",83)(152,"p",84),e.EFF(153,"Fuel Type"),e.k0s(),e.j41(154,"p",85),e.EFF(155),e.k0s()(),e.j41(156,"div",83)(157,"p",84),e.EFF(158,"Engine CC"),e.k0s(),e.j41(159,"p",85),e.EFF(160),e.k0s()()()(),e.j41(161,"div")(162,"h4",80),e.nrm(163,"i-lucide",87),e.EFF(164," Technical & Coverage Info "),e.k0s(),e.j41(165,"div",88)(166,"div",83)(167,"p",84),e.EFF(168,"Chassis Number"),e.k0s(),e.j41(169,"p",89),e.EFF(170),e.k0s()(),e.j41(171,"div",83)(172,"p",84),e.EFF(173,"Engine Number"),e.k0s(),e.j41(174,"p",89),e.EFF(175),e.k0s()(),e.j41(176,"div",83)(177,"p",84),e.EFF(178,"Usage"),e.k0s(),e.j41(179,"p",85),e.EFF(180),e.k0s()(),e.j41(181,"div",83)(182,"p",84),e.EFF(183,"Sum Insured"),e.k0s(),e.j41(184,"p",90),e.EFF(185),e.nI1(186,"number"),e.k0s()(),e.j41(187,"div",83)(188,"p",84),e.EFF(189,"Roadside Assistance"),e.k0s(),e.j41(190,"div",91)(191,"span",92),e.EFF(192),e.k0s(),e.DNE(193,Et,2,1,"span",93),e.k0s()()()()()()()),2&a){const t=e.XpG(2);e.R7$(2),e.Y8G("open",!1),e.R7$(7),e.JRh(e.bMT(10,50,"DETAILS.POLICY.HIGHLIGHTS.TITLE")),e.R7$(3),e.JRh(e.bMT(13,52,"DETAILS.POLICY.HIGHLIGHTS.SUBTITLE")),e.R7$(7),e.SpI("",e.bMT(20,54,"DETAILS.POLICY.HIGHLIGHTS.RENEWAL")," "),e.R7$(4),e.JRh(e.bMT(24,56,"DETAILS.POLICY.HIGHLIGHTS.STATUS")),e.R7$(2),e.Y8G("ngClass",e.sMw(92,yt,t.policy.daysToRenew>30,t.policy.daysToRenew<=30&&t.policy.daysToRenew>0,t.policy.daysToRenew<=0)),e.R7$(),e.SpI(" ",t.policy.daysToRenew>0?t.policy.daysToRenew+" "+e.bMT(27,58,"DETAILS.POLICY.HIGHLIGHTS.DAYS_LEFT"):e.bMT(28,60,"DETAILS.POLICY.HIGHLIGHTS.EXPIRED")," "),e.R7$(3),e.Y8G("ngIf",null!==(null==t.policy?null:t.policy.daysToRenew)),e.R7$(),e.Y8G("ngIf",t.canRenew()),e.R7$(3),e.SpI("",e.bMT(34,62,"DETAILS.POLICY.HIGHLIGHTS.IMPORTANT_DATES")," "),e.R7$(4),e.JRh(e.bMT(38,64,"DETAILS.POLICY.HIGHLIGHTS.START_DATE")),e.R7$(3),e.JRh(t.policy.coverage.startDate),e.R7$(3),e.JRh(e.bMT(44,66,"DETAILS.POLICY.HIGHLIGHTS.END_DATE")),e.R7$(3),e.JRh(t.policy.coverage.endDate),e.R7$(3),e.JRh(e.bMT(50,68,"DETAILS.POLICY.HIGHLIGHTS.ISSUE_DATE")),e.R7$(3),e.JRh(t.policy.issueDate),e.R7$(5),e.JRh(e.bMT(58,70,"DETAILS.POLICY.HIGHLIGHTS.FULLY_PAID")),e.R7$(3),e.JRh(e.bMT(61,72,"DETAILS.POLICY.HIGHLIGHTS.ALL_SETTLED")),e.R7$(5),e.SpI(" ",e.bMT(66,74,"DETAILS.POLICY.HOLDER.TITLE")," "),e.R7$(5),e.SpI(" ",e.bMT(71,76,"DETAILS.POLICY.HOLDER.FULL_NAME"),""),e.R7$(2),e.FS9("title",t.policy.policyHolder.name),e.R7$(),e.JRh(t.policy.policyHolder.name),e.R7$(3),e.SpI(" ",e.bMT(77,78,"DETAILS.POLICY.HOLDER.NATIONAL_ID"),""),e.R7$(3),e.SpI("",t.policy.policyHolder.nationalId," "),e.R7$(3),e.SpI(" ",e.bMT(83,80,"DETAILS.POLICY.HOLDER.GROUP"),""),e.R7$(3),e.SpI("",t.policy.policyHolder.group," "),e.R7$(3),e.SpI(" ",e.bMT(89,82,"DETAILS.POLICY.HOLDER.ACTIVITY"),""),e.R7$(3),e.SpI("",t.policy.policyHolder.activity," "),e.R7$(4),e.SpI(" ",e.bMT(96,84,"DETAILS.POLICY.HOLDER.ADDRESS")," "),e.R7$(3),e.SpI("",t.policy.policyHolder.address," "),e.R7$(4),e.SpI(" ",e.bMT(103,86,"DETAILS.POLICY.VEHICLE.TITLE")," "),e.R7$(6),e.SpI(" ",e.bMT(109,88,"DETAILS.POLICY.VEHICLE.GENERAL")," "),e.R7$(7),e.SpI("",t.policy.vehicle.make," "),e.R7$(5),e.SpI("",t.policy.vehicle.model," "),e.R7$(5),e.SpI("",t.policy.vehicle.year," "),e.R7$(5),e.SpI("",t.policy.vehicle.color," "),e.R7$(5),e.SpI(" ",t.policy.vehicle.plateNumber,""),e.R7$(5),e.SpI("",t.policy.vehicle.category," "),e.R7$(5),e.SpI("",t.policy.vehicle.bodyType," "),e.R7$(5),e.SpI("",t.policy.vehicle.seats," Persons"),e.R7$(5),e.SpI("",t.policy.vehicle.fuelType," "),e.R7$(5),e.SpI("",t.policy.vehicle.cc," CC "),e.R7$(10),e.SpI(" ",t.policy.vehicle.chassisNumber,""),e.R7$(5),e.SpI(" ",t.policy.vehicle.engineNumber,""),e.R7$(5),e.SpI("",t.policy.vehicle.usage," "),e.R7$(5),e.Lme("",t.policy.currency," ",e.bMT(186,90,t.policy.vehicle.estimatedValue),""),e.R7$(6),e.Y8G("ngClass","Included"===t.policy.vehicle.roadSide?"text-green-600 bg-green-50 border-green-200":"text-gray-500 bg-gray-50 border-gray-200"),e.R7$(),e.SpI(" ",t.policy.vehicle.roadSide," "),e.R7$(),e.Y8G("ngIf","Included"===t.policy.vehicle.roadSide)}}function Ft(a,n){if(1&a&&(e.j41(0,"p",67),e.EFF(1),e.nI1(2,"number"),e.k0s()),2&a){const t=e.XpG().$implicit,i=e.XpG(4);e.R7$(),e.Lme("SI: ",i.policy.currency," ",e.bMT(2,2,t.si_now),"")}}function St(a,n){if(1&a&&(e.j41(0,"div",110)(1,"span",111),e.EFF(2),e.k0s(),e.j41(3,"div",112)(4,"p",113),e.EFF(5),e.nI1(6,"number"),e.k0s(),e.DNE(7,Ft,3,4,"p",93),e.k0s()()),2&a){const t=n.$implicit,i=e.XpG(4);e.R7$(2),e.JRh(t.cover_name),e.R7$(3),e.Lme("",i.policy.currency," ",e.bMT(6,4,t.net_premium),""),e.R7$(2),e.Y8G("ngIf",t.si_now>0)}}function wt(a,n){if(1&a&&(e.j41(0,"div",41)(1,"details",42)(2,"summary",43)(3,"div",44)(4,"div",103),e.nrm(5,"i-lucide",104),e.k0s(),e.j41(6,"div")(7,"h3",100),e.EFF(8),e.k0s(),e.j41(9,"p",48),e.EFF(10),e.k0s()()(),e.j41(11,"div",44)(12,"div",105)(13,"p",106),e.EFF(14,"Cover Amount"),e.k0s(),e.j41(15,"p",107),e.EFF(16),e.nI1(17,"number"),e.k0s()(),e.nrm(18,"i-lucide",49),e.k0s()(),e.j41(19,"div",50)(20,"div",108),e.DNE(21,St,8,6,"div",109),e.k0s()()()()),2&a){const t=n.$implicit,i=n.index,r=e.XpG(3);e.R7$(),e.Y8G("open",!1),e.R7$(7),e.SpI("Risk #",i+1," Coverage "),e.R7$(2),e.Lme("",t.vehicle_make_name," ",t.vehicle_model_name,""),e.R7$(6),e.Lme("",r.policy.currency," ",e.bMT(17,7,r.getRiskCoverAmount(t)),""),e.R7$(5),e.Y8G("ngForOf",t.risk_covers)}}function jt(a,n){if(1&a&&(e.j41(0,"div",114),e.nrm(1,"i-lucide",115),e.j41(2,"span",116),e.EFF(3),e.k0s()()),2&a){const t=n.$implicit;e.R7$(3),e.JRh(t.condition_name)}}function Nt(a,n){if(1&a&&(e.j41(0,"div",40),e.DNE(1,wt,22,9,"div",98),e.j41(2,"div",41)(3,"details",42)(4,"summary",43)(5,"div",44)(6,"div",45),e.nrm(7,"i-lucide",99),e.k0s(),e.j41(8,"div")(9,"h3",100),e.EFF(10,"Policy Conditions"),e.k0s(),e.j41(11,"p",48),e.EFF(12,"Terms and clauses applicable to this policy "),e.k0s()()(),e.nrm(13,"i-lucide",49),e.k0s(),e.j41(14,"div",50)(15,"div",101),e.DNE(16,jt,4,1,"div",102),e.k0s()()()()()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.policy.coverage.risks),e.R7$(2),e.Y8G("open",!1),e.R7$(13),e.Y8G("ngForOf",t.policy.coverage.conditions)}}function Dt(a,n){if(1&a&&(e.j41(0,"div",123)(1,"span",61),e.EFF(2),e.k0s(),e.j41(3,"span",124),e.EFF(4),e.nI1(5,"number"),e.k0s()()),2&a){const t=n.$implicit,i=e.XpG(3);e.Y8G("ngClass",e.eq3(6,vt,"10001"===t.charge_code||"10002"===t.charge_code)),e.R7$(2),e.JRh(t.charge_name),e.R7$(2),e.Lme("",i.policy.currency," ",e.bMT(5,4,t.charge_value),"")}}function Ot(a,n){if(1&a&&(e.j41(0,"div",117)(1,"details",42)(2,"summary",43)(3,"div",44)(4,"div",118),e.nrm(5,"i-lucide",119),e.k0s(),e.j41(6,"div")(7,"h3",100),e.EFF(8,"Gross Premium"),e.k0s(),e.j41(9,"p",48),e.EFF(10,"Total payable amount"),e.k0s()()(),e.j41(11,"div",44)(12,"span",120),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.nrm(15,"i-lucide",49),e.k0s()(),e.j41(16,"div",50)(17,"div",121),e.DNE(18,Dt,6,8,"div",122),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("open",!1),e.R7$(12),e.Lme("",t.policy.currency," ",e.bMT(14,4,t.policy.premium.total),""),e.R7$(5),e.Y8G("ngForOf",t.policy.premium.breakdown)}}function At(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",2)(1,"div",3),e.nrm(2,"div",4),e.j41(3,"div",5)(4,"div",6)(5,"button",7),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"i-lucide",8),e.j41(9,"span",9),e.EFF(10),e.k0s()(),e.j41(11,"div",10)(12,"div",11)(13,"div",12),e.nrm(14,"i-lucide",13),e.k0s(),e.j41(15,"div")(16,"h1",14),e.EFF(17),e.k0s(),e.j41(18,"p",15),e.EFF(19),e.k0s(),e.j41(20,"div",16)(21,"span",17),e.EFF(22),e.k0s(),e.j41(23,"span",18),e.nrm(24,"i-lucide",19),e.EFF(25),e.k0s(),e.j41(26,"span",18),e.nrm(27,"i-lucide",20),e.EFF(28),e.k0s(),e.j41(29,"span",18),e.nrm(30,"i-lucide",21),e.EFF(31),e.k0s()()()(),e.j41(32,"div",22)(33,"span",23),e.nrm(34,"i-lucide",24),e.EFF(35),e.k0s(),e.j41(36,"app-button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.handleDownloadPdf())}),e.nrm(37,"i-lucide",26),e.EFF(38),e.nI1(39,"translate"),e.nI1(40,"translate"),e.k0s(),e.j41(41,"app-button",27),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.endorsePolicy())}),e.EFF(42),e.nI1(43,"translate"),e.k0s()()()()(),e.j41(44,"div",28)(45,"nav",29)(46,"button",30),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.setActiveTab("overview"))}),e.nrm(47,"i-lucide",31),e.EFF(48),e.nI1(49,"translate"),e.DNE(50,xt,1,0,"div",32),e.k0s(),e.j41(51,"button",30),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.setActiveTab("coverage"))}),e.nrm(52,"i-lucide",33),e.EFF(53),e.nI1(54,"translate"),e.DNE(55,kt,1,0,"div",32),e.k0s(),e.j41(56,"button",30),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.setActiveTab("premium"))}),e.nrm(57,"i-lucide",34),e.EFF(58),e.nI1(59,"translate"),e.DNE(60,Ct,1,0,"div",32),e.k0s()()(),e.j41(61,"div",35)(62,"div",2),e.DNE(63,Tt,194,96,"div",36)(64,Nt,17,3,"div",36)(65,Ot,19,6,"div",37),e.k0s(),e.nrm(66,"app-chat-box",38),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(6),e.JRh(e.bMT(7,27,"DETAILS.POLICY.BREADCRUMB")),e.R7$(4),e.JRh(t.policy.policyNumber),e.R7$(7),e.SpI("",t.policy.policyHolder.name," "),e.R7$(2),e.SpI("Policy #",t.policy.policyNumber,""),e.R7$(3),e.SpI(" ",t.policy.transactionType," "),e.R7$(3),e.SpI(" ",t.policy.productName," "),e.R7$(3),e.SpI(" ",t.policy.branchName," "),e.R7$(3),e.Lme(" Effective: ",t.policy.effectiveDate," - ",t.policy.expiryDate," "),e.R7$(4),e.SpI(" ",t.policy.status," "),e.R7$(),e.Y8G("disabled",t.downloading),e.R7$(2),e.SpI(" ",t.downloading?e.bMT(39,29,"DETAILS.POLICY.DOWNLOADING"):e.bMT(40,31,"DETAILS.POLICY.DOWNLOAD_PDF")," "),e.R7$(4),e.SpI(" ",e.bMT(43,33,"DETAILS.POLICY.CREATE_ENDORSEMENT")," "),e.R7$(4),e.Y8G("ngClass","overview"===t.activeTab?"text-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700"),e.R7$(2),e.SpI(" ",e.bMT(49,35,"DETAILS.POLICY.TABS.OVERVIEW")," "),e.R7$(2),e.Y8G("ngIf","overview"===t.activeTab),e.R7$(),e.Y8G("ngClass","coverage"===t.activeTab?"text-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700"),e.R7$(2),e.SpI(" ",e.bMT(54,37,"DETAILS.POLICY.TABS.COVERAGE")," "),e.R7$(2),e.Y8G("ngIf","coverage"===t.activeTab),e.R7$(),e.Y8G("ngClass","premium"===t.activeTab?"text-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700"),e.R7$(2),e.SpI(" ",e.bMT(59,39,"DETAILS.POLICY.TABS.PREMIUM")," "),e.R7$(2),e.Y8G("ngIf","premium"===t.activeTab),e.R7$(3),e.Y8G("ngIf","overview"===t.activeTab),e.R7$(),e.Y8G("ngIf","coverage"===t.activeTab),e.R7$(),e.Y8G("ngIf","premium"===t.activeTab),e.R7$(),e.Y8G("modelName","insurance.policy")("recordId",t.policy.id)}}function Mt(a,n){1&a&&(e.j41(0,"div",125),e.nrm(1,"app-loading-spinner",126),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.Y8G("loading",!0)("message",e.bMT(2,2,"DETAILS.POLICY.LOADING")))}function Lt(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",125)(1,"div",127),e.nrm(2,"i-lucide",128),e.j41(3,"h2",129),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",130),e.EFF(7),e.k0s(),e.j41(8,"app-button",131),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.nrm(9,"i-lucide",132),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,3,"DETAILS.POLICY.ERROR_LOADING")),e.R7$(3),e.JRh(t.error),e.R7$(3),e.SpI(" ",e.bMT(11,5,"DETAILS.POLICY.BACK_TO_POLICIES")," ")}}let Pt=(()=>{class a{constructor(t,i,r,o,s,l,d){this.route=t,this.router=i,this.policyService=r,this.quoteService=o,this.crmService=s,this.authService=l,this.notificationService=d,this.policyId="",this.policy=null,this.loading=!0,this.error=null,this.activeTab="overview",this.downloading=!1,this.renewalRequest=null,this.renewalLoading=!1,this.renewalError=null}ngOnInit(){this.policyId=this.route.snapshot.params.id,this.loadPolicyDetails()}loadPolicyDetails(){var t=this;return(0,b.A)(function*(){if(t.policyId)try{t.loading=!0,t.error=null;const i=yield t.policyService.getPolicy(Number(t.policyId)).toPromise(),r=i?.result?.data||i?.data||i;if(!r)return t.error="No policy data found",void(t.loading=!1);const o=r.policy_risks?.[0]||{},s=r.policy_premium_summary?.[0]||{},l=r.policy_risk_premium_summary?.[0]||{};t.policy={id:r.policy_number||r.parent_policy_number||r.id||t.policyId,policyNumber:r.policy_number||r.parent_policy_number||"Draft",status:(r.policy_state||"draft").toLowerCase(),transactionType:r.transaction_type||"N/A",issueDate:r.issue_date||"N/A",approveDate:r.approve_date||"N/A",effectiveDate:r.effective_from_date||"N/A",expiryDate:r.effective_to_date||"N/A",lob:"Motor Insurance",productName:r.product_name||"N/A",branchName:r.issuing_branch||"N/A",salesPerson:r.sales_person||"N/A",salesTeam:r.sales_team||"N/A",currency:r.currency||"EGP",policyHolder:{name:r.customer_name||r.insured_name||"N/A",nationalId:r.customer_national_id||"N/A",dateOfBirth:o.date_of_birth||"N/A",phone:o.phone||"N/A",email:o.email||"N/A",address:r.customer_address||"N/A",group:r.customer_group||"N/A",activity:r.customer_activity||"N/A"},vehicle:{make:o.vehicle_make_name||o.vehicle_make||"N/A",model:o.vehicle_model_name||o.vehicle_model||"N/A",year:o.vehicle_manufacturing_year||"N/A",category:o.vehicle_category_name||o.vehicle_category||"N/A",plateNumber:o.plate_number||o.vehicle_plate_number||"N/A",chassisNumber:o.vehicle_chassis_number||"N/A",engineNumber:o.vehicle_engine_number||"N/A",color:o.vehicle_color||"N/A",bodyType:o.vehicle_body_type_name||o.vehicle_body_type||"N/A",fuelType:o.vehicle_fuel_type_name||o.vehicle_fuel_type||"N/A",cc:o.vehicle_cc_name||o.vehicle_cc||"N/A",seats:o.vehicle_number_of_seats||5,usage:o.vehicle_usage_name||o.vehicle_usage||"N/A",estimatedValue:o.vehicle_sum_insured||0,kilometres:o.vehicle_kilometres||0,roadSide:o.vehicle_has_road_side_program?"Included":"Not Included",roadSideProgram:o.vehicle_road_side_program_name||"N/A"},coverage:{type:r.product_name||"Comprehensive",sumInsured:o.vehicle_sum_insured||0,deductible:o.deductible||0,startDate:r.effective_from_date||"N/A",endDate:r.effective_to_date||"N/A",duration:r.policy_period_in_days?`${r.policy_period_in_days} Days`:"12 Months",extensions:r.policy_conditions?.map(d=>d.condition_name||d.name).filter(Boolean)||[],risks:r.policy_risks||[],conditions:r.policy_conditions||[]},premium:{base:s.net_premium||l.net_premium||0,discounts:[],loadings:[],taxes:[],fees:r.issue_fees||0,total:(()=>{let d=r.gross_premium||s.gross_premium||0;if(!d&&r.policy_charges){const g=r.policy_charges.find(p=>"gross premium"===p.charge_name?.toLowerCase());g&&(d=g.charge_value)}return d})(),breakdown:(()=>{const d=r.policy_charges||[],g=new Map;return d.forEach(p=>{const f=p.charge_code||p.charge_name;f&&!g.has(f)&&g.set(f,p)}),Array.from(g.values())})()},payments:[],history:[],invoicePaid:"paid"===r.payment_status,current:r.is_current||!1,isRenewal:r.policy_renewal_version>0,parentPolicyNumber:r.parent_policy_number||null,policyVersion:r.policy_version||1,daysToRenew:t.calculateDaysToRenew(r.effective_to_date),broker:r.broker_name||"N/A",paymentStatus:r.payment_status||"outstanding"},t.loading=!1}catch(i){console.error("Error fetching policy details:",i),t.error=i?.message||"Failed to load policy details",t.loading=!1}})()}loadRenewalRequests(){var t=this;return(0,b.A)(function*(){const i=t.authService.currentUserValue;if(i?.id)try{t.renewalLoading=!0,t.renewalError=null;const r=yield t.crmService.getRenewalRequests({user_id:i.id,user_type:"broker",limit:10,offset:0,domain:JSON.stringify([["policy_id","=",t.policyId]])}).toPromise(),o=r?.result?.data||r?.data||r;if(Array.isArray(o)){const s=o.find(l=>l.policy_id===t.policyId||l.policy_number===t.policy.policyNumber);t.renewalRequest=s||null}else o&&(t.renewalRequest=o)}catch(r){console.error("Error fetching renewal requests:",r),t.renewalError=r?.message||"Failed to load renewal information"}finally{t.renewalLoading=!1}})()}calculateDaysToRenew(t){if(!t)return null;try{const i=new Date(t),r=new Date,o=i.getTime()-r.getTime();return Math.ceil(o/864e5)}catch(i){return console.error("Error calculating days to renewal:",i),null}}handleDownloadPdf(){var t=this;return(0,b.A)(function*(){try{t.downloading=!0;const i=yield t.policyService.downloadPolicyPdf(Number(t.policyId)).toPromise();if(i){const r=window.URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=`Policy_${t.policy?.policyNumber||t.policyId}.pdf`,o.click(),window.URL.revokeObjectURL(r)}}catch(i){console.error("Error downloading policy PDF:",i),t.notificationService.error("Failed to download policy PDF. Please try again.")}finally{t.downloading=!1}})()}handleRenewPolicy(){var t=this;return(0,b.A)(function*(){try{t.renewalLoading=!0,t.renewalError=null;const i=yield t.policyService.renewPolicy(t.policy.policyNumber).toPromise(),r=i?.result||i;if(r&&!0===r.success)t.notificationService.success("Renewal Request Created Successfully!"),window.location.reload();else{const o=r?.error||r?.message||"Failed to create renewal request";t.notificationService.error(o),t.renewalError=o}}catch(i){console.error("Error creating renewal request:",i);const r=i?.error?.result?.error||i?.error?.error||i?.error?.message||i?.message||"Failed to create renewal request";t.notificationService.error(r),t.renewalError=r}finally{t.renewalLoading=!1}})()}goBack(){this.router.navigate(["/dashboard/broker/policies"])}setActiveTab(t){this.activeTab=t}endorsePolicy(){this.router.navigate(["/dashboard/broker/endorsement",this.policyId])}calculateNetPremium(){if(!this.policy)return 0;let t=this.policy.premium.base;return this.policy.premium.discounts.forEach(i=>t+=i.amount),this.policy.premium.loadings.forEach(i=>t+=i.amount),t}getRenewalButtonText(){return this.renewalLoading?"Processing...":this.renewalRequest?"Renewal Requested":"Renew Policy"}canRenew(){return!this.renewalRequest&&!this.renewalLoading}getRiskCoverAmount(t){const i=t.risk_covers?.find(r=>r.cover_name?.toLowerCase().includes("comprehensive")||r.cover_name?.toLowerCase().includes("own damage"));return i?i.si_now:t.vehicle_sum_insured||0}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(w.m),e.rXU(U.K),e.rXU(j.u),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-policy-details"]],decls:4,vars:3,consts:[["class","space-y-6",4,"ngIf"],["class","flex items-center justify-center h-96",4,"ngIf"],[1,"space-y-6"],[1,"mb-8","animate-fadeIn","relative","overflow-hidden","rounded-2xl","p-4","-m-4"],[1,"absolute","inset-0","pointer-events-none","z-0",2,"background-image","url('assets/img/backgrounds/policy-header.svg')","background-repeat","no-repeat","background-position","center","background-size","cover"],[1,"relative","z-10"],[1,"flex","items-center","gap-2","text-sm","text-gray-200","mb-4"],[1,"hover:text-white","transition-all","duration-300",3,"click"],["name","chevron-right",1,"w-4","h-4"],[1,"text-white","font-medium"],[1,"flex","flex-col","lg:flex-row","lg:items-center","justify-between","gap-4"],[1,"flex","items-start","gap-4"],[1,"w-14","h-14","bg-white/10","backdrop-blur-sm","rounded-xl","flex","items-center","justify-center","text-white","shadow-lg","border","border-white/20"],["name","user",1,"w-7","h-7"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-lg","text-gray-200","font-medium","mb-2"],[1,"flex","flex-wrap","items-center","gap-3","text-sm","text-gray-200"],[1,"flex","items-center","gap-1","bg-white/20","px-2","py-0.5","rounded","text-xs","font-semibold","uppercase","text-white"],[1,"flex","items-center","gap-1"],["name","package",1,"w-3.5","h-3.5"],["name","map-pin",1,"w-3.5","h-3.5"],["name","calendar",1,"w-3.5","h-3.5"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"px-4","py-2","bg-green-100","text-green-800","rounded-full","text-sm","font-semibold","capitalize","flex","items-center","gap-2","animate-slideIn"],["name","check-circle",1,"w-4","h-4"],["variant","outline",1,"hover:scale-105","transition-transform",3,"click","disabled"],["name","download",1,"w-4","h-4","mr-2"],["variant","primary",3,"click"],[1,"border-b","border-gray-200","mb-6","animate-fadeIn",2,"animation-delay","100ms"],[1,"flex","gap-8","overflow-x-auto"],[1,"pb-4","px-2","text-sm","font-medium","capitalize","transition-all","relative","whitespace-nowrap","flex","items-center","gap-2",3,"click","ngClass"],["name","file-text",1,"w-4","h-4"],["class","absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-t-full animate-slideIn",4,"ngIf"],["name","shield",1,"w-4","h-4"],["name","dollar-sign",1,"w-4","h-4"],[1,"space-y-8"],["class","space-y-6 animate-fadeIn",4,"ngIf"],["class","bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-all duration-300 animate-fadeIn group overflow-hidden",4,"ngIf"],[3,"modelName","recordId"],[1,"absolute","bottom-0","left-0","right-0","h-0.5","bg-gradient-to-r","from-blue-500","to-blue-600","rounded-t-full","animate-slideIn"],[1,"space-y-6","animate-fadeIn"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","overflow-hidden"],[1,"group",3,"open"],[1,"flex","items-center","justify-between","p-6","cursor-pointer","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","bg-indigo-100","dark:bg-indigo-900/30","rounded-lg","flex","items-center","justify-center","text-indigo-600"],["name","info",1,"w-5","h-5"],[1,"font-bold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500"],["name","chevron-down",1,"w-5","h-5","text-gray-400","transition-transform","group-open:rotate-180"],[1,"px-6","pb-6","pt-0","border-t","border-gray-100","dark:border-gray-700"],[1,"mt-6","grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"space-y-4","p-4","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],[1,"font-bold","text-sm","text-gray-900","dark:text-white","mb-2"],[1,"flex","items-center","justify-between"],[1,"text-gray-600","dark:text-gray-300","text-xs"],[1,"px-2","py-0.5","rounded-full","text-xs","font-semibold",3,"ngClass"],["class","relative pt-1",4,"ngIf"],["variant","primary","size","sm","class","w-full",3,"disabled","click",4,"ngIf"],[1,"space-y-3","p-4","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],[1,"flex","justify-between","text-xs"],[1,"text-gray-600","dark:text-gray-300"],[1,"font-medium"],[1,"font-medium","text-primary"],[1,"p-4","bg-gray-50","dark:bg-gray-700/30","rounded-lg","text-center","flex","flex-col","justify-center","items-center"],[1,"inline-flex","items-center","justify-center","w-8","h-8","rounded-full","bg-green-100","text-green-600","mb-2"],[1,"font-bold","text-sm","text-gray-900","dark:text-white"],[1,"text-xs","text-gray-500"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","group"],[1,"font-bold","text-gray-900","dark:text-white","mb-4","flex","items-center","gap-2","border-b","border-gray-100","dark:border-gray-700","pb-2"],["name","user",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6","text-sm"],[1,"space-y-1","min-w-0"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"font-medium","text-gray-900","dark:text-white","truncate",3,"title"],[1,"font-medium","text-gray-900","dark:text-white"],[1,"space-y-1","md:col-span-2","lg:col-span-4","min-w-0"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","flex","items-center","gap-1"],["name","map-pin",1,"w-3","h-3"],["name","car",1,"w-5","h-5","text-primary"],[1,"text-xs","font-bold","text-primary","uppercase","tracking-wider","mb-4","flex","items-center","gap-1","opacity-80"],["name","info",1,"w-3","h-3"],[1,"grid","grid-cols-2","md:grid-cols-3","xl:grid-cols-5","gap-6","text-sm"],[1,"space-y-1"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"font-bold","text-gray-900","dark:text-white","bg-gray-50","px-2","py-0.5","rounded","inline-block","border","border-gray-200"],["name","settings",1,"w-3","h-3"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-4","gap-6","text-sm"],[1,"font-mono","font-medium","text-gray-900","dark:text-white","text-xs","select-all","bg-gray-50","p-1.5","rounded","border","border-gray-100"],[1,"font-bold","text-green-600","dark:text-green-400"],[1,"flex","items-center","gap-2"],[1,"px-2","py-0.5","rounded","text-xs","font-semibold","border",3,"ngClass"],["class","text-xs text-gray-500",4,"ngIf"],[1,"relative","pt-1"],[1,"overflow-hidden","h-1.5","mb-1","text-xs","flex","rounded","bg-blue-200"],[1,"shadow-none","flex","flex-col","text-center","whitespace-nowrap","text-white","justify-center","bg-primary"],["variant","primary","size","sm",1,"w-full",3,"click","disabled"],["class","bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",4,"ngFor","ngForOf"],["name","file-text",1,"w-5","h-5"],[1,"font-bold","text-navy","dark:text-white"],[1,"mt-4","grid","grid-cols-1","md:grid-cols-2","gap-3"],["class","flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg",4,"ngFor","ngForOf"],[1,"w-10","h-10","bg-blue-100","dark:bg-blue-900/30","rounded-lg","flex","items-center","justify-center","text-primary"],["name","shield",1,"w-5","h-5"],[1,"text-right","mr-2","hidden","sm:block"],[1,"text-xs","text-gray-500","uppercase","font-semibold"],[1,"font-bold","text-primary"],[1,"mt-4","grid","gap-3"],["class","flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],[1,"text-sm","font-medium","text-navy","dark:text-white"],[1,"text-right"],[1,"text-sm","font-bold","text-navy","dark:text-white"],[1,"flex","items-start","gap-3","p-3","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],["name","check-circle",1,"w-4","h-4","text-indigo-500","mt-0.5","flex-shrink-0"],[1,"text-sm","text-gray-700","dark:text-gray-300"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","animate-fadeIn","group","overflow-hidden"],[1,"w-10","h-10","bg-green-100","dark:bg-green-900/30","rounded-lg","flex","items-center","justify-center","text-green-600"],["name","dollar-sign",1,"w-5","h-5"],[1,"text-2xl","font-bold","text-primary"],[1,"mt-4","space-y-4"],["class","flex justify-between items-center py-2 text-sm border-b border-gray-50 last:border-0 hover:bg-gray-50 px-2 rounded transition-colors",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","py-2","text-sm","border-b","border-gray-50","last:border-0","hover:bg-gray-50","px-2","rounded","transition-colors",3,"ngClass"],[1,"font-medium","text-navy","dark:text-white"],[1,"flex","items-center","justify-center","h-96"],[3,"loading","message"],[1,"text-center"],["name","alert-circle",1,"h-12","w-12","text-red-500","mx-auto","mb-4"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300","mb-4"],[3,"click"],["name","chevron-left",1,"w-4","h-4","mr-2"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout"),e.DNE(1,At,67,41,"div",0)(2,Mt,3,4,"div",1)(3,Lt,12,7,"div",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",!r.loading&&r.policy),e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",r.error))},dependencies:[m.YU,m.Sq,m.bT,v.w,N.Q,k.N,c.WGl,B.f,m.QX,x.D9]})}}return a})();const $t=["*"];function Gt(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onBackdropClick(r))}),e.nrm(1,"div",2),e.j41(2,"div",3)(3,"div",4)(4,"div",5)(5,"h3",6),e.EFF(6),e.k0s(),e.j41(7,"button",7),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onClose())}),e.qSk(),e.j41(8,"svg",8),e.nrm(9,"path",9),e.k0s()()(),e.joV(),e.j41(10,"div",10),e.SdG(11),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(3),e.Y8G("ngClass",t.getSizeClass()),e.R7$(3),e.JRh(t.title)}}let Bt=(()=>{class a{constructor(){this.isOpen=!1,this.title="",this.size="md",this.close=new e.bkB}getSizeClass(){return{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl","2xl":"max-w-6xl"}[this.size]}onClose(){this.close.emit()}onBackdropClick(t){t.target===t.currentTarget&&this.onClose()}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-modal"]],inputs:{isOpen:"isOpen",title:"title",size:"size"},outputs:{close:"close"},ngContentSelectors:$t,decls:1,vars:1,consts:[["class","fixed inset-0 z-50 overflow-y-auto",3,"click",4,"ngIf"],[1,"fixed","inset-0","z-50","overflow-y-auto",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","transition-opacity"],[1,"flex","min-h-screen","items-center","justify-center","p-4"],[1,"relative","bg-white","dark:bg-gray-800","rounded-lg","shadow-xl","w-full","transform","transition-all",3,"ngClass"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200","dark:border-gray-700"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],[1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-200","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6"]],template:function(i,r){1&i&&(e.NAR(),e.DNE(0,Gt,12,2,"div",0)),2&i&&e.Y8G("ngIf",r.isOpen)},dependencies:[m.YU,m.bT],styles:["[_nghost-%COMP%]{display:contents}"]})}}return a})();var D=_(9969);const Ut=(a,n,t)=>({"w-16 h-16 rounded-2xl shadow-[0_0_25px_rgba(59,130,246,0.6)] bg-gradient-to-br from-blue-500 to-blue-700 text-white":a,"w-12 h-12 rounded-full bg-green-500 text-white":n,"w-12 h-12 rounded-full border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-400":t}),Yt=(a,n,t)=>({"text-blue-600 dark:text-blue-400":a,"text-green-500 dark:text-green-400":n,"text-gray-400 dark:text-gray-500":t});function Vt(a,n){1&a&&e.nrm(0,"i",14)}function Xt(a,n){if(1&a&&(e.j41(0,"span",15),e.EFF(1),e.k0s()),2&a){const t=e.XpG().index,i=e.XpG();e.Y8G("ngClass",t===i.currentStep?"text-xl font-bold":"text-lg font-bold"),e.R7$(),e.SpI(" ",t+1," ")}}function Qt(a,n){1&a&&e.nrm(0,"div",16)}function Jt(a,n){if(1&a&&(e.j41(0,"span",17),e.EFF(1),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.description," ")}}function Ht(a,n){if(1&a&&(e.j41(0,"div",6)(1,"div",7),e.DNE(2,Vt,1,0,"i",8)(3,Xt,2,2,"span",9)(4,Qt,1,0,"div",10),e.k0s(),e.j41(5,"div",11)(6,"span",12),e.EFF(7),e.k0s(),e.DNE(8,Jt,2,1,"span",13),e.k0s()()),2&a){const t=n.$implicit,i=n.index,r=e.XpG();e.R7$(),e.xc7("margin-top",i===r.currentStep?"0":"2px"),e.Y8G("ngClass",e.sMw(9,Ut,i===r.currentStep,i<r.currentStep,i>r.currentStep)),e.R7$(),e.Y8G("ngIf",i<r.currentStep),e.R7$(),e.Y8G("ngIf",i>=r.currentStep),e.R7$(),e.Y8G("ngIf",i===r.currentStep),e.R7$(2),e.Y8G("ngClass",e.sMw(13,Yt,i===r.currentStep,i<r.currentStep,i>r.currentStep)),e.R7$(),e.SpI(" ",t.title," "),e.R7$(),e.Y8G("ngIf",t.description)}}let qt=(()=>{class a{constructor(){this.steps=[],this.currentStep=0,this.stepClick=new e.bkB}get progressPercentage(){return!this.steps||this.steps.length<=1?0:this.currentStep/(this.steps.length-1)*100}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-modern-stepper"]],inputs:{steps:"steps",currentStep:"currentStep"},outputs:{stepClick:"stepClick"},decls:6,vars:3,consts:[[1,"mb-12","px-4","w-full"],[1,"max-w-4xl","mx-auto"],[1,"relative","flex","items-center","justify-between","w-full",2,"min-height","80px"],[1,"absolute","left-0","top-10","w-full","h-1","bg-gray-200","dark:bg-gray-700","z-0"],[1,"absolute","left-0","top-10","h-1","bg-blue-600","z-0","transition-all","duration-700","ease-in-out"],["class","relative flex flex-col items-center cursor-default group",4,"ngFor","ngForOf"],[1,"relative","flex","flex-col","items-center","cursor-default","group"],[1,"relative","flex","items-center","justify-center","transition-all","duration-300","z-10","bg-white","dark:bg-gray-900",3,"ngClass"],["data-lucide","check","class","w-6 h-6",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","absolute inset-0 rounded-2xl bg-blue-400 opacity-30 blur-xl -z-10",4,"ngIf"],[1,"mt-4","text-center","w-32"],[1,"text-sm","font-bold","block","mb-1",3,"ngClass"],["class","text-xs text-gray-500 dark:text-gray-400 block",4,"ngIf"],["data-lucide","check",1,"w-6","h-6"],[3,"ngClass"],[1,"absolute","inset-0","rounded-2xl","bg-blue-400","opacity-30","blur-xl","-z-10"],[1,"text-xs","text-gray-500","dark:text-gray-400","block"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.nrm(3,"div",3)(4,"div",4),e.DNE(5,Ht,9,17,"div",5),e.k0s()()()),2&i&&(e.R7$(4),e.xc7("width",r.progressPercentage,"%"),e.R7$(),e.Y8G("ngForOf",r.steps))},dependencies:[m.YU,m.Sq,m.bT],styles:["[data-lucide][_ngcontent-%COMP%]{display:inline-block;vertical-align:middle}"],data:{animation:[(0,D.hZ)("scaleIn",[(0,D.kY)(":enter",[(0,D.iF)({transform:"scale(0) rotate(-45deg)",opacity:0}),(0,D.i0)("400ms cubic-bezier(0.175, 0.885, 0.32, 1.275)",(0,D.iF)({transform:"scale(1) rotate(0)",opacity:1}))])])]}})}}return a})();var zt=_(8481),z=_(2209);const Kt=(a,n,t,i,r,o,s,l,d,g)=>({"ring-1":a,"border-blue-500 bg-blue-50 ring-blue-500":n,"border-purple-500 bg-purple-50 ring-purple-500":t,"border-indigo-500 bg-indigo-50 ring-indigo-500":i,"border-rose-500 bg-rose-50 ring-rose-500":r,"border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800":o,"hover:border-blue-200":s,"hover:border-purple-200":l,"hover:border-indigo-200":d,"hover:border-rose-200":g}),Wt=(a,n,t,i,r,o,s,l)=>({"bg-blue-100 text-blue-600":a,"bg-purple-100 text-purple-600":n,"bg-indigo-100 text-indigo-600":t,"bg-rose-100 text-rose-600":i,"bg-blue-500 text-white shadow-lg shadow-blue-500/25":r,"bg-purple-500 text-white shadow-lg shadow-purple-500/25":o,"bg-indigo-500 text-white shadow-lg shadow-indigo-500/25":s,"bg-rose-500 text-white shadow-lg shadow-rose-500/25":l}),Zt=(a,n,t,i,r)=>({"bg-blue-500 text-white shadow-lg shadow-blue-500/25":a,"bg-purple-500 text-white shadow-lg shadow-purple-500/25":n,"bg-indigo-500 text-white shadow-lg shadow-indigo-500/25":t,"bg-rose-500 text-white shadow-lg shadow-rose-500/25":i,"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600":r}),er=(a,n,t,i)=>({"bg-blue-500":a,"bg-purple-500":n,"bg-indigo-500":t,"bg-rose-500":i}),tr=(a,n,t,i)=>({"text-blue-500":a,"text-purple-500":n,"text-indigo-500":t,"text-rose-500":i});function rr(a,n){if(1&a&&(e.j41(0,"div",24),e.nrm(1,"lucide-icon",25),e.EFF(2," MOST POPULAR "),e.k0s()),2&a){const t=e.XpG().$implicit,i=e.XpG();e.Y8G("ngClass",e.ziG(2,er,"blue"===t.colorClass,"purple"===t.colorClass,"indigo"===t.colorClass,"rose"===t.colorClass)),e.R7$(),e.Y8G("img",i.Star)}}function ir(a,n){if(1&a&&(e.j41(0,"li",26),e.nrm(1,"lucide-icon",27),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&a){const t=n.$implicit,i=e.XpG().$implicit,r=e.XpG();e.R7$(),e.Y8G("img",r.Check)("ngClass",e.ziG(3,tr,"blue"===i.colorClass,"purple"===i.colorClass,"indigo"===i.colorClass,"rose"===i.colorClass)),e.R7$(2),e.JRh(t)}}function ar(a,n){1&a&&(e.j41(0,"span"),e.EFF(1,"Selected"),e.k0s())}function or(a,n){1&a&&(e.j41(0,"span"),e.EFF(1,"Select Plan"),e.k0s())}function nr(a,n){if(1&a&&e.nrm(0,"lucide-icon",28),2&a){const t=e.XpG(2);e.Y8G("img",t.Check)}}function sr(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",12),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.selectProgram(r.id))}),e.DNE(1,rr,3,7,"div",13),e.j41(2,"div",14)(3,"div",15),e.nrm(4,"lucide-icon",16),e.k0s(),e.j41(5,"h3",17),e.EFF(6),e.k0s(),e.j41(7,"p",18),e.EFF(8),e.k0s()(),e.j41(9,"ul",19),e.DNE(10,ir,4,8,"li",20),e.k0s(),e.j41(11,"button",21),e.DNE(12,ar,2,0,"span",22)(13,or,2,0,"span",22)(14,nr,1,1,"lucide-icon",23),e.k0s()()}if(2&a){const t=n.$implicit,i=e.XpG();e.Y8G("ngClass",e.zJS(11,Kt,[i.selectedProgram===t.id&&i.includeRoadside,i.selectedProgram===t.id&&i.includeRoadside&&"blue"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"purple"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"indigo"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"rose"===t.colorClass,i.selectedProgram!==t.id||!i.includeRoadside,"blue"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"purple"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"indigo"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"rose"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside)])),e.R7$(),e.Y8G("ngIf",t.popular),e.R7$(2),e.Y8G("ngClass",e.lV(22,Wt,"blue"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"purple"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"indigo"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),"rose"===t.colorClass&&(i.selectedProgram!==t.id||!i.includeRoadside),i.selectedProgram===t.id&&i.includeRoadside&&"blue"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"purple"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"indigo"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"rose"===t.colorClass)),e.R7$(),e.Y8G("img",t.icon),e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.description),e.R7$(2),e.Y8G("ngForOf",t.features),e.R7$(),e.Y8G("ngClass",e.s1E(31,Zt,i.selectedProgram===t.id&&i.includeRoadside&&"blue"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"purple"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"indigo"===t.colorClass,i.selectedProgram===t.id&&i.includeRoadside&&"rose"===t.colorClass,i.selectedProgram!==t.id||!i.includeRoadside)),e.R7$(),e.Y8G("ngIf",i.selectedProgram===t.id&&i.includeRoadside),e.R7$(),e.Y8G("ngIf",!(i.selectedProgram===t.id&&i.includeRoadside)),e.R7$(),e.Y8G("ngIf",i.selectedProgram===t.id&&i.includeRoadside)}}let K=(()=>{class a{constructor(){this.programSelected=new e.bkB,this.roadsideToggled=new e.bkB,this.includeRoadsideChange=new e.bkB,this.selectedProgramChange=new e.bkB,this.includeRoadside=!1,this.selectedProgram="egy",this.Shield=c.ekZ,this.Zap=c.KqI,this.Check=c.Jlk,this.Star=c.FEq,this.MapPin=c.sDd,this.Award=c.wAm,this.Car=c.THT,this.Crown=c.OeC,this.programs=[{id:"egy",name:"EGY",description:"Basic roadside assistance for Egypt",features:["24/7 Support","Towing Service","Battery Jump Start","Tire Change","Fuel Delivery"],colorClass:"blue",icon:c.THT},{id:"egy-vip",name:"EGY VIP",description:"Premium protection with extra perks",features:["All EGY Features","Hotel Accommodation","Replacement Car","Unlimited Towing","Priority Service","Key Replacement","International Coverage"],popular:!0,colorClass:"purple",icon:c.OeC},{id:"euro",name:"EURO",description:"Standard European coverage",features:["EU Wide Coverage","Towing Service","Legal Assistance","Medical Assistance","Repatriation","Hotel Stay"],colorClass:"indigo",icon:c.sDd},{id:"euro-vip",name:"EURO VIP",description:"Complete peace of mind in Europe",features:["All EURO Features","Replacement Luxury Car","Flight Tickets","VIP Lounge Access","Concierge Service","Extended Hotel Stay","Valet Parking","Zero Deductible"],colorClass:"rose",icon:c.OeC}]}onToggleChange(){this.includeRoadsideChange.emit(this.includeRoadside),this.roadsideToggled.emit(this.includeRoadside),this.includeRoadside&&this.selectedProgram&&this.programSelected.emit(this.selectedProgram)}selectProgram(t){this.selectedProgram=t,this.selectedProgramChange.emit(t),this.includeRoadside||(this.includeRoadside=!0,this.includeRoadsideChange.emit(!0),this.roadsideToggled.emit(!0)),this.programSelected.emit(t)}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-program-selector"]],inputs:{includeRoadside:"includeRoadside",selectedProgram:"selectedProgram"},outputs:{programSelected:"programSelected",roadsideToggled:"roadsideToggled",includeRoadsideChange:"includeRoadsideChange",selectedProgramChange:"selectedProgramChange"},standalone:!0,features:[e.aNF],decls:16,vars:7,consts:[[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","border","border-gray-100","dark:border-gray-700","p-6"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","mb-8","gap-4"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-500","dark:text-gray-400"],[1,"relative","inline-flex","items-center","cursor-pointer","group"],["type","checkbox",1,"sr-only","peer",3,"ngModelChange","change","ngModel"],[1,"w-14","h-7","bg-gray-200","peer-focus:outline-none","peer-focus:ring-4","peer-focus:ring-primary/20","dark:peer-focus:ring-primary/30","rounded-full","peer","dark:bg-gray-700","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-0.5","after:left-[4px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-6","after:w-6","after:transition-all","dark:border-gray-600","peer-checked:bg-primary"],[1,"ml-3","flex","items-center","gap-2"],[1,"w-5","h-5","text-gray-500","group-hover:text-primary","transition-colors",3,"img"],[1,"text-sm","font-medium","text-gray-900","dark:text-gray-300","group-hover:text-primary","transition-colors"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],["class","relative rounded-xl border-2 p-5 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:shadow-xl flex flex-col group",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"relative","rounded-xl","border-2","p-5","transition-all","duration-300","cursor-pointer","hover:-translate-y-1","hover:shadow-xl","flex","flex-col","group",3,"click","ngClass"],["class","absolute -top-3 left-1/2 -translate-x-1/2 text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1 shadow-md whitespace-nowrap z-10",3,"ngClass",4,"ngIf"],[1,"mb-4","mt-2"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","mb-3","transition-colors","duration-300",3,"ngClass"],[1,"w-6","h-6",3,"img"],[1,"text-lg","font-bold","text-navy","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400","mt-1","min-h-[40px]"],[1,"space-y-3","mb-6","flex-grow"],["class","flex items-start gap-2 text-sm text-gray-600 dark:text-gray-300",4,"ngFor","ngForOf"],[1,"w-full","py-2.5","px-4","rounded-lg","font-medium","text-sm","transition-all","duration-200","flex","items-center","justify-center","gap-2",3,"ngClass"],[4,"ngIf"],["class","w-4 h-4",3,"img",4,"ngIf"],[1,"absolute","-top-3","left-1/2","-translate-x-1/2","text-white","text-xs","font-bold","px-3","py-1","rounded-full","flex","items-center","gap-1","shadow-md","whitespace-nowrap","z-10",3,"ngClass"],[1,"w-3","h-3","fill-current",3,"img"],[1,"flex","items-start","gap-2","text-sm","text-gray-600","dark:text-gray-300"],[1,"w-4","h-4","mt-0.5","shrink-0",3,"img","ngClass"],[1,"w-4","h-4",3,"img"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),e.EFF(4,"Roadside Assistance"),e.k0s(),e.j41(5,"p",3),e.EFF(6,"Select a protection plan for your journey"),e.k0s()(),e.j41(7,"label",4)(8,"input",5),e.mxI("ngModelChange",function(s){return e.DH7(r.includeRoadside,s)||(r.includeRoadside=s),s}),e.bIt("change",function(){return r.onToggleChange()}),e.k0s(),e.nrm(9,"div",6),e.j41(10,"div",7),e.nrm(11,"lucide-icon",8),e.j41(12,"span",9),e.EFF(13,"Include Roadside"),e.k0s()()()(),e.j41(14,"div",10),e.DNE(15,sr,15,37,"div",11),e.k0s()()),2&i&&(e.R7$(8),e.R50("ngModel",r.includeRoadside),e.R7$(3),e.Y8G("img",r.Shield),e.R7$(3),e.AVh("opacity-50",!r.includeRoadside)("pointer-events-none",!r.includeRoadside),e.R7$(),e.Y8G("ngForOf",r.programs))},dependencies:[m.MD,m.YU,m.Sq,m.bT,u.YN,u.Zm,u.BC,u.vS,c.flO,c.WGl],styles:["[_nghost-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out forwards}.toggle-checkbox[_ngcontent-%COMP%]:checked{right:0;border-color:#68d391}.toggle-checkbox[_ngcontent-%COMP%]:checked + .toggle-label[_ngcontent-%COMP%]{background-color:#68d391}.grid[_ngcontent-%COMP%]{transition:opacity .3s ease-in-out,filter .3s ease-in-out}"]})}}return a})();const lr=()=>({code:"new",name:"New",icon:"\u2728",description:"Brand new vehicle"}),dr=()=>({code:"used",name:"Used",icon:"\u{1f697}",description:"Pre-owned vehicle"}),cr=(a,n)=>[a,n],pr=(a,n)=>({"border-blue-600 bg-blue-50 dark:bg-blue-900/20":a,"border-gray-200 dark:border-gray-700":n}),ur=()=>["/dashboard/broker/quotations"];function mr(a,n){1&a&&(e.j41(0,"div",16)(1,"h1",17),e.EFF(2,"Create New Insurance Quote"),e.k0s(),e.j41(3,"p",18),e.EFF(4,"Follow the steps below to create a new insurance quote"),e.k0s()())}function gr(a,n){if(1&a&&e.nrm(0,"app-modern-stepper",19),2&a){const t=e.XpG();e.Y8G("steps",t.steps)("currentStep",t.currentStep)}}function _r(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"app-collapsible-section",22),e.bIt("toggle",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleSection("selection"))}),e.j41(2,"div",23)(3,"div")(4,"app-selection-modal",24),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.make,r)||(o.vehicleForm.make=r),e.Njj(r)}),e.bIt("valueChange",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onMakeChange())}),e.k0s()(),e.j41(5,"div")(6,"app-selection-modal",25),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.model,r)||(o.vehicleForm.model=r),e.Njj(r)}),e.bIt("valueChange",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onModelChange())}),e.k0s()(),e.j41(7,"div")(8,"app-selection-modal",26),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.year,r)||(o.vehicleForm.year=r),e.Njj(r)}),e.k0s()()()(),e.j41(9,"app-collapsible-section",27),e.bIt("toggle",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleSection("identification"))}),e.j41(10,"div",28)(11,"div")(12,"label",8),e.EFF(13," Chassis No "),e.j41(14,"span",29),e.EFF(15,"*"),e.k0s()(),e.j41(16,"input",30),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.chassisNo,r)||(o.vehicleForm.chassisNo=r),e.Njj(r)}),e.k0s()(),e.j41(17,"div")(18,"label",8),e.EFF(19," Engine No "),e.j41(20,"span",29),e.EFF(21,"*"),e.k0s()(),e.j41(22,"input",30),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.engineNo,r)||(o.vehicleForm.engineNo=r),e.Njj(r)}),e.k0s()()()(),e.j41(23,"app-collapsible-section",31),e.bIt("toggle",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleSection("financial"))}),e.j41(24,"div",28)(25,"div")(26,"label",8),e.EFF(27," Sum Insured (EGP) "),e.j41(28,"span",29),e.EFF(29,"*"),e.k0s()(),e.j41(30,"input",32),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.sumInsured,r)||(o.vehicleForm.sumInsured=r),e.Njj(r)}),e.k0s()(),e.j41(31,"div")(32,"app-selection-modal",33),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.vehicle_state,r)||(o.vehicleForm.vehicle_state=r),e.Njj(r)}),e.k0s()()()()()}if(2&a){const t=e.XpG(2);e.R7$(),e.Y8G("expanded",t.isSectionOpen("selection"))("isComplete",t.isSelectionComplete),e.R7$(3),e.R50("value",t.vehicleForm.make),e.Y8G("options",t.makers)("title","Select Vehicle Make")("subtitle","Choose the manufacturer")("placeholder","Choose vehicle make")("layout","grid")("gridCols",4)("required",!0)("imageKey","risk_image"),e.R7$(2),e.R50("value",t.vehicleForm.model),e.Y8G("options",t.models)("title","Select Vehicle Model")("subtitle","Choose the model")("placeholder",t.vehicleForm.make?"Choose model":"Select make first")("layout","grid")("gridCols",4)("disabled",!t.vehicleForm.make)("required",!0),e.R7$(2),e.R50("value",t.vehicleForm.year),e.Y8G("options",t.years)("title","Select Manufacturing Year")("subtitle","Choose the year")("placeholder",t.vehicleForm.model?"Choose year":"Select model first")("layout","grid")("gridCols",5)("disabled",!t.vehicleForm.model)("required",!0),e.R7$(),e.Y8G("expanded",t.isSectionOpen("identification"))("isComplete",t.isIdentificationComplete),e.R7$(7),e.R50("ngModel",t.vehicleForm.chassisNo),e.R7$(6),e.R50("ngModel",t.vehicleForm.engineNo),e.R7$(),e.Y8G("expanded",t.isSectionOpen("financial"))("isComplete",t.isFinancialComplete),e.R7$(7),e.R50("ngModel",t.vehicleForm.sumInsured),e.R7$(2),e.R50("value",t.vehicleForm.vehicle_state),e.Y8G("options",e.l_i(44,cr,e.lJ4(42,lr),e.lJ4(43,dr)))("title","Select Vehicle Condition")("subtitle","Is the vehicle new or used?")("placeholder","Choose condition")("layout","list")}}function hr(a,n){1&a&&(e.j41(0,"div",40),e.nrm(1,"div",41),e.k0s())}function fr(a,n){1&a&&(e.j41(0,"div",42),e.nrm(1,"i",43),e.j41(2,"p",18),e.EFF(3,"No coverage plans available for the selected vehicle criteria."),e.k0s()())}function br(a,n){1&a&&(e.j41(0,"div",60),e.nrm(1,"i",61),e.k0s())}function yr(a,n){1&a&&e.nrm(0,"i-lucide",62)}function vr(a,n){1&a&&e.nrm(0,"i-lucide",63)}function xr(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",45),e.bIt("click",function(){const r=e.eBV(t).$implicit,o=e.XpG(4);return e.Njj(o.selectProposal(r))}),e.DNE(1,br,2,0,"div",46),e.j41(2,"div",47)(3,"span",48),e.EFF(4,"Proposal Number"),e.k0s(),e.j41(5,"h3",49),e.EFF(6),e.k0s()(),e.j41(7,"div",50)(8,"span",51),e.EFF(9,"Gross Premium"),e.k0s(),e.j41(10,"div",52),e.EFF(11),e.nI1(12,"currency"),e.k0s()(),e.j41(13,"div",53)(14,"div",54)(15,"span",55),e.EFF(16,"Net Premium"),e.k0s(),e.j41(17,"span",56),e.EFF(18),e.nI1(19,"currency"),e.k0s()(),e.j41(20,"div",54)(21,"span",55),e.EFF(22,"Rate"),e.k0s(),e.j41(23,"span",56),e.EFF(24),e.k0s()(),e.j41(25,"div",54)(26,"span",55),e.EFF(27,"Taxes"),e.k0s(),e.j41(28,"span",56),e.EFF(29),e.nI1(30,"currency"),e.k0s()(),e.j41(31,"div",54)(32,"span",55),e.EFF(33,"Fees"),e.k0s(),e.j41(34,"span",56),e.EFF(35),e.nI1(36,"currency"),e.k0s()()(),e.j41(37,"app-button",57),e.bIt("click",function(r){const o=e.eBV(t).$implicit,s=e.XpG(4);return r.stopPropagation(),e.Njj(s.downloadProposalPdf(o))}),e.DNE(38,yr,1,0,"i-lucide",58)(39,vr,1,0,"i-lucide",59),e.EFF(40),e.k0s()()}if(2&a){const t=n.$implicit,i=e.XpG(4);e.Y8G("ngClass",e.l_i(24,pr,(null==i.selectedProposal?null:i.selectedProposal.id)===t.id,(null==i.selectedProposal?null:i.selectedProposal.id)!==t.id)),e.R7$(),e.Y8G("ngIf",(null==i.selectedProposal?null:i.selectedProposal.id)===t.id),e.R7$(5),e.SpI(" ",t.proposal_reference||"N/A"," "),e.R7$(5),e.SpI(" ",e.i5U(12,12,t.proposal_gross_premium,"EGP ")," "),e.R7$(7),e.JRh(e.i5U(19,15,t.proposal_net_premium,"EGP ")),e.R7$(6),e.SpI("",t.proposal_net_rate,"%"),e.R7$(5),e.JRh(e.i5U(30,18,t.proposal_tax_amount,"EGP ")),e.R7$(6),e.JRh(e.i5U(36,21,t.proposal_issue_fees,"EGP ")),e.R7$(2),e.Y8G("disabled",i.downloadingProposalId===t.id),e.R7$(),e.Y8G("ngIf",i.downloadingProposalId!==t.id),e.R7$(),e.Y8G("ngIf",i.downloadingProposalId===t.id),e.R7$(),e.SpI(" ",i.downloadingProposalId===t.id?"Downloading...":"Download PDF"," ")}}function kr(a,n){if(1&a&&(e.j41(0,"div",23),e.DNE(1,xr,41,27,"div",44),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.proposals)}}function Cr(a,n){if(1&a&&(e.j41(0,"div",34)(1,"div",35)(2,"h2",36),e.EFF(3,"Select Coverage Plan"),e.k0s(),e.DNE(4,hr,2,0,"div",37)(5,fr,4,0,"div",38)(6,kr,2,1,"div",39),e.k0s()()),2&a){const t=e.XpG(2);e.R7$(4),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",!t.loading&&0===t.proposals.length),e.R7$(),e.Y8G("ngIf",!t.loading&&t.proposals.length>0)}}function Rr(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"app-collapsible-section",64)(2,"div",65)(3,"div")(4,"app-selection-modal",66),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.category,r)||(o.vehicleForm.category=r),e.Njj(r)}),e.k0s()(),e.j41(5,"div")(6,"app-selection-modal",67),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.bodyType,r)||(o.vehicleForm.bodyType=r),e.Njj(r)}),e.k0s()(),e.j41(7,"div")(8,"app-selection-modal",68),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.color,r)||(o.vehicleForm.color=r),e.Njj(r)}),e.k0s()(),e.j41(9,"div")(10,"app-selection-modal",69),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.fuelType,r)||(o.vehicleForm.fuelType=r),e.Njj(r)}),e.k0s()(),e.j41(11,"div")(12,"app-selection-modal",70),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.usage,r)||(o.vehicleForm.usage=r),e.Njj(r)}),e.k0s()(),e.j41(13,"div")(14,"app-selection-modal",71),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.cc,r)||(o.vehicleForm.cc=r),e.Njj(r)}),e.k0s()(),e.j41(15,"div")(16,"label",8),e.EFF(17," Number of Seats "),e.j41(18,"span",29),e.EFF(19,"*"),e.k0s()(),e.j41(20,"input",72),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.seats,r)||(o.vehicleForm.seats=r),e.Njj(r)}),e.k0s()(),e.j41(21,"div")(22,"label",8),e.EFF(23," Plate No "),e.j41(24,"span",29),e.EFF(25,"*"),e.k0s()(),e.j41(26,"input",30),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.plateNo,r)||(o.vehicleForm.plateNo=r),e.Njj(r)}),e.k0s()(),e.j41(27,"div")(28,"label",8),e.EFF(29," Kilometers Driven "),e.k0s(),e.j41(30,"input",73),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.kilometers,r)||(o.vehicleForm.kilometers=r),e.Njj(r)}),e.k0s()()()(),e.j41(31,"app-collapsible-section",74)(32,"app-program-selector",75),e.mxI("includeRoadsideChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.hasRoadSide,r)||(o.vehicleForm.hasRoadSide=r),e.Njj(r)})("selectedProgramChange",function(r){e.eBV(t);const o=e.XpG(2);return e.DH7(o.vehicleForm.roadSideProgram,r)||(o.vehicleForm.roadSideProgram=r),e.Njj(r)}),e.bIt("programSelected",function(r){e.eBV(t);const o=e.XpG(2);return e.Njj(o.onProgramSelected(r))})("roadsideToggled",function(r){e.eBV(t);const o=e.XpG(2);return e.Njj(o.onRoadsideToggled(r))}),e.k0s()()()}if(2&a){const t=e.XpG(2);e.R7$(),e.Y8G("expanded",!0)("isComplete",t.isSpecificationsComplete),e.R7$(3),e.R50("value",t.vehicleForm.category),e.Y8G("options",t.categories)("title","Select Vehicle Category")("subtitle","Choose the category")("placeholder",t.vehicleForm.model?"Choose category":"Select model first")("layout","list")("disabled",!t.vehicleForm.model)("required",!0),e.R7$(2),e.R50("value",t.vehicleForm.bodyType),e.Y8G("options",t.bodyTypes)("title","Select Body Type")("subtitle","Choose the vehicle body type")("placeholder","Choose body type")("layout","grid")("gridCols",3)("required",!0),e.R7$(2),e.R50("value",t.vehicleForm.color),e.Y8G("options",t.colors)("title","Select Vehicle Color")("subtitle","Choose the color")("placeholder","Choose color")("layout","grid")("gridCols",4)("required",!0),e.R7$(2),e.R50("value",t.vehicleForm.fuelType),e.Y8G("options",t.fuelTypes)("title","Select Fuel Type")("subtitle","Choose the fuel type")("placeholder","Choose fuel type")("layout","list")("required",!1),e.R7$(2),e.R50("value",t.vehicleForm.usage),e.Y8G("options",t.usages)("title","Select Vehicle Usage")("subtitle","Choose how the vehicle is used")("placeholder","Choose usage type")("layout","list")("required",!0),e.R7$(2),e.R50("value",t.vehicleForm.cc),e.Y8G("options",t.ccs)("title","Select Engine CC")("subtitle","Choose the engine capacity")("placeholder","Choose engine CC")("layout","grid")("gridCols",3)("required",!0),e.R7$(6),e.R50("ngModel",t.vehicleForm.seats),e.R7$(6),e.R50("ngModel",t.vehicleForm.plateNo),e.R7$(4),e.R50("ngModel",t.vehicleForm.kilometers),e.R7$(),e.Y8G("expanded",!0)("isComplete",!1),e.R7$(),e.R50("includeRoadside",t.vehicleForm.hasRoadSide)("selectedProgram",t.vehicleForm.roadSideProgram)}}function Ir(a,n){1&a&&(e.j41(0,"div",42),e.nrm(1,"i",77),e.j41(2,"p",18),e.EFF(3,"No documents required"),e.k0s()())}function Er(a,n){1&a&&(e.j41(0,"span",91),e.EFF(1,"Required"),e.k0s())}function Tr(a,n){1&a&&(e.j41(0,"span",92),e.EFF(1,"Uploaded"),e.k0s())}function Fr(a,n){1&a&&(e.j41(0,"span",93),e.EFF(1,"*"),e.k0s())}function Sr(a,n){1&a&&(e.j41(0,"span"),e.EFF(1,"Select File"),e.k0s())}function wr(a,n){if(1&a&&(e.j41(0,"span",94),e.EFF(1),e.k0s()),2&a){let t;const i=e.XpG().$implicit,r=e.XpG(3);e.R7$(),e.JRh(null==(t=r.uploadedDocuments.get(i.id))?null:t.file_name)}}function jr(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",78)(1,"div",79)(2,"div",80)(3,"div",81),e.nrm(4,"i",82),e.k0s(),e.j41(5,"div")(6,"span",83),e.EFF(7),e.k0s(),e.DNE(8,Er,2,0,"span",84)(9,Tr,2,0,"span",85),e.k0s()(),e.DNE(10,Fr,2,0,"span",86),e.k0s(),e.j41(11,"div",87)(12,"input",88),e.bIt("change",function(r){const o=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.onFileSelected(r,o.id))}),e.k0s(),e.j41(13,"label",89),e.DNE(14,Sr,2,0,"span",3)(15,wr,2,1,"span",90),e.k0s()()()}if(2&a){const t=n.$implicit,i=e.XpG(3);e.R7$(3),e.Y8G("ngClass",i.uploadedDocuments.has(t.id)?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"),e.R7$(),e.BMQ("data-lucide",i.uploadedDocuments.has(t.id)?"check":"file-text"),e.R7$(3),e.JRh(t.item||t.document_name),e.R7$(),e.Y8G("ngIf",t.required_document&&!i.uploadedDocuments.has(t.id)),e.R7$(),e.Y8G("ngIf",i.uploadedDocuments.has(t.id)),e.R7$(),e.Y8G("ngIf",t.required_document&&!i.uploadedDocuments.has(t.id)),e.R7$(2),e.Mz_("id","file-",t.id,""),e.R7$(),e.Mz_("for","file-",t.id,""),e.Y8G("ngClass",i.uploadedDocuments.has(t.id)?"border-green-200 dark:border-green-700 bg-green-50/50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30":"border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:border-blue-300 dark:hover:border-blue-600 hover:text-blue-600 dark:hover:text-blue-400"),e.R7$(),e.Y8G("ngIf",!i.uploadedDocuments.has(t.id)),e.R7$(),e.Y8G("ngIf",i.uploadedDocuments.has(t.id))}}function Nr(a,n){if(1&a&&(e.j41(0,"div",34)(1,"div",35)(2,"h2",36),e.EFF(3,"Upload Required Documents"),e.k0s(),e.DNE(4,Ir,4,0,"div",38),e.j41(5,"div",28),e.DNE(6,jr,16,13,"div",76),e.k0s()()()),2&a){const t=e.XpG(2);e.R7$(4),e.Y8G("ngIf",0===t.requiredDocuments.length),e.R7$(2),e.Y8G("ngForOf",t.requiredDocuments)}}function Dr(a,n){if(1&a&&(e.j41(0,"div",105)(1,"div",106)(2,"div")(3,"h4",107),e.EFF(4),e.k0s(),e.j41(5,"p",18),e.EFF(6,"Gross Premium"),e.k0s()(),e.j41(7,"p",108),e.EFF(8),e.k0s()(),e.j41(9,"div",109)(10,"div")(11,"p",98),e.EFF(12,"Net Premium"),e.k0s(),e.j41(13,"p",99),e.EFF(14),e.k0s()(),e.j41(15,"div")(16,"p",98),e.EFF(17,"Taxes"),e.k0s(),e.j41(18,"p",99),e.EFF(19),e.k0s()(),e.j41(20,"div")(21,"p",98),e.EFF(22,"Fees"),e.k0s(),e.j41(23,"p",99),e.EFF(24),e.k0s()()()()),2&a){const t=e.XpG(3);e.R7$(4),e.JRh(t.selectedProposal.proposal_reference),e.R7$(4),e.SpI(" EGP ",(t.selectedProposal.proposal_gross_premium||0).toLocaleString()," "),e.R7$(6),e.SpI("EGP ",(t.selectedProposal.proposal_net_premium||0).toLocaleString(),""),e.R7$(5),e.SpI("EGP ",(t.selectedProposal.proposal_tax_amount||0).toLocaleString(),""),e.R7$(5),e.SpI("EGP ",(t.selectedProposal.proposal_issue_fees||0).toLocaleString(),"")}}function Or(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",34)(1,"div",35)(2,"h2",36),e.EFF(3,"Review & Issue Policy"),e.k0s(),e.j41(4,"div",95)(5,"h3",96),e.EFF(6,"Customer Information"),e.k0s(),e.j41(7,"div",97)(8,"div")(9,"p",98),e.EFF(10,"Name"),e.k0s(),e.j41(11,"p",99),e.EFF(12),e.k0s()(),e.j41(13,"div")(14,"p",98),e.EFF(15,"Email"),e.k0s(),e.j41(16,"p",99),e.EFF(17),e.k0s()(),e.j41(18,"div")(19,"p",98),e.EFF(20,"Phone"),e.k0s(),e.j41(21,"p",99),e.EFF(22),e.k0s()(),e.j41(23,"div")(24,"p",98),e.EFF(25,"National ID"),e.k0s(),e.j41(26,"p",99),e.EFF(27),e.k0s()()()(),e.j41(28,"div",95)(29,"h3",96),e.EFF(30,"Vehicle Information"),e.k0s(),e.j41(31,"div",97)(32,"div")(33,"p",98),e.EFF(34,"Make & Model"),e.k0s(),e.j41(35,"p",99),e.EFF(36),e.k0s()(),e.j41(37,"div")(38,"p",98),e.EFF(39,"Year"),e.k0s(),e.j41(40,"p",99),e.EFF(41),e.k0s()(),e.j41(42,"div")(43,"p",98),e.EFF(44,"Chassis No"),e.k0s(),e.j41(45,"p",99),e.EFF(46),e.k0s()(),e.j41(47,"div")(48,"p",98),e.EFF(49,"Sum Insured"),e.k0s(),e.j41(50,"p",99),e.EFF(51),e.k0s()()()(),e.j41(52,"div",100)(53,"h3",96),e.EFF(54,"Selected Coverage"),e.k0s(),e.DNE(55,Dr,25,5,"div",101),e.k0s(),e.j41(56,"div",102)(57,"button",103),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.issuePolicy())}),e.nrm(58,"i",104),e.EFF(59),e.k0s()()()()}if(2&a){const t=e.XpG(2);e.R7$(12),e.JRh((null==t.selectedCustomer?null:t.selectedCustomer.name)||(null==t.selectedCustomer?null:t.selectedCustomer.full_name)),e.R7$(5),e.JRh(null==t.selectedCustomer?null:t.selectedCustomer.email),e.R7$(5),e.JRh(null==t.selectedCustomer?null:t.selectedCustomer.phone),e.R7$(5),e.JRh((null==t.selectedCustomer?null:t.selectedCustomer.nationalId)||(null==t.selectedCustomer?null:t.selectedCustomer.identification_number)||(null==t.selectedCustomer?null:t.selectedCustomer.national_id)),e.R7$(9),e.Lme("",t.makeName," ",t.modelName,""),e.R7$(5),e.JRh(t.yearName),e.R7$(5),e.JRh(t.vehicleForm.chassisNo),e.R7$(5),e.SpI("EGP ",(+t.vehicleForm.sumInsured).toLocaleString(),""),e.R7$(4),e.Y8G("ngIf",t.selectedProposal),e.R7$(2),e.Y8G("disabled",t.loading),e.R7$(2),e.SpI(" ",t.loading?"Issuing Policy...":"Issue Policy"," ")}}function Ar(a,n){if(1&a&&(e.j41(0,"div"),e.DNE(1,_r,33,47,"div",20)(2,Cr,7,3,"div",4)(3,Rr,33,55,"div",20)(4,Nr,7,2,"div",4)(5,Or,60,12,"div",4),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngIf",0===t.currentStep),e.R7$(),e.Y8G("ngIf",1===t.currentStep),e.R7$(),e.Y8G("ngIf",2===t.currentStep),e.R7$(),e.Y8G("ngIf",3===t.currentStep),e.R7$(),e.Y8G("ngIf",4===t.currentStep)}}function Mr(a,n){if(1&a&&(e.j41(0,"div",119)(1,"h3",120),e.EFF(2," Policy Details"),e.k0s(),e.j41(3,"div",28)(4,"div")(5,"p",121),e.EFF(6,"Policy Number"),e.k0s(),e.j41(7,"p",122),e.EFF(8),e.k0s()(),e.j41(9,"div")(10,"p",121),e.EFF(11,"Status"),e.k0s(),e.j41(12,"p",123),e.EFF(13),e.k0s()(),e.j41(14,"div")(15,"p",121),e.EFF(16,"Opportunity Number"),e.k0s(),e.j41(17,"p",56),e.EFF(18),e.k0s()(),e.j41(19,"div")(20,"p",121),e.EFF(21,"Policy ID"),e.k0s(),e.j41(22,"p",56),e.EFF(23),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(8),e.SpI("",t.issuanceResponseData.policy_number," "),e.R7$(5),e.SpI(" ",t.issuanceResponseData.policy_state," "),e.R7$(5),e.JRh(t.issuanceResponseData.opportunity_number||"N/A"),e.R7$(5),e.SpI("",t.issuanceResponseData.policy_id," ")}}function Lr(a,n){if(1&a&&(e.j41(0,"div",34)(1,"div",110)(2,"div",111)(3,"div",112),e.nrm(4,"i",113),e.k0s()(),e.j41(5,"h2",114),e.EFF(6,"Policy Issued Successfully!"),e.k0s(),e.j41(7,"p",115),e.EFF(8," The policy has been created and is now active. You can find it in the policies list. "),e.k0s(),e.DNE(9,Mr,24,4,"div",116),e.j41(10,"div",102)(11,"button",117),e.nrm(12,"i",118),e.EFF(13," Back to Quote List "),e.k0s()()()()),2&a){const t=e.XpG();e.R7$(9),e.Y8G("ngIf",t.issuanceResponseData),e.R7$(2),e.Y8G("routerLink",e.lJ4(2,ur))}}function Pr(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",129),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.previousStep())}),e.nrm(1,"i",130),e.EFF(2," Previous "),e.k0s()}if(2&a){const t=e.XpG(2);e.Y8G("disabled",t.loading)}}function $r(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",131),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.openLostModal())}),e.nrm(1,"i",132),e.EFF(2," Mark as Lost "),e.k0s()}}function Gr(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",133),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.nextStep())}),e.EFF(1),e.nrm(2,"i",134),e.k0s()}if(2&a){const t=e.XpG(2);e.Y8G("disabled",!t.canProceed()||t.loading),e.R7$(),e.SpI(" ",t.loading?"Processing...":"Next"," ")}}function Br(a,n){if(1&a&&(e.j41(0,"div",124)(1,"div",125),e.DNE(2,Pr,3,1,"button",126)(3,$r,3,0,"button",127),e.k0s(),e.DNE(4,Gr,3,2,"button",128),e.k0s()),2&a){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.currentStep>0),e.R7$(),e.Y8G("ngIf",t.opportunityId&&t.currentStep>0&&t.currentStep<t.steps.length-1),e.R7$(),e.Y8G("ngIf",t.currentStep<t.steps.length-1)}}function Ur(a,n){if(1&a&&(e.j41(0,"option",135),e.EFF(1),e.k0s()),2&a){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}let Yr=(()=>{class a{constructor(t,i,r,o,s,l,d){this.router=t,this.route=i,this.quoteService=r,this.crmService=o,this.customerService=s,this.authService=l,this.notificationService=d,this.currentStep=0,this.loading=!1,this.error=null,this.steps=[{id:1,title:"Vehicle Details",description:"Enter vehicle information"},{id:2,title:"Coverage Selection",description:"Choose coverage plan"},{id:3,title:"Additional Details",description:"Complete vehicle specification"},{id:4,title:"Documents",description:"Upload required documents"},{id:5,title:"Review & Issue",description:"Review and issue policy"}],this.isCustomerModalOpen=!1,this.selectedCustomer=null,this.vehicleForm={make:"",model:"",year:"",category:"",chassisNo:"",engineNo:"",plateNo:"",color:"",bodyType:"",fuelType:"Petrol",cc:"",seats:"5",usage:"Private",sumInsured:"",vehicle_state:"new",kilometers:"0",hasRoadSide:!0,roadSideProgram:""},this.openSections={selection:!0,identification:!1,specifications:!1,financial:!1,coverage:!1},this.makers=[],this.models=[],this.categories=[],this.years=[],this.bodyTypes=[],this.usages=[],this.ccs=[],this.fuelTypes=[],this.colors=[],this.roadSidePrograms=[],this.opportunityId=null,this.proposals=[],this.selectedProposal=null,this.quotationData=null,this.requiredDocuments=[],this.uploadedDocuments=new Map,this.isLostModalOpen=!1,this.lostReasons=[],this.selectedLostReason=null,this.lostFeedback="",this.lostLoading=!1,this.downloadingProposalId=null,this.issuanceSuccess=!1,this.issuanceResponseData=null}ngOnInit(){var t=this;this.route.queryParams.subscribe(function(){var i=(0,b.A)(function*(r){const o=r.quotationId,s="true"===r.edit;if(yield t.loadLOVData(),o&&s)yield t.loadExistingQuotation(o);else{const d=t.router.getCurrentNavigation()?.extras?.state||history.state;if(!d||!d.customer)return console.warn("No customer data found in state, redirecting to quotations"),void t.router.navigate(["/dashboard/broker/quotations"]);t.selectedCustomer=d.customer}});return function(r){return i.apply(this,arguments)}}())}loadExistingQuotation(t){var i=this;return(0,b.A)(function*(){i.loading=!0;try{const r=yield i.crmService.getQuotation(Number(t)).toPromise(),o=r?.result?.data||r?.data||r;if(console.log("Loaded quotation for editing:",o),!o)return console.error("No quotation data found"),void i.router.navigate(["/dashboard/broker/quotations"]);i.selectedCustomer={name:o.name,email:o.email,phone:o.phone,nationalId:o.customer_national_id||"",passportId:o.customer_passport_id||"",taxId:o.customer_tax_id||"",dateOfBirth:"",gender:"male"},console.log("Customer data set:",i.selectedCustomer),i.opportunityId=o.opportunity_id||Number(t);const s=o.opportunity_risks?.[0];if(console.log("Risk data:",s),console.log("Available LOV data:",{usages:i.usages,colors:i.colors,bodyTypes:i.bodyTypes,fuelTypes:i.fuelTypes,ccs:i.ccs,roadSidePrograms:i.roadSidePrograms}),s){const l={make:s.vehicle_make_sequence_number||s.vehicle_make||"",model:s.vehicle_model_sequence_number||s.vehicle_model||"",year:String(s.vehicle_manufacturing_year||""),category:s.vehicle_category_sequence_number||s.vehicle_category||"",chassisNo:s.vehicle_chassis_number||"",engineNo:s.vehicle_engine_number||"",plateNo:s.vehicle_plate_number||s.plate_number||"",color:s.vehicle_color_sequence_number||s.vehicle_color||"",bodyType:s.vehicle_body_type_sequence_number||s.vehicle_body_type||"",fuelType:s.vehicle_fuel_type_sequence_number||s.vehicle_fuel_type||"",cc:s.vehicle_cc_sequence_number||s.vehicle_cc||"",seats:String(s.vehicle_number_of_seats||s.vehicle_seats||"5"),usage:s.vehicle_usage_sequence_number||s.vehicle_usage||"",sumInsured:String(s.vehicle_sum_insured||""),vehicle_state:s.vehicle_state||"new",kilometers:String(s.vehicle_number_of_kilometers||"0"),hasRoadSide:s.vehicle_has_road_side||!1,roadSideProgram:s.vehicle_road_side_program_sequence_number||s.vehicle_road_side_program||""};console.log("Form data to set:",l),i.vehicleForm.chassisNo=l.chassisNo,i.vehicleForm.engineNo=l.engineNo,i.vehicleForm.plateNo=l.plateNo,i.vehicleForm.color=l.color,i.vehicleForm.bodyType=l.bodyType,i.vehicleForm.fuelType=l.fuelType,i.vehicleForm.cc=l.cc,i.vehicleForm.seats=l.seats,i.vehicleForm.usage=l.usage,i.vehicleForm.sumInsured=l.sumInsured,i.vehicleForm.vehicle_state=l.vehicle_state,i.vehicleForm.kilometers=l.kilometers,i.vehicleForm.hasRoadSide=l.hasRoadSide,i.vehicleForm.roadSideProgram=l.roadSideProgram,i.vehicleForm.make=l.make,l.make&&(yield i.onMakeChange(),setTimeout(()=>{i.vehicleForm.model=l.model,l.model&&setTimeout((0,b.A)(function*(){yield i.onModelChange(),setTimeout(()=>{console.log("Setting year:",l.year,"Available years:",i.years),console.log("Setting category:",l.category);const d=String(s.vehicle_manufacturing_year||l.year),g=i.years.find(p=>String(p.name)===d||String(p.code)===d||p.name?.toString().includes(d));i.vehicleForm.year=g?.code||d,i.vehicleForm.category=l.category,console.log("Year matched:",g,"Year set to:",i.vehicleForm.year),console.log("All dependent fields set")},200)}),200)},200))}o.opportunity_proposal&&o.opportunity_proposal.length>0&&(i.proposals=o.opportunity_proposal),i.loading=!1}catch(r){console.error("Failed to load quotation for editing",r),i.notificationService.error("Failed to load quotation data. Redirecting to quotations list."),i.router.navigate(["/dashboard/broker/quotations"])}})()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}loadLOVData(){var t=this;return(0,b.A)(function*(){try{const i=yield t.quoteService.getVehicleMakers().toPromise();t.makers=t.mapList(i);const[r,o,s,l,d,g]=yield Promise.all([t.quoteService.getVehicleBodyTypes().toPromise(),t.quoteService.getVehicleUsages().toPromise(),t.quoteService.getVehicleCcs().toPromise(),t.quoteService.getVehicleFuelTypes().toPromise(),t.quoteService.getVehicleColors().toPromise(),t.quoteService.getRoadSidePrograms().toPromise()]);t.bodyTypes=t.mapList(r),t.usages=t.mapList(o),t.ccs=t.mapList(s),t.fuelTypes=t.mapList(l),t.colors=t.mapList(d),t.roadSidePrograms=t.mapList(g)}catch(i){console.error("Failed to load LOV data",i),t.notificationService.error("Failed to load form data. Please refresh the page.")}})()}mapList(t){const i=t?.result?.data||t?.data||t;let r=[];if(Array.isArray(i))r=i;else if(i&&"object"==typeof i)if(i.items&&Array.isArray(i.items))r=i.items;else if(i.data&&Array.isArray(i.data))r=i.data;else{const o=Object.keys(i).find(s=>Array.isArray(i[s]));o&&(r=i[o])}return r.map(o=>{let s=o.risk_image||o.image;if(s){let l=String(s).trim();s=l.startsWith("data:")||l.startsWith("http")||l.startsWith("https")||l.startsWith("/")||l.startsWith("./")||l.startsWith("assets/")||/\.(png|jpg|jpeg|svg|gif|webp)(\?.*)?$/i.test(l)?l:l.length>50?`data:image/png;base64,${l.replace(/\s/g,"")}`:""}return 0===r.indexOf(o)&&s&&console.log("QuoteFlow: First processed image starts with:",String(s).substring(0,100)+"..."),{code:o.sequence_number||o.code||o.id||o.value||o.year,name:o.item||o.name||o.value||o.display||o.label||o.year||o,id:o.id,risk_image:s}})}onMakeChange(){var t=this;return(0,b.A)(function*(){if(t.vehicleForm.make)try{const i=yield t.quoteService.getVehicleModels(t.vehicleForm.make).toPromise();t.models=t.mapList(i),t.vehicleForm.model="",t.vehicleForm.year="",t.vehicleForm.category=""}catch(i){console.error("Failed to load models",i),t.notificationService.error("Failed to load vehicle models")}else t.models=[]})()}onModelChange(){var t=this;return(0,b.A)(function*(){if(!t.vehicleForm.model)return t.categories=[],void(t.years=[]);try{const i=yield t.quoteService.getVehicleModelCategories(t.vehicleForm.model).toPromise();t.categories=t.mapList(i);const o=t.models.find(l=>l.code===t.vehicleForm.model)?.id||t.vehicleForm.model,s=yield t.quoteService.getVehicleModelYears(o).toPromise();t.years=t.mapList(s),t.vehicleForm.year="",t.vehicleForm.category=""}catch(i){console.error("Failed to load categories/years",i),t.notificationService.error("Failed to load vehicle options")}})()}loadLostReasons(){var t=this;return(0,b.A)(function*(){try{const i=yield t.crmService.getLostReasons().toPromise();t.lostReasons=t.mapList(i)}catch(i){console.error("Failed to load lost reasons",i),t.notificationService.error("Failed to load lost reasons")}})()}openLostModal(){this.isLostModalOpen=!0,0===this.lostReasons.length&&this.loadLostReasons()}closeLostModal(){this.isLostModalOpen=!1,this.selectedLostReason=null,this.lostFeedback=""}submitMarkAsLost(){var t=this;return(0,b.A)(function*(){if(t.opportunityId&&t.selectedLostReason){t.lostLoading=!0;try{yield t.crmService.markLost(t.opportunityId,t.selectedLostReason,t.lostFeedback).toPromise(),t.closeLostModal(),t.notificationService.success("Quotation marked as lost successfully"),t.router.navigate(["/dashboard/broker/quotations"])}catch(i){console.error("Failed to mark as lost",i),t.notificationService.error("Failed to mark as lost. Please try again.")}finally{t.lostLoading=!1}}})()}toggleSection(t,i){this.openSections[t]=void 0!==i?i:!this.openSections[t]}isSectionOpen(t){return!!this.openSections[t]}get isSelectionComplete(){return!!(this.vehicleForm.make&&this.vehicleForm.model&&this.vehicleForm.year)}get isIdentificationComplete(){return!(!this.vehicleForm.chassisNo||!this.vehicleForm.engineNo)}get isSpecificationsComplete(){return!!(this.vehicleForm.bodyType&&this.vehicleForm.color&&this.vehicleForm.cc&&this.vehicleForm.seats)}get isFinancialComplete(){return!(!this.vehicleForm.sumInsured||!this.vehicleForm.vehicle_state)}get isAdditionalDetailsValid(){return!!(this.vehicleForm.category&&this.vehicleForm.bodyType&&this.vehicleForm.color&&this.vehicleForm.usage&&this.vehicleForm.cc&&this.vehicleForm.seats&&this.vehicleForm.plateNo&&this.vehicleForm.sumInsured)}get makeName(){if(!this.vehicleForm.make)return"";const t=this.makers.find(i=>i.code===this.vehicleForm.make||i.id===this.vehicleForm.make);return t?t.name:this.vehicleForm.make}get modelName(){if(!this.vehicleForm.model)return"";const t=this.models.find(i=>i.code===this.vehicleForm.model||i.id===this.vehicleForm.model);return t?t.name:this.vehicleForm.model}get yearName(){if(!this.vehicleForm.year)return"";const t=this.years.find(i=>String(i.code)===String(this.vehicleForm.year)||String(i.id)===String(this.vehicleForm.year));return t?t.name:this.vehicleForm.year}onCustomerSelected(t){this.selectedCustomer=t,this.isCustomerModalOpen=!1,this.nextStep()}onProgramSelected(t){this.vehicleForm.roadSideProgram=t,console.log("Program selected:",t)}onRoadsideToggled(t){this.vehicleForm.hasRoadSide=t,t||(this.vehicleForm.roadSideProgram=""),console.log("Roadside toggled:",t)}submitVehicleDetails(){var t=this;return(0,b.A)(function*(){t.loading=!0,t.error=null;try{const i=t.authService.currentUserValue,r=(p,f)=>p?String(p).includes("/")?p:`${f}/${p}`:"",o=t.years.find(p=>p.code===t.vehicleForm.year),s=o?o.name:t.vehicleForm.year,l={user_id:i?.id||2,user_type:"broker",product_code:"40020",lead_source:"Web Portal",customer_info:{customer_name:t.selectedCustomer.name||t.selectedCustomer.clientName,phone:t.selectedCustomer.phone,email:t.selectedCustomer.email,national_id:t.selectedCustomer.nationalId||t.selectedCustomer.national_id||t.selectedCustomer.identification_number,customer_date_of_birth:t.selectedCustomer.dateOfBirth||t.selectedCustomer.date_of_birth||"",gender:t.selectedCustomer.gender||"male",is_foreign_customer:t.selectedCustomer.isForeignCustomer||t.selectedCustomer.is_foreign||!1,passport_id:t.selectedCustomer.passportId||t.selectedCustomer.passport_id||"",tax_id:t.selectedCustomer.taxId||"",street:t.selectedCustomer.street||"",city:t.selectedCustomer.city||"",state_name:t.selectedCustomer.stateName||t.selectedCustomer.state||"",country_name:t.selectedCustomer.countryName||t.selectedCustomer.country||"Egypt",customer_branch_codes:["100"],customer_activity_code:"ACTIVITY/0001"},risk_info:{vehicle_make:r(t.vehicleForm.make,"MAKER"),vehicle_model:r(t.vehicleForm.model,"CAR MODEL"),vehicle_manufacturing_year:String(s||""),vehicle_usage:t.vehicleForm.usage||"",vehicle_sum_insured:Number(t.vehicleForm.sumInsured||0),vehicle_chassis_number:t.vehicleForm.chassisNo,vehicle_engine_number:t.vehicleForm.engineNo,vehicle_state:t.vehicleForm.vehicle_state||"new",vehicle_number_of_kilometers:Number(t.vehicleForm.kilometers||0),vehicle_road_side_program:r(t.vehicleForm.roadSideProgram,"ROAD SIDE PROGRAM"),vehicle_plate_number:t.vehicleForm.plateNo||"",vehicle_color:t.vehicleForm.color||"",vehicle_body_type:t.vehicleForm.bodyType||"",vehicle_fuel_type:t.vehicleForm.fuelType||"",vehicle_cc:t.vehicleForm.cc||"",vehicle_seats:t.vehicleForm.seats||"5",vehicle_category:t.vehicleForm.category||""}},d=yield t.quoteService.requestQuotation(l).toPromise();if(d?.result?.error)return t.notificationService.error(d.result.error),void(t.loading=!1);if(t.opportunityId=d?.result?.opportunity_id||d?.result?.data?.opportunity_id||d?.data?.opportunity_id||d?.opportunity_id,t.quotationData=d?.result?.data||d?.result||d?.data||d,d?.result?.proposals&&Array.isArray(d.result.proposals))t.proposals=d.result.proposals;else if(t.opportunityId)try{yield t.quoteService.generateProposals(t.opportunityId).toPromise();const p=yield t.quoteService.getProposals(t.opportunityId).toPromise();t.proposals=p?.result?.proposals||p?.data?.proposals||p?.proposals||[]}catch(p){console.error("Failed to fetch proposals",p)}t.loading=!1,console.log("Checking for roadside info in response:",d);const g=d?.result?.data?.risks?.[0]||d?.result?.risks?.[0]||d?.data?.risks?.[0]||d?.risks?.[0];if(g){if(void 0!==g.vehicle_has_road_side&&(t.vehicleForm.hasRoadSide=g.vehicle_has_road_side),g.vehicle_road_side_program_name||g.vehicle_road_side_program){const p=String(g.vehicle_road_side_program_name||g.vehicle_road_side_program);t.vehicleForm.roadSideProgram=p.toLowerCase().replace(/\s+/g,"-")}console.log("Updated roadside info from response:",{has:t.vehicleForm.hasRoadSide,program:t.vehicleForm.roadSideProgram})}t.loading=!1,t.currentStep++}catch(i){console.error("Failed to request quotation",i),t.notificationService.error(i?.response?.data?.result?.error||i?.response?.data?.error||i?.message||"Failed to request quotation. Please try again."),t.loading=!1}})()}selectProposal(t){this.selectedProposal=t}loadRequiredDocuments(){var t=this;return(0,b.A)(function*(){if(t.opportunityId)try{const i=yield t.quoteService.getCRMDocuments().toPromise();t.requiredDocuments=i?.crm_documents||i?.result?.data||i?.data||[],console.log("Loaded required documents:",t.requiredDocuments)}catch(i){console.error("Failed to load required documents",i),t.notificationService.error("Failed to load document requirements")}})()}onFileSelected(t,i){const r=t.target.files[0];if(r){const o=new FileReader;o.onload=()=>{const s=o.result.split(",")[1];this.uploadedDocuments.set(i,{file_name:r.name,file_data:s,document_id:i})},o.readAsDataURL(r)}}issuePolicy(){var t=this;return(0,b.A)(function*(){if(t.selectedProposal&&t.opportunityId){t.loading=!0,t.error=null;try{const r=(f,Q)=>f?f.includes("/")?f:`${Q}/${f.padStart(4,"0")}`:"",o=t.years.find(f=>f.code===t.vehicleForm.year),s=o?o.name:t.vehicleForm.year,l=Array.from(t.uploadedDocuments.entries()).map(([f,Q])=>{const O=t.requiredDocuments.find(Ra=>String(Ra.id)===String(f)),Z=O?.sequence_number||O?.code||O?.name||O?.item||"";return console.log("Document mapping:",{docId:f,doc:O,documentName:Z}),{document_name:Z,files:[Q.file_data]}}),d={opportunity_id:t.opportunityId,selected_proposal_id:t.selectedProposal.id||t.selectedProposal.proposal_id,payment_info:{payment_method:"Payment Method/0001",payment_reference:"",payment_reference_file_content:""},crm_documents:l,risk_info:{vehicle_state:t.vehicleForm.vehicle_state||"new",vehicle_manufacturing_year:String(s||""),vehicle_make:r(t.vehicleForm.make,"MAKER"),vehicle_model:r(t.vehicleForm.model,"CAR MODEL"),vehicle_category:r(t.vehicleForm.category,"CAR CATEGORY"),vehicle_color:r(t.vehicleForm.color,"CAR COLOR"),vehicle_body_type:r(t.vehicleForm.bodyType,"BODY TYPE"),vehicle_fuel_type:r(t.vehicleForm.fuelType,"FUEL TYPE"),vehicle_usage:r(t.vehicleForm.usage,"USAGE"),vehicle_cc:r(t.vehicleForm.cc,"CC"),vehicle_number_of_seats:Number(t.vehicleForm.seats||5),vehicle_sum_insured:Number(t.vehicleForm.sumInsured||0),vehicle_chassis_number:t.vehicleForm.chassisNo,vehicle_plate_number:t.vehicleForm.plateNo||"",vehicle_engine_number:t.vehicleForm.engineNo,vehicle_has_road_side:t.vehicleForm.hasRoadSide||!1,vehicle_road_side_program:t.vehicleForm.hasRoadSide?r(t.vehicleForm.roadSideProgram,"ROAD SIDE PROGRAM"):""}};console.log("Issuance payload:",d);const g=yield t.quoteService.requestIssuance(d).toPromise();if(g?.result?.error)return t.notificationService.error(g.result.error||"Issuance failed"),void(t.loading=!1);const p=g?.result?.policy_id||g?.data?.policy_id;t.notificationService.success("Policy issued successfully!"),t.issuanceSuccess=!0,t.issuanceResponseData={policy_id:p,policy_number:g?.result?.policy_number||g?.data?.policy_number||"Pending",policy_state:g?.result?.state||g?.data?.state||"Active",opportunity_number:g?.result?.opportunity_number||g?.data?.opportunity_number},t.loading=!1}catch(i){console.error("Failed to issue policy",i),t.notificationService.error(i?.response?.data?.result?.error||i?.response?.data?.error||i?.message||"Failed to issue policy. Please try again."),t.loading=!1}}})()}nextStep(){if(0===this.currentStep&&this.isVehicleFormValid())this.submitVehicleDetails();else if(1!==this.currentStep||this.selectedProposal)if(1===this.currentStep)this.currentStep++;else if(2===this.currentStep){if(!this.isAdditionalDetailsValid)return void this.notificationService.warning("Please complete all required fields");this.loadRequiredDocuments(),this.currentStep++}else this.currentStep<this.steps.length-1&&this.currentStep++;else this.notificationService.warning("Please select a coverage plan")}previousStep(){this.currentStep>0&&this.currentStep--}isVehicleFormValid(){return this.isSelectionComplete&&this.isIdentificationComplete&&this.isFinancialComplete}canProceed(){switch(this.currentStep){case 0:return this.isVehicleFormValid();case 1:return!!this.selectedProposal;case 2:return this.isAdditionalDetailsValid;case 3:return this.requiredDocuments.every(t=>!t.required_document||this.uploadedDocuments.has(t.id));default:return!0}}downloadProposalPdf(t){var i=this;return(0,b.A)(function*(){const r=t.id||t.proposal_id;if(r)try{i.downloadingProposalId=r;const o=yield i.quoteService.downloadProposalPdf(Number(r)).toPromise();if(o){const s=window.URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download=`Proposal_${t.proposal_reference||r}.pdf`,l.click(),window.URL.revokeObjectURL(s)}}catch(o){console.error("Error downloading proposal PDF:",o),i.notificationService.error("Failed to download proposal PDF. Please try again.")}finally{i.downloadingProposalId=null}else console.error("Analysis failed: Proposal ID is missing.")})()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.Ix),e.rXU(h.nX),e.rXU(U.K),e.rXU(j.u),e.rXU(A.m),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-quote-flow"]],decls:25,vars:12,consts:[[1,"max-w-7xl","mx-auto"],["class","mb-8 max-w-4xl mx-auto text-center",4,"ngIf"],[3,"steps","currentStep",4,"ngIf"],[4,"ngIf"],["class","space-y-6",4,"ngIf"],["class","flex justify-between mt-8",4,"ngIf"],["title","Mark as Lost",3,"close","isOpen"],[1,"p-6","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],[1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["rows","3","placeholder","Add any additional context...",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","focus:ring-2","focus:ring-primary","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-3","mt-6"],[1,"px-4","py-2","text-gray-700","hover:bg-gray-100","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-red-600","hover:bg-red-700","text-white","rounded-lg","font-medium","transition-colors","disabled:bg-gray-400",3,"click","disabled"],[1,"mb-8","max-w-4xl","mx-auto","text-center"],[1,"text-3xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300"],[3,"steps","currentStep"],["class","space-y-4",4,"ngIf"],[1,"space-y-4"],["title","Vehicle Selection","icon","car",3,"toggle","expanded","isComplete"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["label","Make",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","required","imageKey"],["label","Model",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","disabled","required"],["label","Year",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","disabled","required"],["title","Identification","icon","hash",3,"toggle","expanded","isComplete"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"text-red-500"],["type","text","required","",1,"block","w-full","h-11","px-4","rounded-lg","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-gray-800","text-gray-900","dark:text-gray-100","focus:ring-2","focus:ring-primary","focus:border-primary",3,"ngModelChange","ngModel"],["title","Financial & Condition","icon","dollar-sign",3,"toggle","expanded","isComplete"],["type","number","min","0","step","1000","placeholder","e.g., 500000","required","",1,"block","w-full","h-11","px-4","rounded-lg","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-gray-800","text-gray-900","dark:text-gray-100","focus:ring-2","focus:ring-primary","focus:border-primary",3,"ngModelChange","ngModel"],["label","Vehicle Condition",3,"valueChange","value","options","title","subtitle","placeholder","layout"],[1,"space-y-6"],[1,"bg-white","dark:bg-gray-800","p-8","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-6"],["class","flex justify-center py-12",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-3 gap-6",4,"ngIf"],[1,"flex","justify-center","py-12"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"text-center","py-12"],["data-lucide","shield",1,"w-16","h-16","text-gray-400","mx-auto","mb-4"],["class","relative border rounded-xl p-6 cursor-pointer transition-all duration-200",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"relative","border","rounded-xl","p-6","cursor-pointer","transition-all","duration-200",3,"click","ngClass"],["class","absolute -top-3 -right-3 bg-blue-600 text-white p-1 rounded-full shadow-md",4,"ngIf"],[1,"mb-4","pb-4","border-b","border-gray-200","dark:border-gray-700/50"],[1,"text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"text-lg","font-bold","text-navy","dark:text-white"],[1,"mb-4"],[1,"text-xs","text-gray-500"],[1,"text-3xl","font-bold","text-blue-600","dark:text-blue-400"],[1,"space-y-3","mb-6","bg-white/50","dark:bg-black/20","p-4","rounded-lg"],[1,"flex","justify-between","items-center","text-sm"],[1,"text-gray-600","dark:text-gray-400"],[1,"font-medium","text-navy","dark:text-white"],["variant","outline",1,"w-full",3,"click","disabled"],["name","download","class","w-4 h-4 mr-2",4,"ngIf"],["name","loader-2","class","w-4 h-4 mr-2 animate-spin",4,"ngIf"],[1,"absolute","-top-3","-right-3","bg-blue-600","text-white","p-1","rounded-full","shadow-md"],["data-lucide","check",1,"w-4","h-4"],["name","download",1,"w-4","h-4","mr-2"],["name","loader-2",1,"w-4","h-4","mr-2","animate-spin"],["title","Specifications","icon","file-text",3,"expanded","isComplete"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["label","Category",3,"valueChange","value","options","title","subtitle","placeholder","layout","disabled","required"],["label","Body Type",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","required"],["label","Color",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","required"],["label","Fuel Type",3,"valueChange","value","options","title","subtitle","placeholder","layout","required"],["label","Vehicle Usage",3,"valueChange","value","options","title","subtitle","placeholder","layout","required"],["label","Engine CC",3,"valueChange","value","options","title","subtitle","placeholder","layout","gridCols","required"],["type","number","min","1","max","50","required","",1,"block","w-full","h-11","px-4","rounded-lg","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-gray-800","text-gray-900","dark:text-gray-100","focus:ring-2","focus:ring-primary","focus:border-primary",3,"ngModelChange","ngModel"],["type","number","min","0","placeholder","e.g., 50000",1,"block","w-full","h-11","px-4","rounded-lg","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-gray-800","text-gray-900","dark:text-gray-100","focus:ring-2","focus:ring-primary","focus:border-primary",3,"ngModelChange","ngModel"],["title","Additional Coverage","icon","shield",3,"expanded","isComplete"],[3,"includeRoadsideChange","selectedProgramChange","programSelected","roadsideToggled","includeRoadside","selectedProgram"],["class","p-5 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-blue-300 dark:hover:border-blue-700 transition-colors bg-white dark:bg-gray-800",4,"ngFor","ngForOf"],["data-lucide","file-text",1,"w-16","h-16","text-gray-400","mx-auto","mb-4"],[1,"p-5","border","border-gray-200","dark:border-gray-700","rounded-lg","hover:border-blue-300","dark:hover:border-blue-700","transition-colors","bg-white","dark:bg-gray-800"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-full","flex","items-center","justify-center",3,"ngClass"],[1,"w-5","h-5"],[1,"font-bold","text-navy","dark:text-white","block","text-sm"],["class","text-xs text-gray-500 dark:text-gray-400",4,"ngIf"],["class","text-xs text-green-600 dark:text-green-400 font-medium",4,"ngIf"],["class","text-red-500 font-bold text-lg","title","Required",4,"ngIf"],[1,"relative"],["type","file","accept",".pdf,.jpg,.jpeg,.png",1,"hidden",3,"change","id"],[1,"flex","items-center","justify-center","w-full","px-4","py-3","border-2","border-dashed","rounded-lg","cursor-pointer","transition-colors","text-sm","font-medium",3,"for","ngClass"],["class","truncate px-2",4,"ngIf"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-green-600","dark:text-green-400","font-medium"],["title","Required",1,"text-red-500","font-bold","text-lg"],[1,"truncate","px-2"],[1,"mb-6","pb-6","border-b","border-gray-200","dark:border-gray-700"],[1,"font-bold","text-lg","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","text-sm"],[1,"text-gray-500","mb-1"],[1,"font-medium"],[1,"mb-6"],["class","bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-700",4,"ngIf"],[1,"flex","justify-center"],[1,"px-8","py-3","bg-green-600","hover:bg-green-700","text-white","rounded-lg","font-semibold","transition-colors","disabled:bg-gray-400","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["data-lucide","check-circle",1,"w-5","h-5"],[1,"bg-gradient-to-br","from-blue-50","to-indigo-50","dark:from-blue-900/20","dark:to-indigo-900/20","p-6","rounded-xl","border","border-blue-100","dark:border-blue-700"],[1,"flex","justify-between","items-start","mb-4"],[1,"font-bold","text-xl","text-navy","dark:text-white"],[1,"text-3xl","font-bold","text-primary"],[1,"grid","grid-cols-3","gap-4","text-sm"],[1,"bg-white","dark:bg-gray-800","p-12","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","text-center"],[1,"mb-8","flex","justify-center"],[1,"w-24","h-24","rounded-full","bg-green-100","dark:bg-green-900/30","flex","items-center","justify-center","animate-bounce-short"],["data-lucide","check-circle",1,"w-12","h-12","text-green-600","dark:text-green-400"],[1,"text-3xl","font-bold","text-navy","dark:text-white","mb-4"],[1,"text-lg","text-gray-600","dark:text-gray-300","mb-10","max-w-lg","mx-auto"],["class","max-w-3xl mx-auto bg-gray-50 dark:bg-gray-700/30 rounded-xl p-8 mb-10 text-left",4,"ngIf"],[1,"px-8","py-4","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-all","font-semibold","shadow-lg","hover:shadow-xl","flex","items-center","gap-3",3,"routerLink"],["data-lucide","list",1,"w-5","h-5"],[1,"max-w-3xl","mx-auto","bg-gray-50","dark:bg-gray-700/30","rounded-xl","p-8","mb-10","text-left"],[1,"font-bold","text-lg","text-navy","dark:text-white","mb-6","border-b","border-gray-200","dark:border-gray-600","pb-2"],[1,"text-gray-500","dark:text-gray-400","mb-1","text-sm"],[1,"font-bold","text-lg","text-navy","dark:text-white"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-green-100","text-green-800","dark:bg-green-900","dark:text-green-200"],[1,"flex","justify-between","mt-8"],[1,"flex","gap-3"],["class","px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",3,"disabled","click",4,"ngIf"],["class","px-6 py-3 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors flex items-center gap-2",3,"click",4,"ngIf"],["class","px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2 ml-auto",3,"disabled","click",4,"ngIf"],[1,"px-6","py-3","border","border-gray-300","dark:border-gray-600","text-gray-700","dark:text-gray-300","rounded-lg","hover:bg-gray-50","dark:hover:bg-gray-700","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["data-lucide","chevron-left",1,"w-4","h-4"],[1,"px-6","py-3","border","border-red-300","text-red-600","rounded-lg","hover:bg-red-50","transition-colors","flex","items-center","gap-2",3,"click"],["data-lucide","x-circle",1,"w-4","h-4"],[1,"px-6","py-3","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-colors","disabled:bg-gray-400","disabled:cursor-not-allowed","flex","items-center","gap-2","ml-auto",3,"click","disabled"],["data-lucide","chevron-right",1,"w-4","h-4"],[3,"value"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0),e.DNE(2,mr,5,0,"div",1)(3,gr,1,2,"app-modern-stepper",2)(4,Ar,6,5,"div",3)(5,Lr,14,3,"div",4)(6,Br,5,3,"div",5),e.k0s()(),e.j41(7,"app-modal",6),e.bIt("close",function(){return r.closeLostModal()}),e.j41(8,"div",7)(9,"div")(10,"label",8),e.EFF(11," Reason for loss "),e.k0s(),e.j41(12,"select",9),e.mxI("ngModelChange",function(s){return e.DH7(r.selectedLostReason,s)||(r.selectedLostReason=s),s}),e.j41(13,"option",10),e.EFF(14,"Select a reason"),e.k0s(),e.DNE(15,Ur,2,2,"option",11),e.k0s()(),e.j41(16,"div")(17,"label",8),e.EFF(18," Feedback (Optional) "),e.k0s(),e.j41(19,"textarea",12),e.mxI("ngModelChange",function(s){return e.DH7(r.lostFeedback,s)||(r.lostFeedback=s),s}),e.k0s()(),e.j41(20,"div",13)(21,"button",14),e.bIt("click",function(){return r.closeLostModal()}),e.EFF(22," Cancel "),e.k0s(),e.j41(23,"button",15),e.bIt("click",function(){return r.submitMarkAsLost()}),e.EFF(24),e.k0s()()()()),2&i&&(e.R7$(2),e.Y8G("ngIf",!r.issuanceSuccess),e.R7$(),e.Y8G("ngIf",!r.issuanceSuccess),e.R7$(),e.Y8G("ngIf",!r.issuanceSuccess),e.R7$(),e.Y8G("ngIf",r.issuanceSuccess),e.R7$(),e.Y8G("ngIf",!r.issuanceSuccess),e.R7$(),e.Y8G("isOpen",r.isLostModalOpen),e.R7$(5),e.R50("ngModel",r.selectedLostReason),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",r.lostReasons),e.R7$(4),e.R50("ngModel",r.lostFeedback),e.R7$(4),e.Y8G("disabled",!r.selectedLostReason||r.lostLoading),e.R7$(),e.SpI(" ",r.lostLoading?"Processing...":"Confirm Lost"," "))},dependencies:[m.YU,m.Sq,m.bT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.YS,u.VZ,u.zX,u.vS,h.Wk,v.w,N.Q,Bt,qt,zt.x,z.j,c.WGl,K,m.oe],styles:["@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(0) rotate(-45deg);opacity:0}to{transform:scale(1) rotate(0);opacity:1}}.animate-scaleIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_scaleIn .4s cubic-bezier(.175,.885,.32,1.275) forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-out forwards}"]})}}return a})();var W=_(621);function Vr(a,n){if(1&a&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function Xr(a,n){1&a&&(e.j41(0,"div",19),e.nrm(1,"app-loading-spinner"),e.k0s())}function Qr(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",20),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.columns)("showExport",!0)("maxSelectOptions",10)}}function Jr(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",21),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}let Hr=(()=>{class a{constructor(t,i,r,o){this.appTranslate=t,this.brokerService=i,this.authService=r,this.notificationService=o,this.totalCommissions=0,this.paidCommissions=0,this.pendingCommissions=0,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.currentPage=1,this.pageSize=25,this.totalRecords=0,this.paymentStatus="paid",this.setupColumns()}ngOnInit(){this.loadCommissions(),this.loadCommissionSummary()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"id",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.COMMISSION_ID"),filterable:!0,filterType:"text"},{key:"policyNumber",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.POLICY_NO"),filterable:!0,filterType:"text"},{key:"partnerName",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.CLIENT_NAME"),filterable:!0,filterType:"text"},{key:"productName",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.PRODUCT"),filterable:!0},{key:"commissionRate",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.RATE"),filterable:!1,render:t=>t.commissionRate?`${t.commissionRate}%`:"N/A"},{key:"commissionAmount",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.COMMISSION"),filterable:!1,render:t=>t.commissionAmount?`$${t.commissionAmount.toLocaleString()}`:"$0"},{key:"paymentStatus",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t.paymentStatus)},{key:"date",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.DATE"),filterable:!0,filterType:"date"},{key:"actions",label:this.appTranslate.instant("BROKER.COMMISSIONS.COLUMNS.ACTIONS"),filterable:!1,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(t){const i=t?.toLowerCase()||"outstanding";let r="";return r=["paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["outstanding","pending"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}loadCommissions(){this.isLoading=!0,this.error=null;const t=this.authService.currentUserValue;if(!t||!t.id)return this.error="ERROR.USER_NOT_FOUND",this.isLoading=!1,void this.notificationService.error(this.appTranslate.instant("ERROR.USER_NOT_FOUND"));const i=t.id,r=(this.currentPage-1)*this.pageSize;this.brokerService.getCommissions(i,this.paymentStatus).subscribe({next:o=>{o.result?.data?(this.totalRecords=o.result.data.length,this.brokerService.getCommissions(i,this.paymentStatus,this.pageSize,r).subscribe({next:s=>{this.data=s.result?.data?this.mapCommissionData(s.result.data):[],this.isLoading=!1},error:s=>{this.handleError(s)}})):(this.data=[],this.totalRecords=0,this.isLoading=!1)},error:o=>{this.handleError(o)}})}loadCommissionSummary(){const t=this.authService.currentUserValue;if(!t||!t.id)return;const i=t.id;this.brokerService.getCommissions(i,"paid").subscribe({next:r=>{r.result?.data&&(this.paidCommissions=r.result.data.reduce((o,s)=>o+(s.commission_amount||0),0))}}),this.brokerService.getCommissions(i,"outstanding").subscribe({next:r=>{r.result?.data&&(this.pendingCommissions=r.result.data.reduce((o,s)=>o+(s.commission_amount||0),0)),this.totalCommissions=this.paidCommissions+this.pendingCommissions}})}mapCommissionData(t){return t.map(i=>({id:i.id||"",policyNumber:i.policy_number||"N/A",partnerName:i.partner_name||"N/A",productName:i.product_name||"N/A",commissionRate:i.commission_rate||0,commissionAmount:i.commission_amount||0,paymentStatus:i.payment_status||"outstanding",date:i.date||i.create_date||"N/A"}))}handleError(t){console.error("Error loading commissions:",t);const i=t?.error?.error?.message||t?.message||"";if(i.includes("No commission lines found"))return this.data=[],this.totalRecords=0,void(this.isLoading=!1);this.error="ERROR.LOADING_DATA",this.isLoading=!1,this.notificationService.error(this.appTranslate.instant("ERROR.LOADING_DATA"),i||this.appTranslate.instant("ERROR.GENERIC"))}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){console.log("Action",t.action,t.data)}onExport(){console.log("Exporting commissions...")}onPageChange(t){this.currentPage=t,this.loadCommissions()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadCommissions()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(I.F),e.rXU(W.d),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-commissions"]],decls:31,vars:22,consts:[[1,"space-y-6"],[1,"bg-green-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-green-500","to-green-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","trending-up",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[3,"title"],[1,"text-3xl","font-bold","text-primary"],[1,"text-3xl","font-bold","text-green-600"],[1,"text-3xl","font-bold","text-yellow-600"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"div",8)(14,"app-card",9),e.nI1(15,"translate"),e.j41(16,"p",10),e.EFF(17),e.k0s()(),e.j41(18,"app-card",9),e.nI1(19,"translate"),e.j41(20,"p",11),e.EFF(21),e.k0s()(),e.j41(22,"app-card",9),e.nI1(23,"translate"),e.j41(24,"p",12),e.EFF(25),e.k0s()()(),e.j41(26,"div",13),e.DNE(27,Vr,3,3,"div",14)(28,Xr,2,0,"div",15)(29,Qr,1,4,"app-dynamic-table-with-filters",16)(30,Jr,1,3,"app-pagination",17),e.k0s()()()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,12,"BROKER.COMMISSIONS.TITLE")),e.R7$(3),e.JRh(e.bMT(12,14,"BROKER.COMMISSIONS.SUBTITLE")),e.R7$(3),e.Y8G("title",e.bMT(15,16,"BROKER.COMMISSIONS.CARDS.TOTAL")),e.R7$(3),e.SpI("$",r.totalCommissions.toLocaleString(),""),e.R7$(),e.Y8G("title",e.bMT(19,18,"BROKER.COMMISSIONS.CARDS.PAID")),e.R7$(3),e.SpI("$",r.paidCommissions.toLocaleString(),""),e.R7$(),e.Y8G("title",e.bMT(23,20,"BROKER.COMMISSIONS.CARDS.PENDING")),e.R7$(3),e.SpI("$",r.pendingCommissions.toLocaleString(),""),e.R7$(2),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0))},dependencies:[m.bT,v.w,H.i,k.N,T.u,F.e,x.D9]})}}return a})();function qr(a,n){if(1&a&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function zr(a,n){1&a&&(e.j41(0,"div",19),e.nrm(1,"app-loading-spinner"),e.k0s())}function Kr(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",20),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.visibleColumns)("showExport",!0)("maxSelectOptions",10)}}function Wr(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",21),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}let Zr=(()=>{class a{constructor(t,i,r,o){this.claimService=t,this.authService=i,this.router=r,this.appTranslate=o,this.allColumns=[],this.visibleColumns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.isChassisModalOpen=!1,this.currentPage=1,this.pageSize=25,this.totalRecords=1e3,this.setupColumns(),this.appTranslate.get("BROKER.CLAIMS.COLUMNS").subscribe(()=>{this.setupColumns()})}ngOnInit(){this.fetchTotalCount(),this.loadClaims()}fetchTotalCount(){const t=this.authService.currentUserValue;t&&this.claimService.listClaims({user_id:t.id,user_type:"broker",limit:1e4,offset:0,domain:[]}).subscribe({next:i=>{let r=[];Array.isArray(i)?r=i:Array.isArray(i.data)?r=i.data:i.data?.result?.data?r=i.data.result.data:i.data?.data&&(r=i.data.data),this.totalRecords=r.length},error:i=>{console.error("Error fetching total claims count",i)}})}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.allColumns=[{key:"claimNumber",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.CLAIM_NO"),filterable:!0,filterType:"text",sortable:!0},{key:"policyNumber",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.POLICY_NO"),filterable:!0,filterType:"text",sortable:!0},{key:"client",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.CLIENT_NAME"),filterable:!0,filterType:"text",sortable:!0},{key:"vehiclePlate",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.VEHICLE_PLATE"),filterable:!0,filterType:"text",sortable:!0},{key:"vehicleMaker",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.VEHICLE_MAKER"),filterable:!0,filterType:"text",sortable:!0},{key:"type",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.LOB"),filterable:!0,sortable:!0},{key:"productName",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.PRODUCT"),filterable:!0,sortable:!0},{key:"status",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t.status)},{key:"amount",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.AMOUNT"),filterable:!1,sortable:!0},{key:"date",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.INTIMATION_DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"actions",label:this.appTranslate.instant("BROKER.CLAIMS.COLUMNS.ACTIONS"),filterable:!1,mandatory:!0,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="download" data-id="${t.id}" title="Download Documents">\n                            <i data-lucide="file-text" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}],this.visibleColumns=[...this.allColumns],console.log("=== CLAIMS COLUMNS SETUP ==="),console.log("Configured columns:",this.allColumns.map(t=>({key:t.key,label:t.label}))),console.log("=== END COLUMNS ===")}onVisibleColumnsChange(t){this.visibleColumns=t}renderStatus(t){const i=t?.toLowerCase()||"pending";let r="";return r=["active","approved","settled","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","submitted","draft","processing","intimated"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}loadClaims(){this.isLoading=!0;const t=this.authService.currentUserValue;t&&this.claimService.listClaims({user_id:t.id,user_type:"broker",limit:this.pageSize,offset:(this.currentPage-1)*this.pageSize,domain:[]}).subscribe({next:r=>{console.log("=== CLAIMS API RESPONSE ==="),console.log("Full response:",r),console.log("Is response an array?",Array.isArray(r)),console.log("response.data:",r.data);let o=[];Array.isArray(r)?(o=r,console.log("Response is a direct array")):Array.isArray(r.data)?(o=r.data,console.log("Response.data is an array")):r.data?.result?.data?(o=r.data.result.data,console.log("Using nested response.data.result.data")):r.data?.data?(o=r.data.data,console.log("Using nested response.data.data")):(o=[],console.warn("Could not extract claims data from response")),console.log("Extracted claimsData:",o),console.log("Number of claims:",o.length),o.length>0&&console.log("First claim raw data:",o[0]),(r.data?.total_count||r.data?.count)&&(this.totalRecords=r.data.total_count||r.data.count),this.data=o.map(s=>({id:s.id||s.claim_id||("number"==typeof s.id?s.id:null)||s.claim_number||"N/A",claimNumber:s.claim_number||"N/A",client:s.customer_name||s.partner_name||s.partner_id?.[1]||"N/A",policyNumber:s.policy_number||s.policy_id?.[1]||"N/A",vehiclePlate:s.vehicle_plate_number||"N/A",vehicleMaker:s.vehicle_maker||"N/A",type:s.lob||s.claim_type||"N/A",productName:s.product_name?"number"==typeof s.product_name?`Product ${s.product_name}`:s.product_name:"N/A",status:(s.state||"pending").toLowerCase().replace(/\s+/g,"_"),date:s.intimation_date||s.claim_date||s.create_date||"N/A",amount:s.claim_amount?`EGP ${s.claim_amount.toLocaleString()}`:"N/A"})),console.log("Mapped data:",this.data),console.log("Number of mapped claims:",this.data.length),this.data.length>0&&console.log("First mapped claim:",this.data[0]),console.log("=== END CLAIMS DATA ==="),this.isLoading=!1},error:r=>{console.error("=== CLAIMS API ERROR ==="),console.error("Error loading claims:",r),console.error("Error details:",JSON.stringify(r,null,2)),console.error("=== END ERROR ==="),this.error="BROKER.CLAIMS.ERROR_LOADING",this.isLoading=!1}})}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){switch(t.action){case"view":this.router.navigate(["/dashboard/broker/claims",t.data.id]);break;case"download":console.log("Download for",t.data.id)}}onExport(){console.log("Exporting claims...")}openChassisModal(){this.isChassisModalOpen=!0}onPageChange(t){this.currentPage=t,this.loadClaims()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadClaims()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU($.q),e.rXU(y.u),e.rXU(h.Ix),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-claims"]],decls:25,vars:16,consts:[[1,"space-y-6"],[1,"bg-teal-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-teal-500","to-teal-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","clipboard-check",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","flex","items-center","gap-2","transition-all",3,"click"],["name","plus",1,"w-4","h-4"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"p-4","border-b","border-gray-100","dark:border-gray-700","flex","justify-end"],[3,"visibleColumnsChange","columns","pageId"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[3,"close","isOpen"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()(),e.j41(13,"button",8),e.bIt("click",function(){return r.isChassisModalOpen=!0}),e.nrm(14,"i-lucide",9),e.EFF(15),e.nI1(16,"translate"),e.k0s()()(),e.j41(17,"div",10)(18,"div",11)(19,"app-column-toggle",12),e.bIt("visibleColumnsChange",function(s){return r.onVisibleColumnsChange(s)}),e.k0s()(),e.DNE(20,qr,3,3,"div",13)(21,zr,2,0,"div",14)(22,Kr,1,4,"app-dynamic-table-with-filters",15)(23,Wr,1,3,"app-pagination",16),e.k0s()(),e.j41(24,"app-chassis-validation-modal",17),e.bIt("close",function(){return r.isChassisModalOpen=!1}),e.k0s()()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,10,"BROKER.CLAIMS.TITLE")),e.R7$(3),e.JRh(e.bMT(12,12,"BROKER.CLAIMS.SUBTITLE")),e.R7$(4),e.SpI(" ",e.bMT(16,14,"BROKER.CLAIMS.INTIMATE_CLAIM")," "),e.R7$(4),e.Y8G("columns",r.allColumns)("pageId","broker-claims-list"),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0),e.R7$(),e.Y8G("isOpen",r.isChassisModalOpen))},dependencies:[m.bT,v.w,k.N,G,T.u,F.e,L,c.WGl,x.D9],encapsulation:2})}}return a})();const S=a=>({"rotate-180":a});function ei(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",11)(1,"div",12),e.nrm(2,"div",13),e.j41(3,"div",14)(4,"div",15)(5,"button",16),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"i-lucide",17),e.j41(9,"span",18),e.EFF(10),e.k0s()(),e.j41(11,"div",19)(12,"div",20)(13,"div",21),e.nrm(14,"i-lucide",22),e.k0s(),e.j41(15,"div")(16,"h1",23),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"p",24),e.EFF(20),e.k0s(),e.j41(21,"div",25)(22,"span",26),e.EFF(23),e.k0s(),e.j41(24,"span",27),e.nrm(25,"i-lucide",28),e.EFF(26),e.k0s(),e.j41(27,"span",27),e.nrm(28,"i-lucide",29),e.EFF(29),e.k0s()()()(),e.j41(30,"div",30)(31,"span",31),e.nrm(32,"i-lucide",32),e.EFF(33),e.k0s()()()()()()}if(2&a){const t=e.XpG();e.R7$(6),e.SpI(" ",e.bMT(7,10,"CLAIMS.DETAILS.BACK")," "),e.R7$(4),e.JRh(t.claim.claimNumber),e.R7$(7),e.Lme("",e.bMT(18,12,"CLAIMS.DETAILS.TITLE"),"",t.claim.claimNumber," "),e.R7$(3),e.SpI("",t.claim.claimType," "),e.R7$(3),e.SpI(" ",t.claim.state," "),e.R7$(3),e.SpI(" Incident: ",t.claim.lossDate," "),e.R7$(3),e.SpI(" ",t.claim.policy.id," "),e.R7$(2),e.Y8G("ngClass",t.getStatusClass(t.claim.state)),e.R7$(2),e.SpI(" ",t.claim.state," ")}}function ti(a,n){1&a&&e.nrm(0,"div",33)}function ri(a,n){1&a&&e.nrm(0,"div",33)}function ii(a,n){1&a&&(e.j41(0,"div",77),e.nrm(1,"i-lucide",78),e.j41(2,"div")(3,"p",79),e.EFF(4),e.nI1(5,"translate"),e.k0s()()()),2&a&&(e.R7$(4),e.SpI("",e.bMT(5,1,"CLAIMS.DETAILS.OBLIGATION_PROCESSING")," "))}function ai(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",81)(2,"div",82)(3,"p",83),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",84),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",83),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",85),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",83),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",85),e.EFF(19),e.k0s()(),e.j41(20,"div",82)(21,"p",83),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"p",85),e.EFF(25),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,9,"CLAIMS.DETAILS.CLAIMANT.NAME"),""),e.R7$(2),e.FS9("title",t.claim.claimant.name),e.R7$(),e.JRh(t.claim.claimant.name),e.R7$(3),e.SpI(" ",e.bMT(11,11,"CLAIMS.DETAILS.CLAIMANT.CODE"),""),e.R7$(3),e.JRh(t.claim.claimant.code),e.R7$(3),e.SpI(" ",e.bMT(17,13,"CLAIMS.DETAILS.CLAIMANT.MOBILE"),""),e.R7$(3),e.JRh(t.claim.claimant.phone),e.R7$(3),e.SpI(" ",e.bMT(23,15,"CLAIMS.DETAILS.CLAIMANT.BENEFICIARY"),""),e.R7$(3),e.SpI("",t.claim.claimant.beneficiary," ")}}function oi(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",81)(2,"div",82)(3,"p",83),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",87),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",83),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",85),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",83),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",85),e.EFF(19),e.k0s()()()()),2&a){const t=e.XpG(3);e.R7$(4),e.SpI(" ",e.bMT(5,6,"CLAIMS.DETAILS.INTIMATOR.NAME"),""),e.R7$(3),e.SpI("",t.claim.intimator.name," "),e.R7$(3),e.SpI(" ",e.bMT(11,8,"CLAIMS.DETAILS.INTIMATOR.CONTACT"),""),e.R7$(3),e.JRh(t.claim.intimator.phone),e.R7$(3),e.SpI(" ",e.bMT(17,10,"CLAIMS.DETAILS.INTIMATOR.RELATION"),""),e.R7$(3),e.SpI("",t.claim.intimator.relation," ")}}function ni(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",63)(1,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.isIntimatorExpanded=!r.isIntimatorExpanded)}),e.j41(2,"h3",65),e.nrm(3,"i-lucide",86),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"i-lucide",67),e.k0s(),e.DNE(7,oi,20,12,"div",68),e.k0s()}if(2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,3,"CLAIMS.DETAILS.INTIMATOR.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(5,S,t.isIntimatorExpanded)),e.R7$(),e.Y8G("ngIf",t.isIntimatorExpanded)}}function si(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",81)(2,"div",82)(3,"p",83),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",85),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",83),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",85),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",83),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",85),e.EFF(19),e.k0s()(),e.j41(20,"div",82)(21,"p",83),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"span",88),e.EFF(25),e.k0s()(),e.j41(26,"div",82)(27,"p",83),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"p",85),e.EFF(31),e.k0s()(),e.j41(32,"div",82)(33,"p",83),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.j41(36,"p",89),e.EFF(37),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,15,"CLAIMS.DETAILS.POLICY.NUMBER"),""),e.R7$(3),e.JRh(t.claim.policy.id),e.R7$(3),e.SpI(" ",e.bMT(11,17,"CLAIMS.DETAILS.POLICY.PRODUCT_LOB"),""),e.R7$(3),e.Lme("",t.claim.policy.type," / ",t.claim.policy.lob,""),e.R7$(3),e.SpI(" ",e.bMT(17,19,"CLAIMS.DETAILS.POLICY.BROKER"),""),e.R7$(3),e.Lme("",t.claim.policy.brokerName," (",t.claim.policy.brokerCode,")"),e.R7$(3),e.SpI(" ",e.bMT(23,21,"CLAIMS.DETAILS.POLICY.PAYMENT_STATUS"),""),e.R7$(3),e.JRh(t.claim.policy.status),e.R7$(3),e.SpI(" ",e.bMT(29,23,"CLAIMS.DETAILS.POLICY.EFFECTIVE_DATES"),""),e.R7$(3),e.Lme("",t.claim.policy.effectiveFrom," - ",t.claim.policy.effectiveTo,""),e.R7$(3),e.SpI(" ",e.bMT(35,25,"CLAIMS.DETAILS.POLICY.SOURCE_BUSINESS"),""),e.R7$(3),e.JRh(t.claim.policy.sourceOfBusiness)}}function li(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",81)(2,"div",82)(3,"p",83),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",85),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",83),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",85),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",83),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",85),e.EFF(19),e.k0s()(),e.j41(20,"div",82)(21,"p",83),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"p",85),e.EFF(25),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,9,"CLAIMS.DETAILS.DRIVER.NAME"),""),e.R7$(3),e.JRh(t.claim.driver.name),e.R7$(3),e.SpI(" ",e.bMT(11,11,"CLAIMS.DETAILS.DRIVER.BIRTH_DATE"),""),e.R7$(3),e.SpI("",t.claim.driver.birthDate," "),e.R7$(3),e.SpI(" ",e.bMT(17,13,"CLAIMS.DETAILS.DRIVER.LICENSE_TYPE"),""),e.R7$(3),e.SpI("",t.claim.driver.licenceType," "),e.R7$(3),e.SpI(" ",e.bMT(23,15,"CLAIMS.DETAILS.DRIVER.LICENSE_PERIOD"),""),e.R7$(3),e.Lme("",t.claim.driver.licenceStart," - ",t.claim.driver.licenceExpiry,"")}}function di(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",90)(2,"div",82)(3,"p",91),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",92),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",91),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",93),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",91),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",92),e.EFF(19),e.k0s()(),e.j41(20,"div",82)(21,"p",91),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"p",94),e.EFF(25),e.k0s()(),e.j41(26,"div",82)(27,"p",91),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"p",94),e.EFF(31),e.k0s()(),e.j41(32,"div",82)(33,"p",91),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.j41(36,"p",85),e.EFF(37),e.k0s()(),e.j41(38,"div",82)(39,"p",91),e.EFF(40),e.nI1(41,"translate"),e.k0s(),e.j41(42,"p",85),e.EFF(43),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(4),e.JRh(e.bMT(5,16,"CLAIMS.DETAILS.VEHICLE.MAKE_MODEL")),e.R7$(3),e.Lme("",t.claim.vehicle.make," ",t.claim.vehicle.model,""),e.R7$(3),e.JRh(e.bMT(11,18,"CLAIMS.DETAILS.VEHICLE.PLATE_NUMBER")),e.R7$(3),e.SpI(" ",t.claim.vehicle.plateNumber,""),e.R7$(3),e.JRh(e.bMT(17,20,"CLAIMS.DETAILS.VEHICLE.YEAR")),e.R7$(3),e.JRh(t.claim.vehicle.year),e.R7$(3),e.JRh(e.bMT(23,22,"CLAIMS.DETAILS.VEHICLE.CHASSIS_NUMBER")),e.R7$(3),e.JRh(t.claim.vehicle.chassisNumber),e.R7$(3),e.JRh(e.bMT(29,24,"CLAIMS.DETAILS.VEHICLE.MOTOR_NUMBER")),e.R7$(3),e.JRh(t.claim.vehicle.motorNumber),e.R7$(3),e.JRh(e.bMT(35,26,"CLAIMS.DETAILS.VEHICLE.CATEGORY")),e.R7$(3),e.JRh(t.claim.vehicle.category),e.R7$(3),e.JRh(e.bMT(41,28,"CLAIMS.DETAILS.VEHICLE.LICENSE_VALIDITY")),e.R7$(3),e.Lme("",t.claim.vehicle.licenceStart," - ",t.claim.vehicle.licenceExpiry,"")}}function ci(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",95)(2,"div",96)(3,"div",97)(4,"span",98),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"span",99),e.EFF(8),e.k0s()(),e.j41(9,"div",97)(10,"span",98),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"span",99),e.EFF(14),e.k0s()(),e.j41(15,"div",97)(16,"span",98),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"span",99),e.EFF(20),e.k0s()(),e.j41(21,"div",97)(22,"span",98),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"span",99),e.EFF(26),e.k0s()()(),e.j41(27,"div")(28,"p",100),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"div",101),e.EFF(32),e.k0s()(),e.j41(33,"div",102)(34,"h4",103),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",104)(38,"div")(39,"p",98),e.EFF(40),e.nI1(41,"translate"),e.k0s(),e.j41(42,"p",58),e.EFF(43),e.k0s()(),e.j41(44,"div")(45,"p",98),e.EFF(46),e.nI1(47,"translate"),e.k0s(),e.j41(48,"p",58),e.EFF(49),e.k0s()(),e.j41(50,"div")(51,"p",98),e.EFF(52),e.nI1(53,"translate"),e.k0s(),e.j41(54,"p",105),e.EFF(55),e.k0s()()()()()()),2&a){const t=e.XpG(2);e.R7$(5),e.JRh(e.bMT(6,17,"CLAIMS.DETAILS.INCIDENT_REPORT.LOCATION")),e.R7$(3),e.JRh(t.claim.incident.location),e.R7$(3),e.JRh(e.bMT(12,19,"CLAIMS.DETAILS.INCIDENT_REPORT.NATURE_OF_LOSS")),e.R7$(3),e.JRh(t.claim.incident.natureOfLoss),e.R7$(3),e.JRh(e.bMT(18,21,"CLAIMS.DETAILS.INCIDENT_REPORT.CAUSE_OF_LOSS")),e.R7$(3),e.JRh(t.claim.incident.causeOfLoss),e.R7$(3),e.JRh(e.bMT(24,23,"CLAIMS.DETAILS.INCIDENT_REPORT.SEVERITY")),e.R7$(3),e.JRh(t.claim.incident.severity),e.R7$(3),e.JRh(e.bMT(30,25,"CLAIMS.DETAILS.INCIDENT_REPORT.DESCRIPTION")),e.R7$(3),e.SpI(" ",t.claim.incident.description," "),e.R7$(3),e.JRh(e.bMT(36,27,"CLAIMS.DETAILS.POLICE_REPORT.TITLE")),e.R7$(5),e.JRh(e.bMT(41,29,"CLAIMS.DETAILS.POLICE_REPORT.NUMBER")),e.R7$(3),e.JRh(t.claim.incident.policeReportNumber),e.R7$(3),e.JRh(e.bMT(47,31,"CLAIMS.DETAILS.POLICE_REPORT.CITY")),e.R7$(3),e.JRh(t.claim.incident.policeReportCity),e.R7$(3),e.JRh(e.bMT(53,33,"CLAIMS.DETAILS.POLICE_REPORT.DESCRIPTION")),e.R7$(3),e.SpI("",t.claim.incident.policeReportDescription," ")}}function pi(a,n){if(1&a&&(e.j41(0,"div",80)(1,"div",106)(2,"div",107)(3,"p",91),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",108),e.EFF(7),e.k0s()(),e.j41(8,"div",82)(9,"p",83),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",85),e.EFF(13),e.k0s()(),e.j41(14,"div",82)(15,"p",83),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"p",85),e.EFF(19),e.k0s()()()()),2&a){const t=e.XpG(2);e.R7$(4),e.JRh(e.bMT(5,6,"CLAIMS.DETAILS.WORKSHOP.ASSIGNED")),e.R7$(3),e.JRh(t.claim.workshop.name),e.R7$(3),e.SpI(" ",e.bMT(11,8,"CLAIMS.DETAILS.WORKSHOP.ADDRESS"),""),e.R7$(3),e.SpI("",t.claim.workshop.address," "),e.R7$(3),e.SpI(" ",e.bMT(17,10,"CLAIMS.DETAILS.WORKSHOP.CONTACT"),""),e.R7$(3),e.JRh(t.claim.workshop.phone)}}function ui(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",34)(1,"div",35)(2,"details",36)(3,"summary",37)(4,"div",38)(5,"div",39),e.nrm(6,"i-lucide",40),e.k0s(),e.j41(7,"div")(8,"h3",41),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"p",42),e.EFF(12),e.nI1(13,"translate"),e.k0s()()(),e.nrm(14,"i-lucide",43),e.k0s(),e.j41(15,"div",44)(16,"div",45)(17,"div",46)(18,"h4",47),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"div",48)(22,"span",49),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"span",50),e.EFF(26),e.k0s()(),e.j41(27,"div",48)(28,"span",49),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"span",51),e.EFF(32),e.k0s()(),e.j41(33,"div",52)(34,"div",53),e.nrm(35,"div",54),e.k0s()()(),e.j41(36,"div",55)(37,"h4",47),e.EFF(38),e.nI1(39,"translate"),e.k0s(),e.j41(40,"div",56)(41,"span",57),e.EFF(42),e.nI1(43,"translate"),e.k0s(),e.j41(44,"span",58),e.EFF(45),e.nI1(46,"number"),e.k0s()(),e.j41(47,"div",56)(48,"span",57),e.EFF(49),e.nI1(50,"translate"),e.k0s(),e.j41(51,"span",59),e.EFF(52),e.nI1(53,"number"),e.k0s()(),e.j41(54,"div",56)(55,"span",57),e.EFF(56),e.nI1(57,"translate"),e.k0s(),e.j41(58,"span",58),e.EFF(59),e.k0s()()(),e.j41(60,"div",55)(61,"h4",47),e.EFF(62),e.nI1(63,"translate"),e.k0s(),e.j41(64,"div",56)(65,"span",57),e.EFF(66),e.nI1(67,"translate"),e.k0s(),e.j41(68,"span",58),e.EFF(69),e.k0s()(),e.j41(70,"div",56)(71,"span",57),e.EFF(72),e.nI1(73,"translate"),e.k0s(),e.j41(74,"span",60),e.EFF(75),e.k0s()(),e.j41(76,"div",56)(77,"span",57),e.EFF(78),e.nI1(79,"translate"),e.k0s(),e.j41(80,"span",58),e.EFF(81),e.k0s()()(),e.j41(82,"div",55)(83,"h4",47),e.EFF(84),e.nI1(85,"translate"),e.k0s(),e.j41(86,"div",56)(87,"span",57),e.EFF(88),e.nI1(89,"translate"),e.k0s(),e.j41(90,"span",58),e.EFF(91),e.k0s()(),e.j41(92,"div",56)(93,"span",57),e.EFF(94),e.nI1(95,"translate"),e.k0s(),e.j41(96,"span",58),e.EFF(97),e.k0s()(),e.j41(98,"div",56)(99,"span",57),e.EFF(100),e.nI1(101,"translate"),e.k0s(),e.j41(102,"span",58),e.EFF(103),e.k0s()()()()()()(),e.DNE(104,ii,6,3,"div",61),e.j41(105,"div",62)(106,"div",63)(107,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isClaimantExpanded=!r.isClaimantExpanded)}),e.j41(108,"h3",65),e.nrm(109,"i-lucide",66),e.EFF(110),e.nI1(111,"translate"),e.k0s(),e.nrm(112,"i-lucide",67),e.k0s(),e.DNE(113,ai,26,17,"div",68),e.k0s(),e.DNE(114,ni,8,7,"div",69),e.j41(115,"div",63)(116,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isPolicyExpanded=!r.isPolicyExpanded)}),e.j41(117,"h3",65),e.nrm(118,"i-lucide",70),e.EFF(119),e.nI1(120,"translate"),e.k0s(),e.nrm(121,"i-lucide",67),e.k0s(),e.DNE(122,si,38,27,"div",68),e.k0s(),e.j41(123,"div",63)(124,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isDriverExpanded=!r.isDriverExpanded)}),e.j41(125,"h3",65),e.nrm(126,"i-lucide",66),e.EFF(127),e.nI1(128,"translate"),e.k0s(),e.nrm(129,"i-lucide",67),e.k0s(),e.DNE(130,li,26,17,"div",68),e.k0s()(),e.j41(131,"div",63)(132,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isVehicleExpanded=!r.isVehicleExpanded)}),e.j41(133,"h3",65),e.nrm(134,"i-lucide",71),e.EFF(135),e.nI1(136,"translate"),e.k0s(),e.nrm(137,"i-lucide",67),e.k0s(),e.DNE(138,di,44,30,"div",68),e.k0s(),e.j41(139,"div",72)(140,"div",73)(141,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isIncidentExpanded=!r.isIncidentExpanded)}),e.j41(142,"h3",65),e.nrm(143,"i-lucide",74),e.EFF(144),e.nI1(145,"translate"),e.k0s(),e.nrm(146,"i-lucide",67),e.k0s(),e.DNE(147,ci,56,35,"div",68),e.k0s(),e.j41(148,"div",63)(149,"div",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.isWorkshopExpanded=!r.isWorkshopExpanded)}),e.j41(150,"h3",65),e.nrm(151,"i-lucide",75),e.EFF(152),e.nI1(153,"translate"),e.k0s(),e.nrm(154,"i-lucide",67),e.k0s(),e.DNE(155,pi,20,12,"div",68),e.k0s()(),e.nrm(156,"app-chat-box",76),e.k0s()}if(2&a){const t=e.XpG();e.R7$(2),e.Y8G("open",!0),e.R7$(7),e.JRh(e.bMT(10,54,"CLAIMS.DETAILS.HIGHLIGHTS.TITLE")),e.R7$(3),e.JRh(e.bMT(13,56,"CLAIMS.DETAILS.HIGHLIGHTS.DESC")),e.R7$(7),e.SpI("",e.bMT(20,58,"CLAIMS.DETAILS.HIGHLIGHTS.STATUS_PAYMENT")," "),e.R7$(4),e.JRh(e.bMT(24,60,"CLAIMS.DETAILS.HIGHLIGHTS.CURRENT_STATE")),e.R7$(2),e.Y8G("ngClass",t.getStatusClass(t.claim.state)),e.R7$(),e.SpI(" ",t.claim.state," "),e.R7$(3),e.JRh(e.bMT(30,62,"CLAIMS.DETAILS.HIGHLIGHTS.PAID_ON")),e.R7$(3),e.JRh(t.claim.paidOn),e.R7$(6),e.JRh(e.bMT(39,64,"CLAIMS.DETAILS.HIGHLIGHTS.FINANCIALS")),e.R7$(4),e.JRh(e.bMT(43,66,"CLAIMS.DETAILS.HIGHLIGHTS.SUM_INSURED")),e.R7$(3),e.Lme("",t.claim.policy.currency," ",e.bMT(46,68,t.claim.policy.sumInsured),""),e.R7$(4),e.JRh(e.bMT(50,70,"CLAIMS.DETAILS.HIGHLIGHTS.ESTIMATED_COST")),e.R7$(3),e.Lme("",t.claim.policy.currency," ",e.bMT(53,72,t.claim.incident.estimatedCost),""),e.R7$(4),e.JRh(e.bMT(57,74,"CLAIMS.DETAILS.HIGHLIGHTS.CALCULATION_TYPE")),e.R7$(3),e.JRh(t.claim.calculationType),e.R7$(3),e.SpI("",e.bMT(63,76,"CLAIMS.DETAILS.HIGHLIGHTS.IMPORTANT_DATES")," "),e.R7$(4),e.JRh(e.bMT(67,78,"CLAIMS.DETAILS.HIGHLIGHTS.INTIMATED")),e.R7$(3),e.JRh(t.claim.claimDate),e.R7$(3),e.JRh(e.bMT(73,80,"CLAIMS.DETAILS.HIGHLIGHTS.LOSS_DATE")),e.R7$(3),e.JRh(t.claim.lossDate),e.R7$(3),e.JRh(e.bMT(79,82,"CLAIMS.DETAILS.HIGHLIGHTS.SURVEY_REQUESTED")),e.R7$(3),e.JRh(t.claim.incident.surveyDate),e.R7$(3),e.JRh(e.bMT(85,84,"CLAIMS.DETAILS.HIGHLIGHTS.CLAIM_INFO")),e.R7$(4),e.JRh(e.bMT(89,86,"CLAIMS.DETAILS.HIGHLIGHTS.SOURCE")),e.R7$(3),e.JRh(t.claim.source),e.R7$(3),e.JRh(e.bMT(95,88,"CLAIMS.DETAILS.HIGHLIGHTS.RECEIVED_INV")),e.R7$(3),e.JRh(t.claim.invoiceDate),e.R7$(3),e.JRh(e.bMT(101,90,"CLAIMS.DETAILS.HIGHLIGHTS.INTIMATION_MODE")),e.R7$(3),e.JRh(t.claim.intimationMode),e.R7$(),e.Y8G("ngIf",t.claim.withoutObligation),e.R7$(6),e.SpI(" ",e.bMT(111,92,"CLAIMS.DETAILS.CLAIMANT.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(104,S,t.isClaimantExpanded)),e.R7$(),e.Y8G("ngIf",t.isClaimantExpanded),e.R7$(),e.Y8G("ngIf",!t.claim.intimator.isInsured),e.R7$(5),e.SpI(" ",e.bMT(120,94,"CLAIMS.DETAILS.POLICY.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(106,S,t.isPolicyExpanded)),e.R7$(),e.Y8G("ngIf",t.isPolicyExpanded),e.R7$(5),e.SpI(" ",e.bMT(128,96,"CLAIMS.DETAILS.DRIVER.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(108,S,t.isDriverExpanded)),e.R7$(),e.Y8G("ngIf",t.isDriverExpanded),e.R7$(5),e.SpI(" ",e.bMT(136,98,"CLAIMS.DETAILS.VEHICLE.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(110,S,t.isVehicleExpanded)),e.R7$(),e.Y8G("ngIf",t.isVehicleExpanded),e.R7$(6),e.SpI(" ",e.bMT(145,100,"CLAIMS.DETAILS.INCIDENT_REPORT.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(112,S,t.isIncidentExpanded)),e.R7$(),e.Y8G("ngIf",t.isIncidentExpanded),e.R7$(5),e.SpI(" ",e.bMT(153,102,"CLAIMS.DETAILS.WORKSHOP.TITLE")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(114,S,t.isWorkshopExpanded)),e.R7$(),e.Y8G("ngIf",t.isWorkshopExpanded),e.R7$(),e.Y8G("modelName","insurance.claim")("recordId",t.claim.id)}}function mi(a,n){if(1&a&&(e.j41(0,"div",115)(1,"div",116),e.nrm(2,"i-lucide",117),e.k0s(),e.j41(3,"div",118)(4,"p",119),e.EFF(5),e.k0s(),e.j41(6,"p",91),e.EFF(7),e.nI1(8,"translate"),e.nI1(9,"date"),e.k0s()(),e.j41(10,"button",120),e.nrm(11,"i-lucide",121),e.k0s()()),2&a){const t=n.$implicit;e.R7$(4),e.FS9("title",t.name),e.R7$(),e.SpI(" ",t.name,""),e.R7$(2),e.Lme("",e.bMT(8,4,"CLAIMS.DETAILS.ATTACHED_DOCUMENTS.LAST_UPDATED"),": ",e.bMT(9,6,t.lastUpdated),"")}}function gi(a,n){if(1&a&&(e.j41(0,"div",109)(1,"div",110)(2,"h3",111),e.nrm(3,"i-lucide",112),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"div",113),e.DNE(7,mi,12,8,"div",114),e.k0s()()()),2&a){const t=e.XpG();e.R7$(4),e.Lme(" ",e.bMT(5,3,"CLAIMS.DETAILS.ATTACHED_DOCUMENTS.TITLE")," (",t.claim.documents.length,") "),e.R7$(3),e.Y8G("ngForOf",t.claim.documents)}}function _i(a,n){1&a&&(e.j41(0,"div",122),e.nrm(1,"app-loading-spinner",123),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.Y8G("loading",!0)("message",e.bMT(2,2,"CLAIMS.DETAILS.LOADING")))}function hi(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",122)(1,"div",124),e.nrm(2,"i-lucide",125),e.j41(3,"h2",126),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",127),e.EFF(7),e.k0s(),e.j41(8,"app-button",128),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.nrm(9,"i-lucide",129),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,3,"CLAIMS.DETAILS.ERROR")),e.R7$(3),e.JRh(t.error),e.R7$(3),e.SpI(" ",e.bMT(11,5,"CLAIMS.DETAILS.BACK_TO_CLAIMS")," ")}}let fi=(()=>{class a{constructor(t,i,r,o,s){this.route=t,this.router=i,this.claimService=r,this.authService=o,this.notificationService=s,this.claimId=null,this.claim=null,this.loading=!0,this.error=null,this.status="under_assessment",this.activeTab="overview",this.isClaimantExpanded=!1,this.isIntimatorExpanded=!1,this.isPolicyExpanded=!1,this.isDriverExpanded=!1,this.isVehicleExpanded=!1,this.isIncidentExpanded=!1,this.isWorkshopExpanded=!1}ngOnInit(){this.claimId=this.route.snapshot.paramMap.get("id"),this.loadClaimDetails()}setActiveTab(t){this.activeTab=t}loadClaimDetails(){if(!this.claimId)return;this.loading=!0;const t=parseInt(this.claimId,10);if(isNaN(t))return this.error="Invalid Claim ID",void(this.loading=!1);this.claimService.getClaim(t).subscribe({next:i=>{console.log("Claim details response:",i);const r=i.result||i.data||i;r?this.mapClaimData(r):this.error="No claim data found",this.loading=!1},error:i=>{console.error("Error fetching claim details:",i),this.error="Failed to load claim details",this.notificationService.error("Failed to load claim details"),this.loading=!1}})}mapClaimData(t){this.claim={id:t.id||this.claimId,claimNumber:t.claim_number||"N/A",claimType:t.product_name||"Motor Insurance",claimDate:t.intimation_date||"N/A",receivedDate:t.received_date||"N/A",deliveredDate:t.delivered_date||"N/A",reportedDate:t.intimation_date||"N/A",lossDate:t.date_of_loss||"N/A",status:(t.state||"draft").toLowerCase().replace(/\s+/g,"_"),state:t.state||"Intimated",priority:t.severity&&"high"===t.severity.toLowerCase()?"high":"medium",paidOn:t.claim_paid_on||"Not Paid",source:t.claim_source||"N/A",intimationMode:t.intimation_mode||"N/A",calculationType:t.calculation_type||"N/A",withoutObligation:t.without_obligation||!1,invoiceDate:t.received_invoice_date||"N/A",intimator:{isInsured:t.intimator_is_insured,name:t.intimator_name||"N/A",phone:t.intimator_phone||"N/A",address:t.intimator_address||"N/A",relation:t.relative||"N/A"},claimant:{name:t.customer_name||"N/A",code:t.customer_code||"N/A",phone:t.customer_mobile||"N/A",email:"N/A",beneficiary:t.beneficiary_name||"N/A"},policy:{id:t.policy_number||"N/A",applicationNumber:t.application_number||"N/A",type:t.product_name||"Motor Insurance",productCode:t.product_code||"N/A",lob:t.lob||"N/A",transactionType:t.policy_transaction_type||"N/A",status:t.policy_payment_status||"Active",effectiveFrom:t.policy_effective_from||"N/A",effectiveTo:t.policy_effective_to||"N/A",approveDate:t.policy_approve_date||"N/A",paymentDate:t.policy_payment_date||"N/A",sumInsured:t.risk_sum_insured||0,currency:t.currency||"EGP",brokerName:t.broker_name||"Direct",brokerCode:t.broker_code||"N/A",branch:t.branch||"Head Office",paymentStatus:t.policy_payment_status||"N/A",sourceOfBusiness:t.source_of_business||"broker"},vehicle:{plateNumber:t.vehicle_plate_number||"N/A",chassisNumber:t.vehicle_chassis_number||"N/A",motorNumber:t.vehicle_motor_number||"N/A",make:t.vehicle_make||"N/A",model:t.vehicle_model||"N/A",category:t.vehicle_category||"N/A",cc:t.vehicle_cc||"N/A",year:t.vehicle_manufacturing_year||"N/A",marketValue:t.vehicle_market_value||"N/A",bodyType:t.vehicle_body_type||"N/A",licenceStart:t.vehicle_licence_start_date||"N/A",licenceExpiry:t.vehicle_licence_expiration_date||"N/A"},incident:{date:t.date_of_loss||"N/A",location:t.accident_address||[t.accident_city,t.accident_governorate].filter(Boolean).join(", ")||"N/A",city:t.accident_city||"N/A",governorate:t.accident_governorate||"N/A",description:t.accident_description||t.initial_damage_description||"N/A",initialDamage:t.initial_damage_description||"N/A",causeOfLoss:t.cause_of_loss||"N/A",natureOfLoss:t.nature_of_loss||"N/A",severity:t.severity||"Normal",surveyDate:t.requested_survey_date||"N/A",estimatedCost:0,policeReportNumber:t.police_report_number||"N/A",policeReportCity:t.police_report_city||"N/A",policeReportDescription:t.police_report_description||"N/A"},driver:{name:t.driver_name||"N/A",birthDate:t.driver_birth_date||"N/A",gender:t.driver_gender||"N/A",licenceType:t.driver_licence_type||"N/A",licenceStart:t.driver_licence_start_date||"N/A",licenceExpiry:t.driver_licence_expiration_date||"N/A"},workshop:{name:t.workshop||"N/A",address:t.workshop_address||"N/A",phone:t.workshop_number||"N/A"},documents:(t.claim_documents||[]).map(i=>({id:i.id,name:i.document_name,type:"Document",size:"N/A",lastUpdated:i.last_updated_on,updatedBy:i.last_updated_by,hasFiles:i.documents_base64&&i.documents_base64.length>0})),timeline:[{event:"Claim Intimated",date:t.intimation_date||"N/A",status:"completed",icon:"file-text"},{event:"Under Assessment",date:"Pending",status:"current",icon:"clock"},{event:"Decision Made",date:"-",status:"pending",icon:"check-circle"}]},this.status=this.claim.status}getStatusClass(t){const i=t?.toLowerCase()||"";return i.includes("paid")||i.includes("approved")||i.includes("settled")?"bg-green-100 text-green-800":i.includes("reject")||i.includes("declined")?"bg-red-100 text-red-800":i.includes("new")||i.includes("intimated")?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}goBack(){this.router.navigate(["/dashboard/broker/claims"])}isBroker(){const t=this.authService.currentUserValue;return"broker"===t?.role||"admin"===t?.role}approveClaim(){this.claimId&&(this.loading=!0,setTimeout(()=>{this.notificationService.success("Claim approved successfully!"),this.loadClaimDetails(),this.loading=!1},1e3))}rejectClaim(){this.claimId&&(this.loading=!0,setTimeout(()=>{this.notificationService.error("Claim rejected."),this.loadClaimDetails(),this.loading=!1},1e3))}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU($.q),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-claim-details"]],decls:19,vars:16,consts:[["class","space-y-6",4,"ngIf"],[1,"border-b","border-gray-200","mb-6","animate-fadeIn",2,"animation-delay","100ms"],[1,"flex","gap-8","overflow-x-auto"],[1,"pb-4","px-2","text-sm","font-medium","capitalize","transition-all","relative","whitespace-nowrap","flex","items-center","gap-2",3,"click","ngClass"],["name","file-text",1,"w-4","h-4"],["class","absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-500 to-blue-600 rounded-t-full animate-slideIn",4,"ngIf"],["name","paperclip",1,"w-4","h-4"],[1,"space-y-8"],["class","space-y-6 animate-fadeIn",4,"ngIf"],["class","animate-fadeIn",4,"ngIf"],["class","flex items-center justify-center h-96",4,"ngIf"],[1,"space-y-6"],[1,"mb-8","animate-fadeIn","relative","overflow-hidden","rounded-2xl","p-4","-m-4"],[1,"absolute","inset-0","pointer-events-none","z-0",2,"background-image","url('assets/img/backgrounds/claim-header.svg')","background-repeat","no-repeat","background-position","center","background-size","cover"],[1,"relative","z-10"],[1,"flex","items-center","gap-2","text-sm","text-gray-200","mb-4"],[1,"hover:text-white","transition-all","duration-300",3,"click"],["name","chevron-right",1,"w-4","h-4"],[1,"text-white","font-medium"],[1,"flex","flex-col","lg:flex-row","lg:items-center","justify-between","gap-4"],[1,"flex","items-start","gap-4"],[1,"w-14","h-14","bg-white/10","backdrop-blur-sm","rounded-xl","flex","items-center","justify-center","text-white","shadow-lg","border","border-white/20"],["name","alert-triangle",1,"w-7","h-7"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-lg","text-gray-200","font-medium","mb-2"],[1,"flex","flex-wrap","items-center","gap-3","text-sm","text-gray-200"],[1,"flex","items-center","gap-1","bg-white/20","px-2","py-0.5","rounded","text-xs","font-semibold","uppercase","text-white"],[1,"flex","items-center","gap-1"],["name","calendar",1,"w-3.5","h-3.5"],["name","shield",1,"w-3.5","h-3.5"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"px-4","py-2","rounded-full","text-sm","font-semibold","capitalize","flex","items-center","gap-2","animate-slideIn",3,"ngClass"],["name","info",1,"w-4","h-4"],[1,"absolute","bottom-0","left-0","right-0","h-0.5","bg-gradient-to-r","from-blue-500","to-blue-600","rounded-t-full","animate-slideIn"],[1,"space-y-6","animate-fadeIn"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","overflow-hidden"],[1,"group",3,"open"],[1,"flex","items-center","justify-between","p-6","cursor-pointer","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","bg-indigo-100","dark:bg-indigo-900/30","rounded-lg","flex","items-center","justify-center","text-indigo-600"],["name","info",1,"w-5","h-5"],[1,"font-bold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500"],["name","chevron-down",1,"w-5","h-5","text-gray-400","transition-transform","group-open:rotate-180"],[1,"px-6","pb-6","pt-0","border-t","border-gray-100","dark:border-gray-700"],[1,"mt-6","grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"space-y-4","p-4","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],[1,"font-bold","text-sm","text-gray-900","dark:text-white","mb-2"],[1,"flex","items-center","justify-between"],[1,"text-gray-600","dark:text-gray-300","text-xs"],[1,"px-2","py-0.5","rounded-full","text-xs","font-semibold",3,"ngClass"],[1,"font-medium","text-xs"],[1,"relative","pt-1"],[1,"overflow-hidden","h-1.5","mb-1","text-xs","flex","rounded","bg-blue-200"],[1,"shadow-none","flex","flex-col","text-center","whitespace-nowrap","text-white","justify-center","bg-primary",2,"width","30%"],[1,"space-y-3","p-4","bg-gray-50","dark:bg-gray-700/30","rounded-lg"],[1,"flex","justify-between","text-xs"],[1,"text-gray-600","dark:text-gray-300"],[1,"font-medium"],[1,"font-medium","text-red-600"],[1,"font-medium","text-primary"],["class","bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg flex items-center gap-3",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","group","overflow-hidden"],[1,"p-6","cursor-pointer","flex","items-center","justify-between","hover:bg-gray-50","dark:hover:bg-gray-700/50","transition-colors",3,"click"],[1,"font-bold","text-gray-900","dark:text-white","flex","items-center","gap-2"],["name","user",1,"w-5","h-5","text-primary"],["name","chevron-down",1,"w-5","h-5","text-gray-400","transition-transform","duration-200",3,"ngClass"],["class","p-6 pt-0 border-t border-gray-100 dark:border-gray-700 animate-fadeIn",4,"ngIf"],["class","bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-all duration-300 group overflow-hidden",4,"ngIf"],["name","shield",1,"w-5","h-5","text-primary"],["name","car",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","group","overflow-hidden"],["name","alert-circle",1,"w-5","h-5","text-primary"],["name","tool",1,"w-5","h-5","text-primary"],[3,"modelName","recordId"],[1,"bg-yellow-50","dark:bg-yellow-900/20","p-4","rounded-lg","flex","items-center","gap-3"],["name","alert-circle",1,"w-5","h-5","text-yellow-600"],[1,"font-semibold","text-yellow-800","dark:text-yellow-200"],[1,"p-6","pt-0","border-t","border-gray-100","dark:border-gray-700","animate-fadeIn"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","text-sm","pt-6"],[1,"space-y-1"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider"],[1,"font-medium","text-gray-900","dark:text-white","truncate",3,"title"],[1,"font-medium","text-gray-900","dark:text-white"],["name","user-check",1,"w-5","h-5","text-primary"],[1,"font-medium","text-gray-900","dark:text-white","truncate"],[1,"px-2","py-0.5","rounded-full","text-xs","font-semibold","bg-green-100","text-green-800"],[1,"font-medium","text-gray-900","dark:text-white","capitalize"],[1,"grid","grid-cols-2","md:grid-cols-3","xl:grid-cols-5","gap-6","text-sm","pt-6"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"font-semibold","text-gray-900","dark:text-white"],[1,"font-bold","text-gray-900","dark:text-white","bg-gray-50","px-2","py-0.5","rounded","inline-block","border","border-gray-200"],[1,"font-mono","text-xs","font-medium","text-gray-900","dark:text-white"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-4","pt-6"],[1,"space-y-3","p-4","bg-gray-50","dark:bg-gray-700/50","rounded-lg"],[1,"flex","justify-between"],[1,"text-xs","text-gray-500"],[1,"text-sm","font-medium","text-navy","dark:text-white"],[1,"text-xs","text-gray-500","dark:text-gray-400","mb-2"],[1,"p-3","bg-amber-50","dark:bg-amber-900/30","border","border-amber-100","dark:border-amber-700","rounded-lg","text-sm","text-gray-700","dark:text-gray-300","leading-relaxed","min-h-[100px]"],[1,"md:col-span-2","mt-4","border-t","border-gray-100","pt-4"],[1,"font-semibold","text-sm","text-navy","dark:text-white","mb-2"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","text-sm"],[1,"font-medium","truncate"],[1,"space-y-4","text-sm","pt-6"],[1,"p-3","bg-blue-50","dark:bg-blue-900/20","rounded-lg","border","border-blue-100","dark:border-blue-800"],[1,"font-bold","text-navy","dark:text-white","text-lg"],[1,"animate-fadeIn"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"font-bold","text-navy","dark:text-white","mb-4","flex","items-center","gap-2"],["name","paperclip",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],["class","flex items-center gap-3 p-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 cursor-pointer group",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-3","p-4","border","border-gray-200","rounded-lg","bg-gray-50","dark:bg-gray-700/50","hover:bg-gray-100","dark:hover:bg-gray-700","transition-all","duration-300","cursor-pointer","group"],[1,"w-12","h-12","bg-blue-50","dark:bg-blue-900/30","rounded-lg","flex","items-center","justify-center","text-primary","group-hover:bg-primary","group-hover:text-white","transition-all","duration-300"],["name","file-text",1,"w-6","h-6"],[1,"flex-1","min-w-0"],[1,"text-sm","font-semibold","text-navy","dark:text-white","truncate",3,"title"],[1,"p-2","hover:bg-white","rounded-full","transition-colors"],["name","download",1,"w-4","h-4","text-gray-400","group-hover:text-primary"],[1,"flex","items-center","justify-center","h-96"],[3,"loading","message"],[1,"text-center"],["name","alert-circle",1,"h-12","w-12","text-red-500","mx-auto","mb-4"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300","mb-4"],[3,"click"],["name","chevron-left",1,"w-4","h-4","mr-2"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout"),e.DNE(1,ei,34,14,"div",0),e.j41(2,"div",1)(3,"nav",2)(4,"button",3),e.bIt("click",function(){return r.setActiveTab("overview")}),e.nrm(5,"i-lucide",4),e.EFF(6),e.nI1(7,"translate"),e.DNE(8,ti,1,0,"div",5),e.k0s(),e.j41(9,"button",3),e.bIt("click",function(){return r.setActiveTab("documents")}),e.nrm(10,"i-lucide",6),e.EFF(11),e.nI1(12,"translate"),e.DNE(13,ri,1,0,"div",5),e.k0s()()(),e.j41(14,"div",7),e.DNE(15,ui,157,116,"div",8)(16,gi,8,5,"div",9),e.k0s(),e.DNE(17,_i,3,4,"div",10)(18,hi,12,7,"div",10),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",!r.loading&&r.claim),e.R7$(3),e.Y8G("ngClass","overview"===r.activeTab?"text-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700"),e.R7$(2),e.SpI(" ",e.bMT(7,12,"CLAIMS.DETAILS.OVERVIEW")," "),e.R7$(2),e.Y8G("ngIf","overview"===r.activeTab),e.R7$(),e.Y8G("ngClass","documents"===r.activeTab?"text-primary":"text-gray-500 dark:text-gray-400 hover:text-gray-700"),e.R7$(2),e.Lme(" ",e.bMT(12,14,"CLAIMS.DETAILS.DOCUMENTS")," (",r.claim.documents.length,") "),e.R7$(2),e.Y8G("ngIf","documents"===r.activeTab),e.R7$(2),e.Y8G("ngIf","overview"===r.activeTab),e.R7$(),e.Y8G("ngIf","documents"===r.activeTab),e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",r.error&&!r.loading))},dependencies:[m.YU,m.Sq,m.bT,v.w,N.Q,k.N,c.WGl,B.f,m.QX,m.vh,x.D9],encapsulation:2})}}return a})();var bi=_(1979);function yi(a,n){if(1&a&&(e.j41(0,"div",15),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function vi(a,n){1&a&&(e.j41(0,"div",16),e.nrm(1,"app-loading-spinner"),e.k0s())}function xi(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",17),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.columns)("showExport",!0)("maxSelectOptions",10)}}function ki(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",18),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}let Ci=(()=>{class a{constructor(t,i,r,o){this.appTranslate=t,this.brokerService=i,this.authService=r,this.notificationService=o,this.columns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.currentPage=1,this.pageSize=25,this.totalRecords=0,this.paymentStatus="paid",this.setupColumns()}ngOnInit(){this.loadPremiums()}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}setupColumns(){this.columns=[{key:"id",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.PAYMENT_ID"),filterable:!0,filterType:"text"},{key:"policyNumber",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.POLICY_NO"),filterable:!0,filterType:"text"},{key:"partnerName",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.CLIENT_NAME"),filterable:!0,filterType:"text"},{key:"productName",label:"Product",filterable:!0},{key:"premiumAmount",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.AMOUNT"),filterable:!1,render:t=>`<span class="font-medium text-gray-900 dark:text-gray-100">$${t.premiumAmount?t.premiumAmount.toLocaleString():"0"}</span>`},{key:"paymentStatus",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t.paymentStatus)},{key:"date",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.DATE"),filterable:!0,filterType:"date"},{key:"actions",label:this.appTranslate.instant("BROKER.PAYMENTS.COLUMNS.ACTIONS"),filterable:!1,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}]}renderStatus(t){const i=t?.toLowerCase()||"outstanding";let r="";return r=["completed","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","outstanding"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}loadPremiums(){this.isLoading=!0,this.error=null;const t=this.authService.currentUserValue;if(!t||!t.id)return this.error="ERROR.USER_NOT_FOUND",this.isLoading=!1,void this.notificationService.error(this.appTranslate.instant("ERROR.USER_NOT_FOUND"));const i=t.id,r=(this.currentPage-1)*this.pageSize;this.brokerService.getPremiums(i,this.paymentStatus).subscribe({next:o=>{o.result?.data?(this.totalRecords=o.result.data.length,this.brokerService.getPremiums(i,this.paymentStatus,this.pageSize,r).subscribe({next:s=>{this.data=s.result?.data?this.mapPremiumData(s.result.data):[],this.isLoading=!1},error:s=>{this.handleError(s)}})):(this.data=[],this.totalRecords=0,this.isLoading=!1)},error:o=>{this.handleError(o)}})}mapPremiumData(t){return t.map(i=>({id:i.id||"",policyNumber:i.policy_number||"N/A",partnerName:i.partner_name||"N/A",productName:i.product_name||"N/A",premiumAmount:i.premium_amount||0,paymentStatus:i.payment_status||"outstanding",date:i.date||i.create_date||"N/A"}))}handleError(t){console.error("Error loading premiums:",t);const i=t?.error?.error?.message||t?.message||"";if(i.includes("No premiums found")||i.includes("No payment"))return this.data=[],this.totalRecords=0,void(this.isLoading=!1);this.error="ERROR.LOADING_DATA",this.isLoading=!1,this.notificationService.error(this.appTranslate.instant("ERROR.LOADING_DATA"),i||this.appTranslate.instant("ERROR.GENERIC"))}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){console.log("Action",t.action,t.data)}onExport(){console.log("Exporting premiums...")}onPageChange(t){this.currentPage=t,this.loadPremiums()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadPremiums()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(I.F),e.rXU(W.d),e.rXU(y.u),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-premiums"]],decls:22,vars:13,consts:[[1,"space-y-6"],[1,"bg-cyan-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-cyan-500","to-cyan-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","credit-card",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],["variant","primary"],["data-lucide","download",1,"w-4","h-4","mr-2"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"p",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()(),e.j41(13,"app-button",8),e.nrm(14,"i",9),e.EFF(15),e.nI1(16,"translate"),e.k0s()()(),e.j41(17,"div",10),e.DNE(18,yi,3,3,"div",11)(19,vi,2,0,"div",12)(20,xi,1,4,"app-dynamic-table-with-filters",13)(21,ki,1,3,"app-pagination",14),e.k0s()()()),2&i&&(e.R7$(8),e.JRh(e.bMT(9,7,"BROKER.PAYMENTS.TITLE")),e.R7$(3),e.JRh(e.bMT(12,9,"BROKER.PAYMENTS.SUBTITLE")),e.R7$(4),e.SpI(" ",e.bMT(16,11,"BROKER.PAYMENTS.DOWNLOAD_REPORT")," "),e.R7$(3),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0))},dependencies:[m.bT,v.w,N.Q,k.N,T.u,F.e,x.D9],encapsulation:2})}}return a})();var Ri=_(1855),Ii=_(2780);function Ti(a){return{opportunityNumber:a.opportunity_number||"N/A",date:Oi(a.opportunity_date),stage:R(a.stage)||"N/A",product:a.product_name||"N/A"}}function Fi(a){return{name:R(a.name)||"N/A",email:a.email||"N/A",phone:a.phone||"N/A"}}function Si(a){const n=a.opportunity_risks?.[0];return n?{make:R(n.vehicle_make)||"N/A",model:R(n.vehicle_model)||"N/A",year:n.vehicle_manufacturing_year||0,plateNumber:n.plate_number?.toUpperCase()||"N/A",color:R(n.vehicle_color)||"N/A",bodyType:R(n.vehicle_body_type)||"N/A",category:R(n.vehicle_category)||"N/A",usage:R(n.vehicle_usage)||"N/A",seats:n.vehicle_number_of_seats||0,condition:R(n.vehicle_state)||"N/A",sumInsured:E(n.vehicle_sum_insured),chassisNumber:n.vehicle_chassis_number?.toUpperCase()||"N/A",engineNumber:n.vehicle_engine_number?.toUpperCase()||"N/A",fuelType:R(n.vehicle_fuel_type)||"N/A"}:{make:"N/A",model:"N/A",year:0,plateNumber:"N/A",color:"N/A",bodyType:"N/A",category:"N/A",usage:"N/A",seats:0,condition:"N/A",sumInsured:"0 EGP",chassisNumber:"N/A",engineNumber:"N/A",fuelType:"N/A"}}function wi(a){const n=a.opportunity_proposal?.[0];return n?{sumInsured:E(n.proposal_sum_insured),netPremium:E(n.proposal_net_premium),fees:E(n.proposal_fees),stampDuty:E(n.proposal_stamp_duty),issueFees:E(n.proposal_issue_fees),taxAmount:E(n.proposal_tax_amount),taxPercentage:Di(n.proposal_tax_percentage),grossPremium:E(n.proposal_gross_premium)}:{sumInsured:"0 EGP",netPremium:"0 EGP",fees:"0 EGP",stampDuty:"0 EGP",issueFees:"0 EGP",taxAmount:"0 EGP",taxPercentage:"0%",grossPremium:"0 EGP"}}function ji(a){return a.opportunity_conditions&&0!==a.opportunity_conditions.length?a.opportunity_conditions.map(n=>n.condition_name).filter(n=>n&&""!==n.trim()):[]}function Ni(a){return a.opportunity_documents&&0!==a.opportunity_documents.length?a.opportunity_documents.map(n=>({name:n.document_name||"Unnamed Document",status:n.files&&n.files.length>0?"Uploaded":"Pending"})):[]}function E(a){return null==a||isNaN(a)?"0 EGP":`${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} EGP`}function Di(a){return null==a||isNaN(a)?"0%":`${a}%`}function Oi(a){if(!a)return"N/A";try{const n=new Date(a);if(isNaN(n.getTime()))return a;const t=String(n.getDate()).padStart(2,"0");return`${t}/${String(n.getMonth()+1).padStart(2,"0")}/${n.getFullYear()}`}catch{return a}}function R(a){return a?a.toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "):""}function Li(a,n){if(1&a){const t=e.RV6();e.j41(0,"button",76),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.editQuotation())}),e.nrm(1,"i-lucide",77),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"DETAILS.QUOTATION.EDIT_QUOTE")," "))}function Pi(a,n){1&a&&e.nrm(0,"i-lucide",78)}function $i(a,n){1&a&&e.nrm(0,"i-lucide",79)}function Gi(a,n){if(1&a&&(e.j41(0,"div",86)(1,"div",87)(2,"h4",88),e.EFF(3),e.k0s(),e.j41(4,"span",89),e.EFF(5),e.k0s()(),e.j41(6,"div",90)(7,"div")(8,"span",91),e.EFF(9,"Premium"),e.k0s(),e.j41(10,"span",92),e.EFF(11),e.k0s()(),e.j41(12,"div")(13,"span",91),e.EFF(14,"Net Premium"),e.k0s(),e.j41(15,"span",36),e.EFF(16),e.k0s()(),e.j41(17,"div")(18,"span",91),e.EFF(19,"Coverage"),e.k0s(),e.j41(20,"span",36),e.EFF(21),e.k0s()(),e.j41(22,"div")(23,"span",91),e.EFF(24,"Deductible"),e.k0s(),e.j41(25,"span",36),e.EFF(26),e.k0s()(),e.j41(27,"div")(28,"span",91),e.EFF(29,"Taxes"),e.k0s(),e.j41(30,"span",36),e.EFF(31),e.k0s()(),e.j41(32,"div")(33,"span",91),e.EFF(34,"Fees"),e.k0s(),e.j41(35,"span",36),e.EFF(36),e.k0s()()()()),2&a){const t=n.$implicit,i=e.XpG(4);e.R7$(3),e.JRh(t.company),e.R7$(),e.HbH(i.getProposalStateClass(t.state)),e.R7$(),e.SpI(" ",t.state||"Pending"," "),e.R7$(6),e.JRh(t.premium),e.R7$(5),e.JRh(t.netPremium),e.R7$(5),e.JRh(t.coverage),e.R7$(5),e.JRh(t.deductible),e.R7$(5),e.JRh(t.taxes),e.R7$(5),e.JRh(t.fees)}}function Bi(a,n){if(1&a&&(e.j41(0,"div",84),e.DNE(1,Gi,37,10,"div",85),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.proposals)}}function Ui(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",30)(1,"button",80),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.isProposalsCollapsed=!r.isProposalsCollapsed)}),e.j41(2,"h3",61),e.nrm(3,"i-lucide",81),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"i-lucide",82),e.k0s(),e.DNE(7,Bi,2,1,"div",83),e.k0s()}if(2&a){const t=e.XpG(2);e.R7$(4),e.Lme(" ",e.bMT(5,6,"DETAILS.QUOTATION.PROPOSALS")," (",t.proposals.length,") "),e.R7$(2),e.AVh("rotate-180",!t.isProposalsCollapsed),e.Y8G("name","chevron-down"),e.R7$(),e.Y8G("ngIf",!t.isProposalsCollapsed)}}function Yi(a,n){if(1&a&&(e.j41(0,"div",98),e.nrm(1,"i-lucide",99),e.j41(2,"span",100),e.EFF(3),e.k0s()()),2&a){const t=n.$implicit;e.R7$(3),e.JRh(t)}}function Vi(a,n){if(1&a&&(e.j41(0,"div",96),e.DNE(1,Yi,4,1,"div",97),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.displayData.conditions)}}function Xi(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",30)(1,"button",93),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.isPolicyConditionsCollapsed=!r.isPolicyConditionsCollapsed)}),e.j41(2,"h3",61),e.nrm(3,"i-lucide",94),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"i-lucide",82),e.k0s(),e.DNE(7,Vi,2,1,"div",95),e.k0s()}if(2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,5,"DETAILS.QUOTATION.CONDITIONS")," "),e.R7$(2),e.AVh("rotate-180",!t.isPolicyConditionsCollapsed),e.Y8G("name","chevron-down"),e.R7$(),e.Y8G("ngIf",!t.isPolicyConditionsCollapsed)}}function Qi(a,n){1&a&&(e.j41(0,"span",107),e.EFF(1,"Uploaded"),e.k0s())}function Ji(a,n){1&a&&(e.j41(0,"span",108),e.EFF(1,"Pending"),e.k0s())}function Hi(a,n){if(1&a&&(e.j41(0,"div",103)(1,"span",104),e.EFF(2),e.k0s(),e.DNE(3,Qi,2,0,"span",105)(4,Ji,2,0,"span",106),e.k0s()),2&a){const t=n.$implicit;e.R7$(2),e.JRh(t.name),e.R7$(),e.Y8G("ngIf","Uploaded"===t.status),e.R7$(),e.Y8G("ngIf","Pending"===t.status)}}function qi(a,n){if(1&a&&(e.j41(0,"div",96),e.DNE(1,Hi,5,3,"div",102),e.k0s()),2&a){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.displayData.documents)}}function zi(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",30)(1,"button",93),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.isRequiredDocumentsCollapsed=!r.isRequiredDocumentsCollapsed)}),e.j41(2,"h3",61),e.nrm(3,"i-lucide",101),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.nrm(6,"i-lucide",82),e.k0s(),e.DNE(7,qi,2,1,"div",95),e.k0s()}if(2&a){const t=e.XpG(2);e.R7$(4),e.E5c(" ",e.bMT(5,7,"DETAILS.QUOTATION.DOCUMENTS")," (",t.getUploadedCount()," of ",t.displayData.documents.length," uploaded) "),e.R7$(2),e.AVh("rotate-180",!t.isRequiredDocumentsCollapsed),e.Y8G("name","chevron-down"),e.R7$(),e.Y8G("ngIf",!t.isRequiredDocumentsCollapsed)}}function Ki(a,n){1&a&&(e.j41(0,"div",109),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"DETAILS.QUOTATION.NO_MESSAGES")," "))}function Wi(a,n){if(1&a&&(e.j41(0,"div",119),e.nrm(1,"i-lucide",120),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&a){const t=e.XpG().$implicit;e.R7$(3),e.JRh(t.attachment)}}function Zi(a,n){if(1&a&&(e.j41(0,"div",110)(1,"div",111),e.nrm(2,"i-lucide",112),e.k0s(),e.j41(3,"div",113)(4,"div",114)(5,"span",115),e.EFF(6),e.k0s(),e.j41(7,"span",116),e.EFF(8),e.k0s()(),e.j41(9,"p",117),e.EFF(10),e.k0s(),e.DNE(11,Wi,4,1,"div",118),e.k0s()()),2&a){const t=n.$implicit;e.R7$(6),e.JRh(t.userName),e.R7$(2),e.JRh(t.timestamp),e.R7$(2),e.JRh(t.message),e.R7$(),e.Y8G("ngIf",t.attachment)}}function ea(a,n){1&a&&e.nrm(0,"i-lucide",121)}function ta(a,n){1&a&&e.nrm(0,"i-lucide",79)}function ra(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",122),e.nrm(1,"i-lucide",123),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"button",124),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.removeFile())}),e.nrm(5,"i-lucide",125),e.k0s()()}if(2&a){const t=e.XpG(2);e.R7$(3),e.JRh(t.selectedFile.name)}}function ia(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",3)(1,"div",4),e.nrm(2,"div",5),e.j41(3,"div",6)(4,"div",7)(5,"button",8),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"i-lucide",9),e.j41(9,"span",10),e.EFF(10),e.k0s()(),e.j41(11,"div",11)(12,"div",12)(13,"div",13),e.nrm(14,"i-lucide",14),e.k0s(),e.j41(15,"div")(16,"h1",15),e.EFF(17),e.k0s(),e.j41(18,"div",16)(19,"span",17),e.nrm(20,"i-lucide",18),e.EFF(21),e.k0s(),e.j41(22,"span",17),e.nrm(23,"i-lucide",19),e.EFF(24),e.k0s(),e.j41(25,"span",17),e.nrm(26,"i-lucide",20),e.EFF(27),e.k0s()()()(),e.j41(28,"div",21)(29,"span",22),e.nrm(30,"i-lucide",23),e.EFF(31),e.k0s(),e.DNE(32,Li,4,3,"button",24),e.j41(33,"button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.downloadQuotation())}),e.DNE(34,Pi,1,0,"i-lucide",26)(35,$i,1,0,"i-lucide",27),e.EFF(36),e.nI1(37,"translate"),e.k0s()()()()(),e.j41(38,"div",28)(39,"div",29)(40,"div",30)(41,"h3",31),e.nrm(42,"i-lucide",32),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.j41(45,"div",33)(46,"div",34)(47,"p",35),e.EFF(48),e.nI1(49,"translate"),e.k0s(),e.j41(50,"p",36),e.EFF(51),e.k0s()(),e.j41(52,"div",34)(53,"p",37),e.nrm(54,"i-lucide",38),e.EFF(55),e.nI1(56,"translate"),e.k0s(),e.j41(57,"p",36),e.EFF(58),e.k0s()(),e.j41(59,"div",34)(60,"p",37),e.nrm(61,"i-lucide",39),e.EFF(62),e.nI1(63,"translate"),e.k0s(),e.j41(64,"p",36),e.EFF(65),e.k0s()()()(),e.j41(66,"div",30)(67,"h3",31),e.nrm(68,"i-lucide",40),e.EFF(69),e.nI1(70,"translate"),e.k0s(),e.j41(71,"div",41)(72,"h4",42),e.EFF(73),e.nI1(74,"translate"),e.k0s(),e.j41(75,"div",33)(76,"div",34)(77,"p",35),e.EFF(78,"Make"),e.k0s(),e.j41(79,"p",36),e.EFF(80),e.k0s()(),e.j41(81,"div",34)(82,"p",35),e.EFF(83,"Model"),e.k0s(),e.j41(84,"p",36),e.EFF(85),e.k0s()(),e.j41(86,"div",34)(87,"p",35),e.EFF(88,"Year"),e.k0s(),e.j41(89,"p",36),e.EFF(90),e.k0s()(),e.j41(91,"div",34)(92,"p",35),e.EFF(93,"Color"),e.k0s(),e.j41(94,"p",36),e.EFF(95),e.k0s()(),e.j41(96,"div",34)(97,"p",35),e.EFF(98,"Body Type"),e.k0s(),e.j41(99,"p",36),e.EFF(100),e.k0s()(),e.j41(101,"div",34)(102,"p",35),e.EFF(103,"Category"),e.k0s(),e.j41(104,"p",36),e.EFF(105),e.k0s()()()(),e.j41(106,"div",41)(107,"h4",42),e.EFF(108),e.nI1(109,"translate"),e.k0s(),e.j41(110,"div",33)(111,"div",34)(112,"p",35),e.EFF(113,"Plate Number"),e.k0s(),e.j41(114,"p",36),e.EFF(115),e.k0s()(),e.j41(116,"div",34)(117,"p",35),e.EFF(118,"Chassis Number"),e.k0s(),e.j41(119,"p",43),e.EFF(120),e.k0s()(),e.j41(121,"div",34)(122,"p",35),e.EFF(123,"Engine Number"),e.k0s(),e.j41(124,"p",43),e.EFF(125),e.k0s()()()(),e.j41(126,"div")(127,"h4",42),e.EFF(128),e.nI1(129,"translate"),e.k0s(),e.j41(130,"div",33)(131,"div",34)(132,"p",35),e.EFF(133,"Usage"),e.k0s(),e.j41(134,"p",36),e.EFF(135),e.k0s()(),e.j41(136,"div",34)(137,"p",35),e.EFF(138,"Seats"),e.k0s(),e.j41(139,"p",36),e.EFF(140),e.k0s()(),e.j41(141,"div",34)(142,"p",35),e.EFF(143,"Fuel Type"),e.k0s(),e.j41(144,"p",36),e.EFF(145),e.k0s()(),e.j41(146,"div",34)(147,"p",35),e.EFF(148,"Condition"),e.k0s(),e.j41(149,"p",36),e.EFF(150),e.k0s()(),e.j41(151,"div",34)(152,"p",35),e.EFF(153,"Sum Insured"),e.k0s(),e.j41(154,"p",44),e.EFF(155),e.k0s()()()()(),e.DNE(156,Ui,8,8,"div",45)(157,Xi,8,7,"div",45)(158,zi,8,9,"div",45),e.k0s(),e.j41(159,"div",3)(160,"div",46)(161,"h3",47),e.EFF(162),e.nI1(163,"translate"),e.k0s(),e.j41(164,"div",48)(165,"div",49)(166,"span",50),e.EFF(167),e.nI1(168,"translate"),e.k0s(),e.j41(169,"span",51),e.EFF(170),e.k0s()(),e.j41(171,"div",49)(172,"span",50),e.EFF(173),e.nI1(174,"translate"),e.k0s(),e.j41(175,"span",51),e.EFF(176),e.nI1(177,"translate"),e.k0s()(),e.j41(178,"div",49)(179,"span",50),e.EFF(180),e.nI1(181,"translate"),e.k0s(),e.j41(182,"span",52),e.EFF(183),e.k0s()()(),e.j41(184,"div",53)(185,"div",54)(186,"span",50),e.EFF(187),e.nI1(188,"translate"),e.k0s(),e.j41(189,"span",55),e.EFF(190),e.k0s()()()(),e.j41(191,"div",46)(192,"h3",31),e.nrm(193,"i-lucide",56),e.EFF(194),e.nI1(195,"translate"),e.k0s(),e.j41(196,"div",57)(197,"div",58)(198,"span",50),e.EFF(199),e.nI1(200,"translate"),e.k0s(),e.j41(201,"span",51),e.EFF(202),e.k0s()(),e.j41(203,"div",58)(204,"span",50),e.EFF(205),e.nI1(206,"translate"),e.k0s(),e.j41(207,"span",51),e.EFF(208),e.k0s()(),e.j41(209,"div",58)(210,"span",50),e.EFF(211),e.nI1(212,"translate"),e.k0s(),e.j41(213,"span",44),e.EFF(214),e.nI1(215,"translate"),e.k0s()()()(),e.j41(216,"div",59)(217,"div",60)(218,"h3",61),e.nrm(219,"i-lucide",62),e.EFF(220),e.nI1(221,"translate"),e.k0s()(),e.j41(222,"div",63),e.DNE(223,Ki,3,3,"div",64)(224,Zi,12,4,"div",65),e.k0s(),e.j41(225,"div",66)(226,"div",67)(227,"input",68,0),e.bIt("change",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFileSelected(r))}),e.k0s(),e.j41(229,"button",69),e.bIt("click",function(){e.eBV(t);const r=e.sdS(228);return e.Njj(r.click())}),e.nrm(230,"i-lucide",70),e.k0s(),e.j41(231,"input",71),e.nI1(232,"translate"),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.newMessage,r)||(o.newMessage=r),e.Njj(r)}),e.bIt("keyup.enter",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendMessage())}),e.k0s(),e.j41(233,"button",72),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendMessage())}),e.DNE(234,ea,1,0,"i-lucide",73)(235,ta,1,0,"i-lucide",27),e.j41(236,"span",74),e.EFF(237),e.nI1(238,"translate"),e.k0s()()(),e.DNE(239,ra,6,1,"div",75),e.k0s()()()()()}if(2&a){const t=e.XpG();e.R7$(6),e.JRh(e.bMT(7,66,"DETAILS.QUOTATION.BREADCRUMB")),e.R7$(4),e.JRh(t.displayData.header.opportunityNumber),e.R7$(7),e.JRh(t.displayData.header.opportunityNumber),e.R7$(4),e.SpI(" ",t.displayData.customer.name," "),e.R7$(3),e.SpI(" ",t.displayData.header.product," "),e.R7$(3),e.SpI(" ",t.displayData.header.date," "),e.R7$(4),e.SpI(" ",t.displayData.header.stage," "),e.R7$(),e.Y8G("ngIf",t.isStageNew()),e.R7$(),e.Y8G("disabled",t.downloading),e.R7$(),e.Y8G("ngIf",!t.downloading),e.R7$(),e.Y8G("ngIf",t.downloading),e.R7$(),e.SpI(" ",e.bMT(37,68,t.downloading?"DETAILS.QUOTATION.DOWNLOADING":"DETAILS.QUOTATION.DOWNLOAD_PDF")," "),e.R7$(7),e.SpI(" ",e.bMT(44,70,"DETAILS.QUOTATION.CUSTOMER_INFO")," "),e.R7$(5),e.SpI("",e.bMT(49,72,"DETAILS.QUOTATION.FULL_NAME")," "),e.R7$(3),e.JRh(t.displayData.customer.name),e.R7$(4),e.SpI(" ",e.bMT(56,74,"DETAILS.QUOTATION.EMAIL")," "),e.R7$(3),e.JRh(t.displayData.customer.email),e.R7$(4),e.SpI(" ",e.bMT(63,76,"DETAILS.QUOTATION.PHONE")," "),e.R7$(3),e.JRh(t.displayData.customer.phone),e.R7$(4),e.SpI(" ",e.bMT(70,78,"DETAILS.QUOTATION.VEHICLE_INFO")," "),e.R7$(4),e.SpI(" ",e.bMT(74,80,"DETAILS.QUOTATION.BASIC_INFO"),""),e.R7$(7),e.JRh(t.displayData.vehicle.make),e.R7$(5),e.JRh(t.displayData.vehicle.model),e.R7$(5),e.JRh(t.displayData.vehicle.year),e.R7$(5),e.JRh(t.displayData.vehicle.color),e.R7$(5),e.SpI("",t.displayData.vehicle.bodyType," "),e.R7$(5),e.SpI("",t.displayData.vehicle.category," "),e.R7$(3),e.SpI(" ",e.bMT(109,82,"DETAILS.QUOTATION.IDENTIFICATION"),""),e.R7$(7),e.SpI("",t.displayData.vehicle.plateNumber," "),e.R7$(5),e.JRh(t.displayData.vehicle.chassisNumber),e.R7$(5),e.JRh(t.displayData.vehicle.engineNumber),e.R7$(3),e.SpI(" ",e.bMT(129,84,"DETAILS.QUOTATION.SPECIFICATIONS"),""),e.R7$(7),e.JRh(t.displayData.vehicle.usage),e.R7$(5),e.JRh(t.displayData.vehicle.seats),e.R7$(5),e.SpI("",t.displayData.vehicle.fuelType," "),e.R7$(5),e.SpI("",t.displayData.vehicle.condition," "),e.R7$(5),e.JRh(t.displayData.vehicle.sumInsured),e.R7$(),e.Y8G("ngIf",t.proposals&&t.proposals.length>0),e.R7$(),e.Y8G("ngIf",t.displayData.conditions.length>0),e.R7$(),e.Y8G("ngIf",t.displayData.documents.length>0),e.R7$(4),e.SpI("",e.bMT(163,86,"DETAILS.QUOTATION.SUMMARY")," "),e.R7$(5),e.JRh(e.bMT(168,88,"DETAILS.QUOTATION.PRODUCT")),e.R7$(3),e.JRh(t.displayData.header.product),e.R7$(3),e.JRh(e.bMT(174,90,"DETAILS.QUOTATION.POLICY_TERM")),e.R7$(3),e.JRh(e.bMT(177,92,"DETAILS.QUOTATION.ONE_YEAR")),e.R7$(4),e.JRh(e.bMT(181,94,"DETAILS.QUOTATION.STATUS")),e.R7$(3),e.JRh(t.displayData.header.stage),e.R7$(4),e.JRh(e.bMT(188,96,"DETAILS.QUOTATION.TOTAL_PREMIUM")),e.R7$(3),e.JRh(t.displayData.pricing.grossPremium),e.R7$(4),e.SpI(" ",e.bMT(195,98,"DETAILS.QUOTATION.IMPORTANT_INFO")," "),e.R7$(5),e.JRh(e.bMT(200,100,"DETAILS.QUOTATION.QUOTE_NUMBER")),e.R7$(3),e.JRh(t.displayData.header.opportunityNumber),e.R7$(3),e.JRh(e.bMT(206,102,"DETAILS.QUOTATION.CREATED_DATE")),e.R7$(3),e.JRh(t.displayData.header.date),e.R7$(3),e.JRh(e.bMT(212,104,"DETAILS.QUOTATION.VALID_UNTIL")),e.R7$(3),e.JRh(e.bMT(215,106,"DETAILS.QUOTATION.DAYS_30")),e.R7$(6),e.SpI(" ",e.bMT(221,108,"DETAILS.QUOTATION.MESSAGES")," "),e.R7$(3),e.Y8G("ngIf",0===t.messages.length),e.R7$(),e.Y8G("ngForOf",t.messages),e.R7$(7),e.R50("ngModel",t.newMessage),e.Y8G("placeholder",e.bMT(232,110,"DETAILS.QUOTATION.TYPE_MESSAGE")),e.R7$(2),e.Y8G("disabled",!t.newMessage.trim()||t.sendingMessage),e.R7$(),e.Y8G("ngIf",!t.sendingMessage),e.R7$(),e.Y8G("ngIf",t.sendingMessage),e.R7$(2),e.JRh(e.bMT(238,112,"DETAILS.QUOTATION.SEND")),e.R7$(2),e.Y8G("ngIf",t.selectedFile)}}function aa(a,n){1&a&&(e.j41(0,"div",126),e.nrm(1,"app-loading-spinner",127),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.Y8G("loading",!0)("message",e.bMT(2,2,"DETAILS.QUOTATION.LOADING")))}function oa(a,n){if(1&a){const t=e.RV6();e.j41(0,"div",126)(1,"div",128),e.nrm(2,"i-lucide",129),e.j41(3,"h2",130),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",131),e.EFF(7),e.k0s(),e.j41(8,"button",132),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.loadQuotation())}),e.nrm(9,"i-lucide",133),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,3,"DETAILS.QUOTATION.ERROR_LOADING")),e.R7$(3),e.JRh(t.error),e.R7$(3),e.SpI(" ",e.bMT(11,5,"DETAILS.QUOTATION.TRY_AGAIN")," ")}}let na=(()=>{class a{constructor(t,i,r,o,s,l){this.route=t,this.router=i,this.crmService=r,this.quoteService=o,this.policyService=s,this.notificationService=l,this.quotationId="",this.quotation=null,this.proposals=[],this.loading=!0,this.error=null,this.displayData=null,this.messages=[],this.newMessage="",this.selectedFile=null,this.sendingMessage=!1,this.isPolicyConditionsCollapsed=!0,this.isRequiredDocumentsCollapsed=!0,this.isProposalsCollapsed=!1,this.downloading=!1}ngOnInit(){this.quotationId=this.route.snapshot.params.id,this.loadQuotation()}loadQuotation(){var t=this;return(0,b.A)(function*(){if(t.quotationId){t.loading=!0,t.error=null;try{const i=yield t.crmService.getQuotation(Number(t.quotationId)).toPromise();t.quotation=i?.result?.data||i?.data||i,t.quotation&&(t.displayData=function Ei(a){return{header:Ti(a),customer:Fi(a),vehicle:Si(a),pricing:wi(a),conditions:ji(a),documents:Ni(a)}}(t.quotation)),t.proposals=t.quotation&&t.quotation.opportunity_proposal?t.quotation.opportunity_proposal.map((r,o)=>({company:r.proposal_company_name||`Insurance Provider ${o+1}`,type:r.proposal_type||"Standard",premium:t.formatCurrency(r.proposal_gross_premium),netPremium:t.formatCurrency(r.proposal_net_premium),coverage:t.formatCurrency(r.proposal_sum_insured),deductible:r.proposal_deductible?t.formatCurrency(r.proposal_deductible):"N/A",taxes:t.formatCurrency(r.proposal_tax_amount),fees:t.formatCurrency(r.proposal_fees),state:r.proposal_state||r.state||"Pending"})):[]}catch(i){console.error("Failed to load quotation details",i),t.error="Failed to load quotation details. Please try again."}finally{t.loading=!1}}})()}downloadQuotation(){var t=this;return(0,b.A)(function*(){if(!t.quotation?.opportunity_proposal?.length)return void t.notificationService.warning("No proposal documents available to download.");const i=t.quotation.opportunity_proposal[0],r=i.id||i.proposal_id;if(r)try{t.downloading=!0;const o=yield t.quoteService.downloadProposalPdf(Number(r)).toPromise();if(o){const s=window.URL.createObjectURL(o),l=document.createElement("a");l.href=s,l.download=`Quotation_${t.displayData?.header?.opportunityNumber||t.quotationId}.pdf`,l.click(),window.URL.revokeObjectURL(s)}}catch(o){console.error("Error downloading quotation PDF:",o),console.error("Error Details:",{status:o.status,statusText:o.statusText,url:o.url,headers:o.headers?o.headers.keys():"N/A"}),t.notificationService.error("Failed to download quotation PDF. Please try again.")}finally{t.downloading=!1}else t.notificationService.error("Analysis failed: Proposal ID is missing.")})()}goBack(){this.router.navigate(["/dashboard/broker/quotations"])}isStageNew(){return"new"===this.displayData?.header?.stage?.toLowerCase()}editQuotation(){this.router.navigate(["/dashboard/broker/quote/new"],{queryParams:{quotationId:this.quotationId,edit:!0}})}getUploadedCount(){return this.displayData&&this.displayData.documents?this.displayData.documents.filter(t=>"Uploaded"===t.status).length:0}formatCurrency(t){return null==t||isNaN(t)?"0 EGP":`${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} EGP`}getStatusClass(t){return{draft:"bg-gray-100 text-gray-800",sent:"bg-blue-100 text-blue-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",expired:"bg-gray-100 text-gray-800"}[t?.toLowerCase()]||"bg-gray-100 text-gray-800"}getProposalStateClass(t){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800",sent:"bg-blue-100 text-blue-800",accepted:"bg-green-100 text-green-800"}[t?.toLowerCase()]||"bg-yellow-100 text-yellow-800"}onFileSelected(t){const i=t.target.files[0];i&&(this.selectedFile=i)}removeFile(){this.selectedFile=null}sendMessage(){var t=this;return(0,b.A)(function*(){if(t.newMessage.trim()&&!t.sendingMessage){t.sendingMessage=!0;try{const i=[];if(t.selectedFile){const o=yield t.fileToBase64(t.selectedFile);i.push({name:t.selectedFile.name,datas:o,mimetype:t.selectedFile.type})}const r=yield t.crmService.postChatterMessage(Number(t.quotationId),t.newMessage,i).toPromise();if(r&&(r.error||r.result&&r.result.error||!1===r.success)){let o=r.error||r.result&&r.result.error||"Failed to send message";return"string"==typeof o&&o.includes("security restrictions")&&(o="You do not have permission to perform this action."),void t.notificationService.error(o)}t.messages.push({userName:"You",timestamp:(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),message:t.newMessage,attachment:t.selectedFile?t.selectedFile.name:null}),t.newMessage="",t.selectedFile=null}finally{t.sendingMessage=!1}}})()}fileToBase64(t){return new Promise((i,r)=>{const o=new FileReader;o.readAsDataURL(t),o.onload=()=>{const s=o.result.split(",")[1];i(s)},o.onerror=s=>r(s)})}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(j.u),e.rXU(U.K),e.rXU(w.m),e.rXU(C.J))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-quotation-details"]],decls:4,vars:3,consts:[["fileInput",""],["class","space-y-6",4,"ngIf"],["class","flex items-center justify-center h-96",4,"ngIf"],[1,"space-y-6"],[1,"mb-8","animate-fadeIn","relative","overflow-hidden","rounded-2xl","p-4","-m-4"],[1,"absolute","inset-0","pointer-events-none","z-0",2,"background-image","url('assets/img/backgrounds/quotation-header.svg')","background-repeat","no-repeat","background-position","center","background-size","cover"],[1,"relative","z-10"],[1,"flex","items-center","gap-2","text-sm","text-gray-200","mb-4"],[1,"hover:text-white","transition-all","duration-300",3,"click"],["name","chevron-right",1,"w-4","h-4"],[1,"text-white","font-medium"],[1,"flex","flex-col","lg:flex-row","lg:items-center","justify-between","gap-4"],[1,"flex","items-start","gap-4"],[1,"w-14","h-14","bg-white/10","backdrop-blur-sm","rounded-xl","flex","items-center","justify-center","text-white","shadow-lg","border","border-white/20"],["name","file-text",1,"w-7","h-7"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"flex","flex-wrap","items-center","gap-3","text-sm","text-gray-200"],[1,"flex","items-center","gap-1"],["name","user",1,"w-3.5","h-3.5"],["name","shield",1,"w-3.5","h-3.5"],["name","calendar",1,"w-3.5","h-3.5"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"px-4","py-2","bg-blue-100","text-blue-800","rounded-full","text-sm","font-semibold","capitalize","flex","items-center","gap-2","animate-slideIn"],["name","check-circle",1,"w-4","h-4"],["class","px-4 py-2 bg-primary text-white rounded-lg flex items-center gap-2 hover:bg-primary/90 transition-colors",3,"click",4,"ngIf"],[1,"px-4","py-2","border","border-gray-300","rounded-lg","flex","items-center","gap-2","hover:bg-gray-50","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["name","download","class","w-4 h-4",4,"ngIf"],["name","loader-2","class","w-4 h-4 animate-spin",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-2","space-y-6"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","hover:shadow-md","transition-all","duration-300","group"],[1,"font-bold","text-navy","dark:text-white","mb-4","flex","items-center","gap-2"],["name","user",1,"w-5","h-5","text-primary"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","text-sm"],[1,"space-y-1"],[1,"text-gray-500","dark:text-gray-400"],[1,"font-medium","text-navy","dark:text-white"],[1,"text-gray-500","dark:text-gray-400","flex","items-center","gap-1"],["name","mail",1,"w-3.5","h-3.5"],["name","phone",1,"w-3.5","h-3.5"],["name","car",1,"w-5","h-5","text-primary"],[1,"mb-6"],[1,"text-xs","font-semibold","text-gray-500","dark:text-gray-400","uppercase","tracking-wider","mb-3"],[1,"font-medium","text-navy","dark:text-white","font-mono","text-xs"],[1,"font-medium","text-primary"],["class","bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-all duration-300 group",4,"ngIf"],[1,"bg-white","dark:bg-gray-800","p-6","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"font-bold","text-navy","dark:text-white","mb-4"],[1,"space-y-3","pb-4","border-b","border-gray-100","dark:border-gray-700","text-sm"],[1,"flex","justify-between"],[1,"text-gray-600","dark:text-gray-300"],[1,"font-medium"],[1,"font-medium","text-primary","capitalize"],[1,"pt-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold","text-primary"],["name","info",1,"w-5","h-5","text-primary"],[1,"space-y-3","text-sm"],[1,"flex","justify-between","py-2","border-b","border-gray-100","last:border-0"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700"],[1,"p-6","border-b","border-gray-100","dark:border-gray-700"],[1,"font-bold","text-navy","dark:text-white","flex","items-center","gap-2"],["name","message-circle",1,"w-5","h-5","text-primary"],[1,"p-4","max-h-96","overflow-y-auto","space-y-3"],["class","text-center py-8 text-gray-500 dark:text-gray-400 text-sm",4,"ngIf"],["class","flex gap-3",4,"ngFor","ngForOf"],[1,"p-4","border-t","border-gray-100","dark:border-gray-700"],[1,"flex","gap-2"],["type","file",1,"hidden",3,"change"],["title","Attach file",1,"p-2","text-gray-400","hover:text-primary","hover:bg-gray-100","dark:hover:bg-gray-700","rounded-lg","transition-colors",3,"click"],["name","paperclip",1,"w-5","h-5"],["type","text",1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","rounded-lg","bg-white","dark:bg-gray-900","text-gray-700","dark:text-gray-300","placeholder:text-gray-400","dark:placeholder:text-gray-500","focus:outline-none","focus:ring-2","focus:ring-primary/30","focus:border-primary","transition-colors","text-sm",3,"ngModelChange","keyup.enter","ngModel","placeholder"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-colors","font-medium","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"click","disabled"],["name","send","class","w-4 h-4",4,"ngIf"],[1,"text-sm"],["class","mt-2 flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/50 p-2 rounded",4,"ngIf"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","flex","items-center","gap-2","hover:bg-primary/90","transition-colors",3,"click"],["name","edit",1,"w-4","h-4"],["name","download",1,"w-4","h-4"],["name","loader-2",1,"w-4","h-4","animate-spin"],[1,"w-full","flex","items-center","justify-between","text-left","mb-4",3,"click"],["name","award",1,"w-5","h-5","text-primary"],[1,"w-5","h-5","text-gray-400","transition-transform",3,"name"],["class","space-y-3",4,"ngIf"],[1,"space-y-3"],["class","border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:border-primary transition-all duration-300",4,"ngFor","ngForOf"],[1,"border","border-gray-200","dark:border-gray-600","rounded-lg","p-4","hover:border-primary","transition-all","duration-300"],[1,"flex","items-center","gap-3","mb-3"],[1,"font-semibold","text-navy","dark:text-white"],[1,"px-2","py-1","rounded","text-xs","font-medium"],[1,"grid","grid-cols-3","gap-4","text-sm"],[1,"text-gray-500","dark:text-gray-400","block","mb-1"],[1,"font-semibold","text-primary"],[1,"w-full","flex","items-center","justify-between","text-left",3,"click"],["name","file-text",1,"w-5","h-5","text-primary"],["class","space-y-2 mt-4",4,"ngIf"],[1,"space-y-2","mt-4"],["class","flex items-start gap-2 p-3 bg-green-50 dark:bg-green-900/30 rounded-lg border border-green-100 dark:border-green-700",4,"ngFor","ngForOf"],[1,"flex","items-start","gap-2","p-3","bg-green-50","dark:bg-green-900/30","rounded-lg","border","border-green-100","dark:border-green-700"],["name","check-circle",1,"w-4","h-4","text-green-600","mt-0.5","flex-shrink-0"],[1,"text-sm","text-gray-700","dark:text-gray-300"],["name","paperclip",1,"w-5","h-5","text-primary"],["class","flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-3","rounded-lg","bg-gray-50","dark:bg-gray-700/50"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-300"],["class","px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium",4,"ngIf"],["class","px-2 py-1 bg-gray-200 text-gray-600 rounded text-xs font-medium",4,"ngIf"],[1,"px-2","py-1","bg-green-100","text-green-700","rounded","text-xs","font-medium"],[1,"px-2","py-1","bg-gray-200","text-gray-600","rounded","text-xs","font-medium"],[1,"text-center","py-8","text-gray-500","dark:text-gray-400","text-sm"],[1,"flex","gap-3"],[1,"w-8","h-8","bg-primary/10","rounded-full","flex","items-center","justify-center","flex-shrink-0"],["name","user",1,"w-4","h-4","text-primary"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-sm","font-semibold","text-navy","dark:text-white"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"text-sm","text-gray-700","dark:text-gray-300","mb-2"],["class","flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"flex","items-center","gap-2","text-xs","text-gray-500","dark:text-gray-400"],["name","paperclip",1,"w-3","h-3"],["name","send",1,"w-4","h-4"],[1,"mt-2","flex","items-center","gap-2","text-xs","text-gray-600","dark:text-gray-400","bg-gray-50","dark:bg-gray-700/50","p-2","rounded"],["name","file",1,"w-3","h-3"],[1,"ml-auto","text-red-500","hover:text-red-700",3,"click"],["name","x",1,"w-3","h-3"],[1,"flex","items-center","justify-center","h-96"],[3,"loading","message"],[1,"text-center"],["name","alert-circle",1,"h-12","w-12","text-red-500","mx-auto","mb-4"],[1,"text-2xl","font-bold","text-navy","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-300","mb-4"],[1,"px-4","py-2","bg-primary","text-white","rounded-lg","hover:bg-primary/90","transition-colors",3,"click"],["name","refresh-cw",1,"w-4","h-4","mr-2","inline"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout"),e.DNE(1,ia,240,114,"div",1)(2,aa,3,4,"div",2)(3,oa,12,7,"div",2),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",r.displayData),e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",r.error))},dependencies:[m.Sq,m.bT,u.me,u.BC,u.vS,v.w,k.N,c.WGl,x.D9]})}}return a})();var Y=_(8810),V=_(6354),X=_(9437),sa=_(6344);let la=(()=>{class a{constructor(t){this.api=t}getEndorsementTypes(){return this.api.get("/v1/lov/endorsement-sub-types").pipe((0,V.T)(t=>(t?.endorsement_sub_types||t?.result?.endorsement_sub_types||t?.result?.data||t?.data||[]).map(r=>({id:r.id,code:r.code||r.sequence_number,name:r.name||r.item}))),(0,X.W)(t=>(console.error("Failed to fetch endorsement types",t),(0,Y.$)(()=>t))))}getEndorsementReasons(t){return this.api.get("/v1/get-endorsement-subtype-reasons",{params:{end_subtype_seq_number:t}}).pipe((0,V.T)(i=>(i?.endorsement_sub_type_reasons||i?.endorsement_subtype_reasons||i?.endorsement_reasons||i?.reasons||i?.result?.data||i?.data||[]).map(o=>({id:o.id,name:o.name||o.item,title:o.title}))),(0,X.W)(i=>(console.error("Failed to fetch endorsement reasons",i),(0,Y.$)(()=>i))))}createEndorsement(t){return this.api.post("/v1/policy/endorsement",t).pipe((0,V.T)(i=>i),(0,X.W)(i=>(console.error("Failed to create endorsement",i),(0,Y.$)(()=>i))))}static{this.\u0275fac=function(i){return new(i||a)(e.KVO(sa.G))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function da(a,n){if(1&a&&(e.j41(0,"p",12),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Lme(" ",e.bMT(2,2,"BROKER.ENDORSEMENT.POLICY_NUM"),"",t.policyNumber," ")}}function ca(a,n){1&a&&e.nrm(0,"div",13)}function pa(a,n){1&a&&(e.j41(0,"div",14),e.nrm(1,"i",15),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"BROKER.ENDORSEMENT.LOADING_OPTIONS")," "))}function ua(a,n){if(1&a&&(e.j41(0,"div",28),e.nrm(1,"i",29),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&a){const t=e.XpG(2);e.R7$(2),e.SpI(" ",e.bMT(3,1,t.error)," ")}}function ma(a,n){1&a&&e.nrm(0,"i",30)}function ga(a,n){if(1&a){const t=e.RV6();e.j41(0,"div"),e.DNE(1,ua,4,3,"div",16),e.j41(2,"div",17)(3,"div")(4,"app-selection-modal",18),e.nI1(5,"translate"),e.nI1(6,"translate"),e.nI1(7,"translate"),e.nI1(8,"translate"),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formData.end_sub_type_code,r)||(o.formData.end_sub_type_code=r),e.Njj(r)}),e.bIt("valueChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onTypeChange(r))}),e.k0s()(),e.j41(9,"div")(10,"app-date-picker",19),e.nI1(11,"translate"),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formData.effective_from_date,r)||(o.formData.effective_from_date=r),e.Njj(r)}),e.k0s()(),e.j41(12,"div")(13,"app-selection-modal",20),e.nI1(14,"translate"),e.nI1(15,"translate"),e.nI1(16,"translate"),e.nI1(17,"translate"),e.mxI("valueChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formData.endorsement_reason_id,r)||(o.formData.endorsement_reason_id=r),e.Njj(r)}),e.bIt("valueChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onReasonChange(r))}),e.k0s()(),e.j41(18,"div")(19,"label",21),e.EFF(20),e.nI1(21,"translate"),e.j41(22,"span",22),e.EFF(23),e.nI1(24,"translate"),e.k0s()(),e.j41(25,"textarea",23),e.nI1(26,"translate"),e.mxI("ngModelChange",function(r){e.eBV(t);const o=e.XpG();return e.DH7(o.formData.remarks,r)||(o.formData.remarks=r),e.Njj(r)}),e.k0s()(),e.j41(27,"div",24)(28,"button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.goBack())}),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"button",26),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.submit())}),e.DNE(32,ma,1,0,"i",27),e.EFF(33),e.nI1(34,"translate"),e.nI1(35,"translate"),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.error),e.R7$(3),e.Y8G("label",e.bMT(5,27,"BROKER.ENDORSEMENT.SELECT_TYPE.LABEL"))("options",t.types),e.R50("value",t.formData.end_sub_type_code),e.Y8G("title",e.bMT(6,29,"BROKER.ENDORSEMENT.SELECT_TYPE.TITLE"))("subtitle",e.bMT(7,31,"BROKER.ENDORSEMENT.SELECT_TYPE.SUBTITLE"))("placeholder",e.bMT(8,33,"BROKER.ENDORSEMENT.SELECT_TYPE.PLACEHOLDER"))("required",!0),e.R7$(6),e.Y8G("label",e.bMT(11,35,"BROKER.ENDORSEMENT.EFFECTIVE_DATE.LABEL")),e.R50("ngModel",t.formData.effective_from_date),e.Y8G("disabled",!1),e.R7$(3),e.Y8G("label",e.bMT(14,37,"BROKER.ENDORSEMENT.SELECT_REASON.LABEL"))("options",t.reasons),e.R50("value",t.formData.endorsement_reason_id),e.Y8G("title",e.bMT(15,39,"BROKER.ENDORSEMENT.SELECT_REASON.TITLE"))("subtitle",e.bMT(16,41,"BROKER.ENDORSEMENT.SELECT_REASON.SUBTITLE"))("placeholder",e.bMT(17,43,"BROKER.ENDORSEMENT.SELECT_REASON.PLACEHOLDER"))("disabled",!t.formData.end_sub_type_code)("required",!0),e.R7$(7),e.SpI(" ",e.bMT(21,45,"BROKER.ENDORSEMENT.REMARKS.LABEL")," "),e.R7$(3),e.JRh(e.bMT(24,47,"BROKER.ENDORSEMENT.REMARKS.OPTIONAL")),e.R7$(2),e.Y8G("placeholder",e.bMT(26,49,"BROKER.ENDORSEMENT.REMARKS.PLACEHOLDER")),e.R50("ngModel",t.formData.remarks),e.R7$(4),e.SpI(" ",e.bMT(30,51,"BUTTON.CANCEL")," "),e.R7$(2),e.Y8G("disabled",t.submitting||!t.formData.end_sub_type_code||!t.formData.endorsement_reason_id),e.R7$(),e.Y8G("ngIf",t.submitting),e.R7$(),e.SpI(" ",t.submitting?e.bMT(34,53,"BROKER.ENDORSEMENT.SUBMITTING"):e.bMT(35,55,"BROKER.ENDORSEMENT.SUBMIT")," ")}}let _a=(()=>{class a{constructor(t,i,r,o,s,l){this.route=t,this.router=i,this.endorsementService=r,this.policyService=o,this.notificationService=s,this.appTranslate=l,this.policyId="",this.policyNumber="",this.loading=!1,this.submitting=!1,this.error=null,this.pageLoading=!0,this.types=[],this.reasons=[],this.formData={end_sub_type_code:"",endorsement_reason_id:"",effective_from_date:(new Date).toISOString().split("T")[0],remarks:""}}ngOnInit(){this.policyId=this.route.snapshot.params.id,this.policyId?this.loadInitialData():(this.error="BROKER.ENDORSEMENT.ERROR.POLICY_MISSING",this.pageLoading=!1)}loadInitialData(){var t=this;return(0,b.A)(function*(){try{const i=yield t.policyService.getPolicy(Number(t.policyId)).toPromise(),r=i?.result?.data||i?.data||i||{};t.policyNumber=r.policy_number||r.name||r.policyId||t.policyId;const o=yield t.endorsementService.getEndorsementTypes().toPromise();t.types=o||[],t.pageLoading=!1}catch(i){console.error("Failed to load initial data",i),t.error="BROKER.ENDORSEMENT.ERROR.LOAD_FAILED",t.pageLoading=!1}})()}onTypeChange(t){var i=this;return(0,b.A)(function*(){if(i.formData.end_sub_type_code=t,i.formData.endorsement_reason_id="",i.formData.remarks="",i.reasons=[],t)try{const r=yield i.endorsementService.getEndorsementReasons(t).toPromise();i.reasons=r||[]}catch(r){console.error("Failed to load reasons",r)}})()}onReasonChange(t){this.formData.endorsement_reason_id=String(t);const i=this.reasons.find(r=>String(r.id)===String(t));i&&(this.formData.remarks=i.title||i.name||"")}submit(){var t=this;return(0,b.A)(function*(){if(!t.formData.end_sub_type_code||!t.formData.endorsement_reason_id||!t.formData.effective_from_date)return t.error="BROKER.ENDORSEMENT.ERROR.REQUIRED_FIELDS",void t.notificationService.warning(t.appTranslate.instant("BROKER.ENDORSEMENT.ERROR.REQUIRED_FIELDS"));t.submitting=!0,t.error=null;try{const i={params:{data:{policy_number:t.policyNumber,lead_source:"Web Portal",endorsement_data:{calculation_type:"prorata",end_sub_type_code:t.formData.end_sub_type_code,endorsement_reason_id:Number(t.formData.endorsement_reason_id),effective_from_date:t.formData.effective_from_date,remarks:t.formData.remarks||""}}}},r=yield t.endorsementService.createEndorsement(i).toPromise();if(r?.error)throw new Error(r.error.data?.message||r.error.message||"BROKER.ENDORSEMENT.ERROR.CREATION_FAILED");t.notificationService.success(t.appTranslate.instant("BROKER.ENDORSEMENT.SUCCESS_MSG")),t.router.navigate(["/dashboard/broker/quotations"])}catch(i){console.error("Failed to submit endorsement",i);let r="BROKER.ENDORSEMENT.ERROR.SUBMISSION_FAILED";i?.error?.error?.data?.message?r=i.error.error.data.message:i?.error?.data?.message?r=i.error.data.message:i?.error?.message?r=i.error.message:i?.message&&(r=i.message),t.error=r;const o="BROKER.ENDORSEMENT.ERROR.SUBMISSION_FAILED"===r?t.appTranslate.instant(r):r;t.notificationService.error(o)}finally{t.submitting=!1}})()}goBack(){this.router.navigate(["/dashboard/broker/policies",this.policyId])}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(la),e.rXU(w.m),e.rXU(C.J),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-broker-endorsement"]],decls:18,vars:10,consts:[[1,"max-w-5xl","mx-auto","px-4","py-8"],[1,"inline-flex","items-center","text-sm","text-gray-500","hover:text-primary","mb-6","transition-colors",3,"click"],["data-lucide","chevron-left",1,"w-4","h-4","mr-1"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","dark:border-gray-700","p-6","mb-6"],[1,"flex","items-center","gap-4","mb-6"],[1,"w-12","h-12","bg-blue-50","dark:bg-blue-900/30","rounded-xl","flex","items-center","justify-center","text-primary"],["data-lucide","file-text",1,"w-6","h-6"],[1,"text-2xl","font-bold","text-navy-900","dark:text-white"],["class","text-gray-600 dark:text-gray-400",4,"ngIf"],["class","h-4 w-32 bg-gray-200 animate-pulse rounded mt-1",4,"ngIf"],["class","p-8 text-center text-gray-500",4,"ngIf"],[4,"ngIf"],[1,"text-gray-600","dark:text-gray-400"],[1,"h-4","w-32","bg-gray-200","animate-pulse","rounded","mt-1"],[1,"p-8","text-center","text-gray-500"],["data-lucide","loader-2",1,"w-8","h-8","animate-spin","mx-auto","mb-2"],["class","mb-6 p-4 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-lg flex items-center gap-2",4,"ngIf"],[1,"space-y-6"],["valueKey","code","displayKey","name",3,"valueChange","label","options","value","title","subtitle","placeholder","required"],[3,"ngModelChange","label","ngModel","disabled"],["valueKey","id","displayKey","name",3,"valueChange","label","options","value","title","subtitle","placeholder","disabled","required"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-1"],[1,"text-gray-400","font-normal"],[1,"w-full","rounded-lg","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","focus:ring-primary","focus:border-primary","py-2","px-3","min-h-[100px]","transition-colors",3,"ngModelChange","placeholder","ngModel"],[1,"flex","justify-end","gap-3","pt-6","border-t","border-gray-100","dark:border-gray-700"],[1,"px-4","py-2","text-gray-600","dark:text-gray-400","hover:bg-gray-50","dark:hover:bg-gray-700","rounded-lg","transition-colors",3,"click"],[1,"px-6","py-2","bg-primary","text-white","rounded-lg","font-medium","shadow-sm","hover:bg-primary/90","transition-all","flex","items-center","gap-2","disabled:opacity-70","disabled:cursor-not-allowed",3,"click","disabled"],["data-lucide","loader-2","class","w-4 h-4 animate-spin",4,"ngIf"],[1,"mb-6","p-4","bg-red-50","dark:bg-red-900/20","text-red-700","dark:text-red-300","rounded-lg","flex","items-center","gap-2"],["data-lucide","alert-circle",1,"w-5","h-5"],["data-lucide","loader-2",1,"w-4","h-4","animate-spin"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"button",1),e.bIt("click",function(){return r.goBack()}),e.nrm(3,"i",2),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"div",3)(7,"div",4)(8,"div",5),e.nrm(9,"i",6),e.k0s(),e.j41(10,"div")(11,"h1",7),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.DNE(14,da,3,4,"p",8)(15,ca,1,0,"div",9),e.k0s()(),e.DNE(16,pa,4,3,"div",10)(17,ga,36,57,"div",11),e.k0s()()()),2&i&&(e.R7$(4),e.SpI(" ",e.bMT(5,6,"BROKER.ENDORSEMENT.BACK_TO_POLICY")," "),e.R7$(8),e.JRh(e.bMT(13,8,"BROKER.ENDORSEMENT.TITLE")),e.R7$(2),e.Y8G("ngIf",!r.pageLoading),e.R7$(),e.Y8G("ngIf",r.pageLoading),e.R7$(),e.Y8G("ngIf",r.pageLoading),e.R7$(),e.Y8G("ngIf",!r.pageLoading))},dependencies:[m.bT,u.me,u.BC,u.vS,v.w,q.I,z.j,x.D9],encapsulation:2})}}return a})();function ha(a,n){if(1&a&&(e.j41(0,"div",15),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.error)," ")}}function fa(a,n){1&a&&(e.j41(0,"div",16),e.nrm(1,"app-loading-spinner"),e.k0s())}function ba(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-dynamic-table-with-filters",17),e.bIt("filteredDataChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onFilteredDataChange(r))})("exportData",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onExport())})("action",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.handleTableAction(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("data",t.data)("columns",t.visibleColumns)("showExport",!0)("maxSelectOptions",10)}}function ya(a,n){if(1&a){const t=e.RV6();e.j41(0,"app-pagination",18),e.bIt("pageChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageChange(r))})("pageSizeChange",function(r){e.eBV(t);const o=e.XpG();return e.Njj(o.onPageSizeChange(r))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("currentPage",t.currentPage)("pageSize",t.pageSize)("totalRecords",t.totalRecords)}}const va=[{path:"",component:ke},{path:"clients",component:Te},{path:"clients/:id",component:bt},{path:"policies",component:Me},{path:"due-renewal-policies",component:(()=>{class a{constructor(t,i,r,o){this.policyService=t,this.authService=i,this.router=r,this.appTranslate=o,this.allColumns=[],this.visibleColumns=[],this.data=[],this.filteredData=[],this.isLoading=!0,this.error=null,this.currentPage=1,this.pageSize=25,this.totalRecords=0,this.setupColumns()}ngOnInit(){this.fetchTotalCount(),this.loadPolicies()}fetchTotalCount(){const t=this.authService.currentUserValue;t&&this.policyService.listPolicies({user_id:t.id,user_type:"broker",limit:1e4,offset:0,domain:'[("current", "=", True),("not_renewed", "!=", True),("is_renewal", "!=", True),("lob_names", "=", "\u0633\u064a\u0627\u0631\u0627\u062a"),("state", "=", "approved"),("renewal_request", "=", False),("renewal_difference", "<=", 60),("renewal_difference", ">=", -60),(\'invoice_paid\', \'=\', True)]'}).subscribe({next:r=>{const o=r.data?.data||r.data?.result?.data||r.data||[];this.totalRecords=Array.isArray(o)?o.length:0},error:r=>{console.error("Error fetching total policies count:",r)}})}setupColumns(){this.allColumns=[{key:"riskImage",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CAR_IMAGE"),filterable:!1,render:t=>this.renderBoolean(t.riskImage)},{key:"policyNumber",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.POLICY_NO"),filterable:!0,filterType:"text",sortable:!0},{key:"transactionType",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.TRANSACTION_TYPE"),filterable:!0,render:t=>this.renderTransactionType(t)},{key:"productName",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.PRODUCT"),filterable:!0,filterType:"text",sortable:!0},{key:"customerName",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CUSTOMER"),filterable:!0,filterType:"text",sortable:!0},{key:"status",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.STATUS"),filterable:!0,render:t=>this.renderStatus(t)},{key:"approveDate",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.APPROVE_DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"issueDate",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ISSUE_DATE"),filterable:!0,filterType:"date",sortable:!0},{key:"effectiveFrom",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.EFFECTIVE_FROM"),filterable:!0,filterType:"date",sortable:!0},{key:"effectiveTo",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.EFFECTIVE_TO"),filterable:!0,filterType:"date",sortable:!0},{key:"grossPremium",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.GROSS_PREMIUM"),filterable:!1,render:t=>this.renderCurrency(t.grossPremium,t.currency)},{key:"netPremium",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.NET_PREMIUM"),filterable:!1,render:t=>this.renderCurrency(t.netPremium,t.currency)},{key:"currency",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.CURRENCY"),filterable:!0,filterType:"text",sortable:!0},{key:"paymentStatus",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.PAYMENT_STATUS"),filterable:!0,render:t=>this.renderPaymentStatus(t.paymentStatus)},{key:"issuingBranch",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ISSUING_BRANCH"),filterable:!0,filterType:"text",sortable:!0},{key:"actions",label:this.appTranslate.instant("BROKER.POLICIES.COLUMNS.ACTIONS"),filterable:!1,mandatory:!0,render:t=>`\n                    <div class="flex items-center gap-2">\n                        <button class="px-3 py-1 bg-primary text-white text-xs font-medium rounded hover:bg-primary-dark transition-colors" data-action="createRenewal" data-id="${t.id}" title="Create Renewal">\n                            Create Renewal\n                        </button>\n                        <button class="p-1 text-gray-400 hover:text-primary transition-colors" data-action="view" data-id="${t.id}" title="View Details">\n                            <i data-lucide="eye" class="w-4 h-4"></i>\n                        </button>\n                    </div>\n                `}],this.visibleColumns=[...this.allColumns]}onVisibleColumnsChange(t){this.visibleColumns=t}renderStatus(t){const i=t.rawStatus||"pending";let r="";return r=["active","approved","paid"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","processing","review"].includes(i)?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.status}</span>`}renderTransactionType(t){const i=t.rawTransactionType||"new";let r="bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300";return"endorsement"===i||"end"===i?r="bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300":"renewal"===i?r="bg-teal-100 dark:bg-teal-900/30 text-teal-800 dark:text-teal-300":"cancellation"===i||"cancel"===i?r="bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300":["non_technical","technical_refund","technical_add","technical_borndead"].includes(i)&&(r="bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300"),`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${t.transactionType}</span>`}renderPaymentStatus(t){const i=t?.toLowerCase()||"outstanding";let r="";return r=["paid","completed"].includes(i)?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":["pending","outstanding"].includes(i)?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300",`<span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${r}">${this.appTranslate.instant(`STATUS.${i.toUpperCase()}`)}</span>`}renderBoolean(t){return t?'<i data-lucide="check-circle-2" class="w-5 h-5 text-green-500 mx-auto"></i>':'<i data-lucide="x-circle" class="w-5 h-5 text-gray-300 mx-auto"></i>'}renderCurrency(t,i){return`<span class="font-medium text-gray-900 dark:text-gray-100">${i||"EGP"} ${Number(t).toLocaleString()}</span>`}ngAfterViewChecked(){typeof lucide<"u"&&lucide.createIcons()}loadPolicies(){this.isLoading=!0;const t=this.authService.currentUserValue;t&&this.policyService.listPolicies({user_id:t.id,user_type:"broker",limit:this.pageSize,offset:(this.currentPage-1)*this.pageSize,domain:'[("current", "=", True),("not_renewed", "!=", True),("is_renewal", "!=", True),("lob_names", "=", "\u0633\u064a\u0627\u0631\u0627\u062a"),("state", "=", "approved"),("renewal_request", "=", False),("renewal_difference", "<=", 60),("renewal_difference", ">=", -60),(\'invoice_paid\', \'=\', True)]'}).subscribe({next:o=>{const s=o.data?.data||o.data?.result?.data||o.data||[];(o.data?.total_count||o.data?.count)&&(this.totalRecords=o.data.total_count||o.data.count),this.data=s.map(l=>{const d=(l.state||"Draft").replace(/^STATUS\./i,"").toLowerCase(),g=this.appTranslate.instant(`STATUS.${d.toUpperCase()}`),p=(l.transaction_type||"New").replace(/^TYPES\./i,"").toLowerCase(),f=this.appTranslate.instant(`TYPES.${p.toUpperCase()}`);return{id:l.id||l.policy_number,policyNumber:l.policy_number||"Draft",riskImage:l.risk_image,transactionType:f,rawTransactionType:p,productName:l.product_name||"Motor Private Section",customerName:l.customer_name||"Customer",status:g,rawStatus:d,approveDate:l.approve_date||"-",issueDate:l.issue_date||"-",effectiveFrom:l.effective_from_date||"-",effectiveTo:l.effective_to_date||"-",grossPremium:l.gross_premium||0,netPremium:l.net_premium||0,currency:l.currency||"EGP",paymentStatus:l.payment_status||"outstanding",issuingBranch:l.issuing_branch||"Head office"}}),this.isLoading=!1},error:o=>{console.error("Error loading policies:",o),this.error="BROKER.POLICIES.ERROR_LOADING",this.isLoading=!1}})}onFilteredDataChange(t){this.filteredData=t}handleTableAction(t){switch(t.action){case"createRenewal":console.log("Create renewal for",t.data.id);break;case"view":this.router.navigate(["/dashboard/broker/policies",t.data.id]);break;case"download":console.log("Download policy",t.data.id);break;case"more":console.log("More actions for",t.data.id)}}onExport(){console.log("Exporting policies...")}onPageChange(t){this.currentPage=t,this.loadPolicies()}onPageSizeChange(t){this.pageSize=t,this.currentPage=1,this.loadPolicies()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(w.m),e.rXU(y.u),e.rXU(h.Ix),e.rXU(I.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-due-renewal-policies"]],decls:18,vars:6,consts:[[1,"space-y-6"],[1,"bg-indigo-50","px-7","py-6","border-b","border-gray-200"],[1,"flex","items-start","gap-4"],[1,"bg-gradient-to-br","from-indigo-500","to-indigo-600","p-3","rounded-lg","shadow-sm","flex-shrink-0"],["data-lucide","refresh-cw",1,"w-6","h-6","text-white"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-600","text-base"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-sm","border","border-gray-100","overflow-hidden"],[1,"p-4","border-b","border-gray-100","dark:border-gray-700","flex","justify-end"],[3,"visibleColumnsChange","columns","pageId"],["class","p-8 text-center text-red-500",4,"ngIf"],["class","p-12 flex justify-center",4,"ngIf"],[3,"data","columns","showExport","maxSelectOptions","filteredDataChange","exportData","action",4,"ngIf"],[3,"currentPage","pageSize","totalRecords","pageChange","pageSizeChange",4,"ngIf"],[1,"p-8","text-center","text-red-500"],[1,"p-12","flex","justify-center"],[3,"filteredDataChange","exportData","action","data","columns","showExport","maxSelectOptions"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalRecords"]],template:function(i,r){1&i&&(e.j41(0,"app-dashboard-layout")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5)(7,"h1",6),e.EFF(8,"Due Renewal Policies"),e.k0s(),e.j41(9,"p",7),e.EFF(10,"Manage and renew policies that are due for renewal"),e.k0s()()()(),e.j41(11,"div",8)(12,"div",9)(13,"app-column-toggle",10),e.bIt("visibleColumnsChange",function(s){return r.onVisibleColumnsChange(s)}),e.k0s()(),e.DNE(14,ha,3,3,"div",11)(15,fa,2,0,"div",12)(16,ba,1,4,"app-dynamic-table-with-filters",13),e.k0s(),e.DNE(17,ya,1,3,"app-pagination",14),e.k0s()()),2&i&&(e.R7$(13),e.Y8G("columns",r.allColumns)("pageId","due-renewal-policies-list"),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error),e.R7$(),e.Y8G("ngIf",!r.isLoading&&!r.error&&r.totalRecords>0))},dependencies:[m.bT,v.w,k.N,T.u,F.e,L,x.D9],encapsulation:2})}}return a})()},{path:"policies/:id",component:Pt},{path:"endorsement/:id",component:_a},{path:"quotations",component:P},{path:"quotations/renewal-requests",component:P,data:{filterType:"renewal"}},{path:"quotations/endorsement-requests",component:P,data:{filterType:"endorsement"}},{path:"quotations/lost-requests",component:P,data:{filterType:"lost"}},{path:"quotations/:id",component:na},{path:"quote/new",component:Yr},{path:"commissions",component:Hr},{path:"claims",component:Zr},{path:"claims/new",component:bi.M},{path:"claims/:id",component:fi},{path:"premiums",component:Ci},{path:"profile",component:Ri.n},{path:"settings",component:Ii.b}];let xa=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[h.iI.forChild(va),h.iI]})}}return a})();var ka=_(217);let Ca=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[m.MD,u.YN,xa,ka.G,K,c.flO.pick({Shield:c.ekZ,User:c.KJW,FileText:c.iUU,Calendar:c.VvS,CheckCircle:c.rAV,Download:c.f5X,ChevronRight:c.c_$,DollarSign:c.G9t,CreditCard:c.y5g,Phone:c.bcf,Mail:c.gE4,MapPin:c.sDd,Car:c.THT,Award:c.wAm,TrendingUp:c.ntg,History:c.BZB,Clock:c.zD7,AlertCircle:c.RIJ,ChevronLeft:c.JGc,Plus:c.FWt,Search:c.vji,Filter:c.dJT,ArrowRight:c.Qpb,Trash2:c.TBR,Edit:c.ffu,Eye:c.kU3,X:c.X,UploadCloud:c.n7g,File:c.ZHH,RefreshCw:c.e9t,Home:c.ww0,Settings:c.wB_,LogOut:c.nUv,Menu:c.W1t,Bell:c.IrQ,AlertTriangle:c.hcu,Paperclip:c.xv8,Loader2:c.krw})]})}}return a})()}}]);